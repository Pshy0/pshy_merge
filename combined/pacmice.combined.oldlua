--- pshy_merge.py
--
-- This module is used by `combine.py` to merge TFM modules.
--
-- If you dont use `combine.py`, merge modules this way:
--	- paste the content of `pshy_merge.py`
--	- for each module to merge:
--		- paste `pshy.merge_ModuleBegin("your_module_name.py")`
--		- paste the content of the module
--		- paste `pshy.merge_ModuleEnd()`
--	- paste `pshy.merge_ModuleFinish()`
--
-- Also adds the event `eventInit()`, called when all modules have been merged (after calling `pshy.merge_Finish()`).
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
pshy = pshy or {}
--- Internal Use:
pshy.tfm_events = {}					-- map (key == event name) of tfm events function lists (every event may have one function per module) 
										-- any function startiong by "event" in _G will be included in this map
pshy.merge_standard_modules_count = 0	-- count of merged modules
pshy.merge_hard_modules_count = 0		-- count of merged modules
pshy.merge_has_module_began = false
pshy.merge_has_finished	= false			-- did merging finish
--- Begin another module.
-- @deprecated
-- Call after a new module's code, in the merged source (hard version only, dont call pshy.ModuleEnd).
-- @private
function pshy.merge_ModuleHard(module_name)
	assert(pshy.merge_has_module_began == false, "pshy.ModuleHard(): A previous module have not been ended!")
	assert(pshy.merge_has_finished == false, "pshy.MergeFinish(): Merging have already been finished!")
	pshy.merge_hard_modules_count = pshy.merge_hard_modules_count + 1
	--print("[Merge] Loading " .. module_name .. " (fast)")
end
--- Begin another module.
-- Call before a new module's code, in the merged source.
-- @private
function pshy.merge_ModuleBegin(module_name)
	assert(pshy.merge_has_module_began == false, "pshy.ModuleBegin(): A previous module have not been ended!")
	assert(pshy.merge_has_finished == false, "pshy.MergeFinish(): Merging have already been finished!")
	pshy.merge_has_module_began = true
	pshy.merge_standard_modules_count = pshy.merge_standard_modules_count + 1
	--print("[Merge] Loading " .. module_name .. "...")
end
--- Begin another module.
-- Call after a module's code, in the merged source.
-- @private
function pshy.merge_ModuleEnd()
	assert(pshy.merge_has_module_began == true, "pshy.ModuleEnd(): No module to end!")
	assert(pshy.merge_has_finished == false, "pshy.MergeFinish(): Merging have already been finished!")
	pshy.merge_has_module_began = false
	-- find used event names
	local events = {}
	for e_name, e in pairs(_G) do
		if type(e) == "function" and string.sub(e_name, 1, 5) == "event" then
			table.insert(events, e_name)
		end
	end
	-- move tfm global events to pshy.tfm_events
	for i_e, e_name in ipairs(events) do
		if not pshy.tfm_events[e_name] then
			pshy.tfm_events[e_name] = {}
		end
		local e_func_list = pshy.tfm_events[e_name]
		table.insert(e_func_list, _G[e_name])
		_G[e_name] = nil
	end
	--print("[Merge] Module loaded.")
end
--- Final step for merging modules.
-- Call this when you're done putting modules together.
-- @private
function pshy.merge_Finish()
	assert(pshy.merge_has_module_began == false, "pshy.MergeFinish(): A previous module have not been ended!")
	assert(pshy.merge_has_finished == false, "pshy.MergeFinish(): Merging have already been finished!")
	pshy.merge_has_finished = true
	local count_events = 0
	for e_name, e_func_list in pairs(pshy.tfm_events) do
		if #e_func_list > 0 then
			count_events = count_events + 1
			-- @todo generated functions should abort if a subfunction returns non-nil
			_G[e_name] = function(...)
				local rst = nil
				for i_func = 1, #e_func_list do
					rst = e_func_list[i_func](...)
					if rst ~= nil then
						break
					end
				end
			end
		end
	end
	eventInit()
	print("<vp>[PshyMerge] </vp><v>Finished loading " .. tostring(count_events) .. " events in " .. tostring(pshy.merge_standard_modules_count) .. " modules (+ " .. tostring(pshy.merge_hard_modules_count) .. " hard merged modules).</v>")
end
--- Pshy event eventInit
-- Happen when merging is finished
function eventInit()
end
pshy.tfm_events["eventInit"] = {}
table.insert(pshy.tfm_events["eventInit"], eventInit)
eventInit = nil
pshy.merge_ModuleBegin("pshy_splashscreen.lua")
--- pshy_splashscreen.lua
--
-- Adds a splashscreen to a module that is displayed on startup or when a player join.
--
-- @todo: Use timers?
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @namespace pshy
-- @require pshy_merge.lua
--- Module Settings:
pshy.splashscreen_image = "17ab692dc8e.png"		-- splash image
pshy.splashscreen_x = 0							-- x location
pshy.splashscreen_y = -10						-- y location
pshy.splashscreen_sx = 1						-- scale on x
pshy.splashscreen_sy = 1						-- scale on y
pshy.splashscreen_text = "<fc>Pshy Module</fc>"	-- @todo splash text (over the image)
pshy.splashscreen_text_x = 0					-- x location of the text
pshy.splashscreen_text_y = 0					-- y location of the text
pshy.splashscreen_text_w = nil					-- width of the text, nil for auto
pshy.splashscreen_text_h = nil					-- height of the text, nil for auto
pshy.splashscreen_text_arbitrary_id = 13
pshy.splashscreen_text_backcolor = 0x0			-- back color of the text area
pshy.splashscreen_text_bordercolor = 0x0		-- border color of the text area
pshy.splashscreen_text_alpha = 1.0				-- opacity of the text
pshy.splashscreen_duration = 8 * 1000			-- duration of the splashscreen in milliseconds
--- Internal Use
pshy.splashscreen_players_ids = {}
pshy.splashscreen_players_end_times = {}
pshy.splashscreen_last_loop_time = nil
pshy.splashscreen_have_shown = false
--- Hide the splashscreen from a player.
-- This is called automatically after `pshy.splashscreen_duration` milliseconds.
function pshy.splashscreen_Hide(player_name)
	if pshy.splashscreen_players_ids[player_name] then
		tfm.exec.removeImage(pshy.splashscreen_players_ids[player_name])
		pshy.splashscreen_players_ids[player_name] = nil
	end
	ui.removeTextArea(pshy.splashscreen_text_arbitrary_id, player_name)
	pshy.splashscreen_players_end_times[player_name] = nil
end
--- Show the splashscreen to a player.
-- This is called automatically when a player join or the game start.
function pshy.splashscreen_Show(player_name)
	pshy.splashscreen_players_end_times[player_name] = pshy.splashscreen_last_loop_time + pshy.splashscreen_duration
	if pshy.splashscreen_image then
		pshy.splashscreen_players_ids[player_name] = tfm.exec.addImage(pshy.splashscreen_image, "&0", pshy.splashscreen_x, pshy.splashscreen_y, player_name, pshy.splashscreen_sx, pshy.splashscreen_sy)
	end
	if pshy.splashscreen_text then
		ui.addtextArea(pshy.splashscreen_text_arbitrary_id, pshy.splashscreen_text, player_name, pshy.splashscreen_text_x, pshy.splashscreen_text_y, pshy.splashscreen_text_w, pshy.splashscreen_text_h, pshy.splashscreen_text_backcolor, pshy.splashscreen_bordercolor, pshy.splashscreen_alpha, false)
	end
end
--- TFM event eventNewPlayer
function eventNewPlayer(player_name)
	pshy.splashscreen_Show(player_name)
end
--- TFM event eventPlayerLeft
function eventPlayerLeft(player_name)
	pshy.splashscreen_Hide(player_name)
end
--- TFM event eventNewGame
-- Remove splashscreens on new games.
-- @todo Check if the game does automatically remove images already between games?
function eventNewGame()
	if pshy.splashscreen_last_loop_time then
		local timeouted = {}
		for player_name in pairs(pshy.splashscreen_players_end_times) do
			timeouted[player_name] = true
		end
		for player_name in pairs(timeouted) do
			pshy.splashscreen_Hide(player_name)
		end
	end
	pshy.splashscreen_last_loop_time = 0
end
--- TFM event eventLoop
function eventLoop(time, time_remaining)
	-- remove timeouted splashscreens
	local timeouted = {}
	for player_name in pairs(pshy.splashscreen_players_end_times) do
		if pshy.splashscreen_players_end_times[player_name] < time then
			timeouted[player_name] = true
		end
	end
	for player_name in pairs(timeouted) do
		pshy.splashscreen_Hide(player_name)
	end
	-- update last time
	pshy.splashscreen_last_loop_time = time
	-- first splash
	if not pshy.splashscreen_have_shown then
		for player_name in pairs(tfm.get.room.playerList) do
			pshy.splashscreen_Show(player_name)
		end
		pshy.splashscreen_have_shown = true
	end
end
pshy.merge_ModuleEnd()
pshy.merge_ModuleHard("pshy_keycodes.lua")
--- pshy_keycodes.lua
--
-- This file is a memo for key codes.
-- This contains two maps:
--	- pshy.keycodes: map of key names to key codes
--	- pshy.keynames: map of key codes to key names
--
-- @author TFM:Pshy#3753 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
-- @source https://help.adobe.com/fr_FR/FlashPlatform/reference/actionscript/3/flash/ui/Keyboard.html
pshy = pshy or {}
--- Map of key name -> key code
pshy.keycodes = {}
-- Directions:
pshy.keycodes.LEFT = 0
pshy.keycodes.UP = 1
pshy.keycodes.RIGHT = 2
pshy.keycodes.DOWN = 3
-- modifiers
pshy.keycodes.SHIFT = 16
pshy.keycodes.CTRL = 17
pshy.keycodes.ALT = 18
-- Arrows:
pshy.keycodes.ARROW_LEFT = 37
pshy.keycodes.ARROW_UP = 38
pshy.keycodes.ARROW_RIGHT = 39
pshy.keycodes.ARROW_DOWN = 40
-- Letters
for i_letter = 0, 25 do
	pshy.keycodes[string.char(65 + i_letter)] = 65 + i_letter
end
-- Numbers (48 - 57):
for number = 0, 9 do
	pshy.keycodes["NUMBER_" .. tostring(number)] = 48 + number
end
-- Numpad Numbers (96 - 105):
for number = 0, 9 do
	pshy.keycodes["NUMPAD_" .. tostring(number)] = 96 + number
end
-- Numpad
pshy.keycodes.NUMPAD_MULTIPLY = 106
pshy.keycodes.NUMPAD_ADD = 107
pshy.keycodes.NUMPAD_SUBTRACT = 109
pshy.keycodes.NUMPAD_ENTER = 108
pshy.keycodes.NUMPAD_DECIMAL = 110
pshy.keycodes.NUMPAD_DIVIDE = 111
-- F1 - F12 (112 - 123)
for f_index = 0, 11 do
	pshy.keycodes["NUMBER_" .. tostring(f_index + 1)] = 112 + f_index
end
-- Other
pshy.keycodes.BACKSPACE = 8
pshy.keycodes.TAB = 9
pshy.keycodes.ENTER = 13
pshy.keycodes.PAUSE = 19
pshy.keycodes.CAPSLOCK = 20
pshy.keycodes.ESCAPE = 27
pshy.keycodes.SPACE = 32
pshy.keycodes.PAGE_UP = 33
pshy.keycodes.PAGE_DOWN = 34
pshy.keycodes.END = 35
pshy.keycodes.HOME = 36
pshy.keycodes.INSERT = 45
pshy.keycodes.DELETE = 46
pshy.keycodes.SEMICOLON = 186
pshy.keycodes.EQUALS = 187
pshy.keycodes.COMMA = 188
pshy.keycodes.HYPHEN = 189
pshy.keycodes.PERIOD = 190
pshy.keycodes.SLASH = 191
pshy.keycodes.GRAVE = 192
pshy.keycodes.LEFTBRACKET = 219
pshy.keycodes.BACKSLASH = 220
pshy.keycodes.RIGHTBRACKET = 221
--- Map of key code -> key name
pshy.keynames = {}
for keyname, keycode in pairs(pshy.keycodes) do
	pshy.keynames[keycode] = keyname
end 
pshy.merge_ModuleBegin("pshy_loopmore.lua")
--- pshy_loopmore.lua
--
-- Triggers an event `eventLoopMore` with higger frequency than the default `eventLoop`.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @namespace pshy
pshy = pshy or {}
--- Module Settings:
pshy.loopmore_call_standard_loop = false			-- if true, call `eventLoop` on `eventLoopOften`
pshy.loopmore_down_keys = {0, 1, 2, 3}				-- keys to listen to when pressed (used to trigger events, not needed if you bind these yourself)
pshy.loopmore_up_keys = {0, 2}						-- keys to listen to when released (used to trigger events, not needed if you bind these yourself)
--- Internal use:
pshy.loopmore_interval = nil						-- interval between calls to `eventLoopMore`
pshy.loopmore_tfm_timers_interval = nil				-- chosen interval for timers
pshy.loopmore_map_start_os_time = nil				-- map start os time
pshy.loopmore_map_end_os_time = nil					-- expected map end os time
pshy.loopmore_last_loopmore_os_time = os.time()		-- last time of last loopmore loop
pshy.loopmore_anticipated_skips = 0					-- @todo used to skip event when there is too many, avoiding calls to os.time()
pshy.loopmore_missing_time = 0						-- as loops may not be 100% accurate, store what time is missing
pshy.loopmore_missed_loops_to_recover = 1.0			-- how many missed loops to recover
pshy.loopmore_timers = {}							-- store timers and timers sync
--system.newTimer ( callback, time, loop, arg1, arg2, arg3, arg4 )
--- Set the loop_more interval.
-- @public
-- @param interval New loop interval (have limitations).
function pshy.loopmore_SetInterval(interval)
	assert(type(interval) == "number")
	assert(interval >= 100)
	assert(interval <= 500)
	pshy.loopmore_interval = interval
	-- destroy timers
	for i_timer, timer in ipairs(pshy.loopmore_timers) do
		system.removeTimer(timer.id)
	end
	pshy.loopmore_timers = {}
	-- choose tfm timers intervals and count
	local tfm_interval = interval
	while tfm_interval < 1000 do
		tfm_interval = tfm_interval + interval
	end
	pshy.loopmore_tfm_timers_interval = tfm_interval
	local timer_count = tfm_interval / interval
	assert(timer_count >= 1)
	assert(timer_count <= 10)
	-- make place for new timers
	for i_timer = 1, timer_count do
		pshy.loopmore_timers[i_timer] = {}
		local timer = pshy.loopmore_timers[i_timer]
		timer.sync_time = interval * (i_timer - 1)
		timer.id = system.newTimer(pshy.loopmore_InitTimerCallback, pshy.loopmore_tfm_timers_interval + timer.sync_time, false, i_timer)
		timer.i_timer = i_timer
	end
end
--- Callback supposed to create the initial timers with different sync times.
-- When this function is called, the timer is recreated to loop in constent time.
function pshy.loopmore_InitTimerCallback(tid, i_timer)
	local timer = pshy.loopmore_timers[i_timer]
	assert(timer.id ~= nil)
	system.removeTimer(timer.id)
	timer.id = system.newTimer(pshy.loopmore_TimerCallback, pshy.loopmore_tfm_timers_interval, true, i_timer)
end
--- Pshy event eventLoopMore.
function eventLoopMore(time, time_remaining)
	if pshy.loopmore_call_standard_loop and eventLoop then
		eventLoop(time, time_remaining)
	end
end
--- Trigger an `eventLoopMore`.
function pshy.loopmore_RunLoopMore()
	-- skip initial times (information missing)
	if not pshy.loopmore_map_start_os_time or not pshy.loopmore_map_end_os_time then
		return
	end
	-- ok, loop
	local os_time = os.time()
	eventLoopMore(os_time - pshy.loopmore_map_start_os_time, pshy.loopmore_map_end_os_time - os_time)
	--if pshy.loopmore_last_loopmore_os_time then
	--	print("duration: " .. tostring(os_time - pshy.loopmore_last_loopmore_os_time))
	--end
	pshy.loopmore_last_loopmore_os_time = os_time
end
--- Timer callback
function pshy.loopmore_TimerCallback(tfmid, id)
	local timer = pshy.loopmore_timers[id]
	--print("timer #" .. tostring(id) .. "/" .. tostring(#pshy.loopmore_timers) .. ": " .. tostring(os.time() % 10000))
	assert(timer ~= nil, "timer #" .. tostring(id) .. "/" .. tostring(#pshy.loopmore_timers) .. ": " .. tostring(os.time() % 10000))
	--timer.sync_time = os.time() % pshy.loopmore_tfm_timers_interval
	pshy.loopmore_RunLoopMore()
end
--- TFM event eventNewGame()
function eventNewGame()
	pshy.loopmore_map_start_os_time = os.time()
	pshy.loopmore_map_end_os_time = nil
	pshy.loopmore_anticipated_skips = 0
end
--- TFM event eventLoop()
function eventLoop(time, time_remaining)
	local os_time = os.time()
	-- eventLoop can also be used to update our information
	pshy.loopmore_map_start_os_time = os_time - time
	pshy.loopmore_map_end_os_time = os_time + time_remaining
	--pshy.loopmore_Check()
end
--- Override of `tfm.exec.setGameTime`.
function pshy.loopmore_setGameTime(time_remaining, init)
	local os_time = os.time()
	if init then
		pshy.loopmore_map_end_os_time = os_time + time_remaining
	elseif pshy.loopmore_map_end_os_time and time_remaining < (pshy.loopmore_map_end_os_time - os_time) then
		pshy.loopmore_map_end_os_time = os_time + time_remaining
	end
	pshy.loopmore_original_setGameTime(time_remaining, init)
end
pshy.loopmore_original_setGameTime = tfm.exec.setGameTime
tfm.exec.setGameTime = pshy.loopmore_setGameTime
--- Initialization:
pshy.loopmore_SetInterval(250)
pshy.merge_ModuleEnd()
pshy.merge_ModuleBegin("pshy_perms.lua")
--- pshy_perms
--
-- This module adds permission functionalities.
--
-- Main features (also check the settings):
--	- `pshy.loader`: The script launcher.
--	- `pshy.admins`: Set of admin names (use `pshy.authors` to add permanent admins).
--	- `pshy.HavePerm(player_name, permission)`: Check if a player have a permission (always true for admins).
--	- `pshy.perms.everyone`: Set of permissions every player have by default.
--	- `pshy.perms.PLAYER#0000`: Set of permissions the player "PLAYER#0000" have.
--
-- Some players are automatically added as admin after the first eventNewGame or after they joined.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @namespace pshy
pshy = pshy or {}
--- Module Settings and Public Members:
pshy.loader = string.match(({pcall(nil)})[2], "^(.-)%.")		-- script loader
pshy.admins = {}												-- set of room admins
pshy.admins[pshy.loader] = true									-- should the loader be an admin
pshy.perms = {}													-- map of players's sets of permissions (a perm is a string, preferably with no ` ` nor `.`, prefer `-`, `/` is reserved for future use)
pshy.perms.everyone = {}										-- set of permissions everyone has
pshy.perms.cheats = {}											-- set of permissions everyone has when cheats are enabled
pshy.perms.admins = {}											-- set of permissions room admins have
pshy.perms_auto_admin_admins = true								-- add the game admins as room admin automatically
pshy.perms_auto_admin_moderators = true							-- add the moderators as room admin automatically
pshy.perms_auto_admin_funcorps = true							-- add the funcorps as room admin automatically (from a list, ask to be added in it)
pshy.funcorps = {}												-- set of funcorps who asked to be added, they can use !adminme
pshy.funcorps["Pshy#3752"] = true
pshy.funcorps["Aurion#8655"] = true
pshy.perms_auto_admin_authors = true							-- add the authors of the final modulepack as admin
pshy.authors = {}												-- set of modulepack authors (add them from your module script)
pshy.authors["Pshy#3752"] = true
pshy.funcorp = (tfm.exec.getPlayerSync() ~= nil)				-- false if tribehouse or non-funcorp, true if funcorp features available
pshy.public_room = (string.sub(tfm.get.room.name, 1, 1) ~= "@")	-- limit admin features in public rooms
pshy.admin_instructions = {}									-- add instructions to admins
pshy.perms_cheats_enabled = false								-- do players have the perms in `pshy.perms.cheats`
--- Help page:
pshy.help_pages = pshy.help_pages or {}						-- touching the help_pages table
pshy.help_pages["pshy_perms"] = {title = "Permissions", text = "Player permissions are stored in sets such as `pshy.perms.Player#0000`.\n`pshy.perms.everyone` contains default permissions.\nRoom admins from the set `pshy.admins` have all permissions.\n", commands = {}}
--- Internal use:
pshy.chat_commands = pshy.chat_commands or {}				-- touching the chat_commands table
--- Check if a player have a permission.
-- @public
-- @param The name of the player.
-- @param perm The permission name.
-- @return true if the player have the required permission.
function pshy.HavePerm(player_name, perm)
	assert(type(perm) == "string", "permission must be a string")
	if player_name == pshy.loader or pshy.admins[player_name] and (pshy.perms.admins[perm] or pshy.perms.cheats[perm]) then
		return true
	end
	if pshy.perms.everyone[perm] or (pshy.perms_cheats_enabled and pshy.perms.cheats[perm]) or (pshy.perms[player_name] and pshy.perms[player_name][perm])then
		return true
	end
	return false
end
--- Add an admin with a reason, and broadcast it to other admins.
-- @private
-- @param new_admin The new room admin's Name#0000.
-- @param reason A message displayed as the reason for the promotion.
function pshy.perms_AddAdmin(new_admin, reason)
	pshy.admins[new_admin] = true
	for an_admin, void in pairs(pshy.admins) do
		tfm.exec.chatMessage("<r>[PshyPerms]</r> " .. new_admin .. " added as a room admin" .. (reason and (" (" .. reason .. ")") or "") .. ".", an_admin)
	end
end
--- Check if a player could me set as admin automatically.
-- @param player_name The player's Name#0000.
-- @return true/false (can become admin), reason
-- @private
function pshy.perms_CanAutoAdmin(player_name)
	if pshy.admins[player_name] then
		return false, "Already Admin"
	elseif player_name == pshy.loader then
		return true, "Script Loader"
	elseif pshy.perms_auto_admin_admins and string.sub(player_name, -5) == "#0001" then
		return true, "Admin &lt;3"
	elseif pshy.perms_auto_admin_moderators and string.sub(player_name, -5) == "#0010" then
		return true, "Moderator"
	elseif pshy.perms_auto_admin_funcorps and pshy.funcorps[player_name] then
		return true, "FunCorp"
	elseif pshy.perms_auto_admin_authors and pshy.authors[player_name] then
		return true, "Author"
	else
		return false, "Not Allowed"
	end
end
--- Check if a player use `!adminme` and notify them if so.
-- @private
-- @param player_name The player's Name#0000.
function pshy.perms_TouchPlayer(player_name)
	local can_admin, reason = pshy.perms_CanAutoAdmin(player_name)
	if can_admin then
		tfm.exec.chatMessage("<r>[PshyPerms]</r> <j>You may set yourself as a room admin (" .. reason .. ").</j>", player_name)
		for instruction in ipairs(pshy.admin_instructions) do
			tfm.exec.chatMessage("<r>[PshyPerms]</r> <fc>" .. instruction .. "</fc>", player_name)
		end
		tfm.exec.chatMessage("<r>[PshyPerms]</r> <j>To become a room admin, use `<fc>!adminme</fc>`</j>", player_name)
		print("[PshyPerms] " .. player_name .. " can join room admins.")
	end
end
--- TFM event eventNewPlayer.
function eventNewPlayer(player_name)
	pshy.perms_TouchPlayer(player_name)
end
--- !admin <NewAdmin#0000>
-- Add an admin in the pshy.admins set.
function pshy.perms_ChatCommandAdmin(user, new_admin_name)
	pshy.admins[new_admin_name] = true
	for admin_name, void in pairs(pshy.admins) do
		tfm.exec.chatMessage("<r>[PshyPerms]</r> " .. user .. " added " .. new_admin_name .. " as room admin.", admin_name)
	end
end
pshy.chat_commands["admin"] = {func = pshy.perms_ChatCommandAdmin, desc = "add a room admin", argc_min = 1, argc_max = 1, arg_types = {"string"}, arg_names = {"Newadmin#0000"}}
pshy.help_pages["pshy_perms"].commands["admin"] = pshy.chat_commands["admin"]
--- !adminme
-- Add yourself as an admin if allowed by the module configuration.
function pshy.perms_ChatCommandAdminme(user)
	local allowed, reason = pshy.perms_CanAutoAdmin(user)
	if allowed then
		pshy.perms_AddAdmin(user, reason)
	else
		return false, reason
	end
end
pshy.chat_commands["adminme"] = {func = pshy.perms_ChatCommandAdminme, desc = "join room admins if allowed", argc_min = 0, argc_max = 0}
pshy.help_pages["pshy_perms"].commands["adminme"] = pshy.chat_commands["adminme"]
pshy.perms.everyone["!adminme"] = true
--- !admins
-- Add yourself as an admin if allowed by the module configuration.
function pshy.perms_ChatCommandAdmins(user)
	local strlist = ""
	for an_admin, is_admin in pairs(pshy.admins) do
		if is_admin then
			if #strlist > 0 then
				strlist = strlist .. ", "
			end
			strlist = strlist .. an_admin
		end
	end
	tfm.exec.chatMessage("<r>[PshyPerms]</r> Script Loader: " .. tostring(pshy.loader), user)
	tfm.exec.chatMessage("<r>[PshyPerms]</r> Room admins: " .. strlist .. ".", user)
end
pshy.chat_commands["admins"] = {func = pshy.perms_ChatCommandAdmins, desc = "see a list of room admins", argc_min = 0, argc_max = 0}
pshy.help_pages["pshy_perms"].commands["admins"] = pshy.chat_commands["admins"]
pshy.perms.everyone["!admins"] = true
--- Pshy event eventInit.
function eventInit()
	for player_name in pairs(tfm.get.room.playerList) do
		pshy.perms_TouchPlayer(player_name)
	end
end
pshy.merge_ModuleEnd()
pshy.merge_ModuleHard("pshy_utils_lua.lua")
--- pshy_utils_lua.lua
--
-- Basic functions related to LUA.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
pshy = pshy or {}
--- string.isalnum(str)
-- us this instead: `not str:match("%W")`
--- Split a string
-- @param str String to split.
-- @param separator Char to split at, default to whitespaces.
-- @param max Max amount of returned strings.
function pshy.StrSplit(str, separator, max)
	assert(type(str) == "string", debug.traceback())
	separator = separator or "%s"
	max = max or -1
	remlen = #str
	local parts = {}
	for part in string.gmatch(str, "([^" .. separator .. "]+)") do
		if max == 1 and remlen >= 0 then
			table.insert(parts, string.sub(str, -remlen))
			return parts
		end
		table.insert(parts, part)
		remlen = remlen - #part - 1
		max = max - 1
	end
	return parts
end
--- Convert a string to a boolean.
-- @param string "true" or "false".
-- @return Boolean true or false, or nil.
function pshy.ToBoolean(value)
	if value == "true" then
		return true
	end
	if value == "false" then
		return false
	end
	return nil
end
--- Convert a string to a boolean (andles yes/no and on/off).
-- @param string "true" or "false".
-- @return Boolean true or false, or nil.
function pshy.ToPermissiveBoolean(value)
	if value == "true" or value == "on" or value == "yes" then
		return true
	end
	if value == "false" or value == "off" or value == "no" then
		return false
	end
	return nil
end
--- Interpret a namespace expression (resolve lua path from string)
-- @param path lua path (such as "tfm.enum.bonus")*
-- @return the object represented by path or nil if not found
function pshy.LuaGet(path)
	assert(type(path) == "string", debug.traceback())
	local parts = pshy.StrSplit(path, ".")
	local cur = _G
	for index, value in pairs(parts) do
		possible_int = tonumber(value)
		value = possible_int or value
		cur = cur[value]
		if cur == nil then
			return nil
		end
	end
	return cur
end
--- Set the value to a lua object.
-- The path is created if it does not exist.
-- @param obj_path Lua path to the object.
-- @param value Value to set, any type.
function pshy.LuaSet(obj_path, value)
	assert(type(obj_path) == "string", debug.traceback())
	local parts = pshy.StrSplit(obj_path, ".")
	local cur = _G
	for i_part, part in pairs(parts) do
		possible_int = tonumber(part)
		part = possible_int or part
		if i_part == #parts then
			-- last iteration
			cur[part] = value
			return cur[part]
		end
		cur[part] = cur[part] or {}
		if type(cur) ~= "table" then
			return nil
		end
		cur = cur[part]
	end
	error("unreachable code")
end
--- Get a random key from a table.
-- @param t The table.
function pshy.LuaRandomTableKey(t)
	local keylist = {}
	for k in pairs(t) do
	    table.insert(keylist, k)
	end
	return keylist[math.random(#keylist)]
end
--- Convert a string value to the given type.
-- nil value is not supported for `string` and `player`.
-- @param value String to convert.
-- @param type string representing the type to convert to.
-- @return The converted value.
-- @todo Should t be a table to represent enum keys?
function pshy.ToType(value, t)
	assert(type(value) == "string", "wrong argument type")
	assert(type(t) == "string", "wrong argument type")
	-- string
	if t == "string" then
		return value
	end
	-- player
	if t == "player" then
		return pshy.FindPlayerName(value)
	end
	-- nil
	if value == "nil" then
		return nil
	end
	-- boolean
	if t == "bool" or t == "boolean" then
		return pshy.ToPermissiveBoolean(value)
	end
	-- number
	if t == "number" then
		return tonumber(value)
	end
	-- hexnumber
	if t == "hexnumber" then
		if str.sub(value, 1, 1) == '#' then
			value = str.sub(value, 2, #value)
		end
		return tonumber(value, 16)
	end
	-- enums
	local enum = pshy.LuaGet(t)
	if type(enum) == "table" then
		return enum[value]
	end
	-- not supported
	error("type not supported")
end
--- Convert an argument to anoter type automatically.
-- @param value String to convert.
-- @return the same value represented by the best type possible (bool/number/string).
function pshy.AutoType(value)
	assert(type(value) == "string", "wrong argument type")
	local rst
	-- nil
	if value == "nil" then
		return nil
	end
	-- boolean
	if value == "true" then
		return true
	end
	if value == "false" then
		return false
	end
	-- number
	rst = tonumber(value, 10)
	if rst then
		return rst
	end
	-- empty table
	if value == "{}" then
		return {}
	end
	-- tfm enums
	rst = pshy.TFMEnumGet(value)
	if rst then
		return rst
	end
	-- lua object
	rst = pshy.LuaGet(value)
	if rst then
		return rst
	end
	-- color code / hex number
	if string.sub(value, 1, 1) == '#' then
		rst = tonumber(string.sub(value, 2, #value), 16)
		if rst then
			return rst
		end
	end
	-- string
	return value
end
pshy.merge_ModuleHard("pshy_utils_math.lua")
--- pshy_utils_math.lua
--
-- Basic math functions.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
pshy = pshy and pshy or {}
--- Distance between points.
-- @return The distance between the points.
function pshy.Distance(x1, y1, x2, y2)
	return math.sqrt((x2 - x1) ^ 2 + (y2 - y1) ^ 2)
end
pshy.merge_ModuleHard("pshy_utils_tfm.lua")
--- pshy_utils_tfm.lua
--
-- Basic functions related to TFM.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
-- @require pshy_perms.lua
-- @require pshy_utils_lua.lua
pshy = pshy or {}
--- Get the display nick of a player.
-- @param player_name The player name.
-- @return either the part of the name before '#' or an entry from `pshy.nicks`.
function pshy.GetPlayerNick(player_name)
	if pshy.nicks and pshy.nicks[player_name] then
		return pshy.nicks[player_name]
	else
		return pshy.StrSplit(player_name, "#", 2)[1]
	end
end
--- Find a player's full Name#0000.
-- @param partial_name The beginning of the player name.
-- @return The player full name or (nil, reason).
-- @todo Search in nicks as well.
function pshy.FindPlayerName(partial_name)
	local player_list = tfm.get.room.playerList
	if player_list[partial_name] then
		return partial_name
	else
		local real_name
		for player_name in pairs(player_list) do
			if string.sub(player_name, 1, #partial_name) == partial_name then
				if real_name then
					return nil, "several players found" -- 2 players have this name
				end
				real_name = player_name
			end
		end
		if pshy.nicks then
			for player_name, nick in pairs(pshy.nicks) do
				if string.sub(nick, 1, #partial_name) == partial_name then
					if real_name then
						return nil, "several players found" -- 2 players have this name
					end
					real_name = player_name
				end
			end
		end
		if not real_name then
			return nil, "player not found"
		end
		return real_name -- found
	end
end
--- Find a player's full Name#0000 or throw an error.
-- @return The player full Name#0000 (or throw an error).
function pshy.FindPlayerNameOrError(partial_name)
	local real_name, reason = pshy.FindPlayerName(partial_name)
	if not real_name then
		error(reason)
	end
	return real_name
end
--- Convert a tfm enum index to an interger, searching in all tfm enums.
-- Search in bonus, emote, ground, particle and shamanObject.
-- @param index a string, either representing a tfm enum value or integer.
-- @return the existing enum value or nil
function pshy.TFMEnumGet(index)
	assert(type(index) == "string")
	local value
	for enum_name, enum in pairs(tfm.enum) do
		value = enum[index]
		if value then
			return value
		end
	end
	return nil
end
--- Get how many players are alive in tfm.get
function pshy.CountPlayersAlive()
	local count = 0
	for player_name, player in pairs(tfm.get.room.playerList) do
		if not player.isDead then
			count = count + 1
		end
	end
	return count
end
pshy.merge_ModuleHard("pshy_utils_tables.lua")
--- pshy_utils_tables.lua
--
-- Basic functions related to LUA tables.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
pshy = pshy or {}
--- Copy a table.
-- @param t The table to copy.
-- @return a copy of the table.
function pshy.TableCopy(t)
	assert(type(t) == "table")
	local new_table = {}
	for key, value in pairs(t) do
		new_table[key] = value
	end
	return new_table
end
--- Copy a table, recursively.
-- @param t The table to copy.
-- @return a copy of the table.
function pshy.TableDeepCopy(t)
	assert(type(t) == "table")
	local new_table = {}
	for key, value in pairs(t) do
		if type(value) == "table" then
			value = pshy.TableDeepCopy(value)
		end
		new_table[key] = value
	end
	return new_table
end
--- Get a table's keys as a list.
-- @public
-- @param t The table.
-- @return A list of the keys from the given table.
function pshy.TableKeys(t)
	local keys
	for key in pairs(t) do
		table.insert(keys, key)
	end
	return keys
end
--- Count the keys in a table.
-- @public
-- @param t The table.
-- @return The count of keys in the given table.
function pshy.TableCountKeys(t)
	local count = 0
	for key, value in pairs(t) do
		count = count + 1	
	end
	return count
end
--- Append a list to another.
-- @param dst_list The list receiving the new items/
-- @param src_list The list containing the items to appen to the other list.
function pshy.ListAppend(dst_list, src_list)
	assert(type(dst_list) == "table")
	assert(type(dst_list) == "table")
	for i_item, item in ipairs(src_list) do
		table.insert(dst_list, item)
	end
end
--- Get a random key from a table.
-- @param t The table.
function pshy.TableGetRandomKey(t)
	local keylist = {}
	for k in pairs(t) do
	    table.insert(keylist, k)
	end
	return keylist[math.random(#keylist)]
end
pshy.merge_ModuleHard("pshy_utils_messages.lua")
--- pshy_utils_messages.lua
--
-- Basic functions related to sending messages to players.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
pshy = pshy or {}
--- Log a message and also display it to the host.
-- @param msg Message to log.
-- @todo This may have to be overloaded by pshy_perms?
function pshy.Log(msg)
	tfm.exec.chatMessage("log: " .. tostring(msg), pshy.loader)
	print("log: " .. tostring(msg))
end
--- Show the dialog window with a message (simplified)
-- @param player_name The player who see the popup.
-- @param message The message the player will see.
function pshy.Popup(player_name, message)
	ui.addPopup(4097, 0, tostring(message), player_name, 40, 20, 720, true)
end
--- Show a html title at the top of the screen.
-- @param html The html to display, or nil to hide.
-- @param player_name The player name to display the title to, or nil for all players.
function pshy.Title(html, player_name)
	html = html or nil
	player_name = player_name or nil
	local title_id = 82 -- arbitrary random id
	if html then
		ui.addTextArea(title_id, html, player_name, 0, 20, 800, nil, 0x000000, 0x000000, 1.0, true)
	else
		ui.removeTextArea(title_id, player_name)
	end
end
pshy.merge_ModuleBegin("pshy_imagedb.lua")
--- pshy_imagedb.lua
--
-- Images available for TFM scripts.
-- Note: I did not made the images, 
-- I only gathered and classified them in this script.
--
-- @author: TFM:Pshy#3752 DC:Pshy#7998 (script)
pshy = pshy or {}
--- Images.
-- Map of images.
-- The key is the image code.
-- The value is a table with the folowing fields:
--	- w: The pixel width of the picture.
--	- h: The pixel height of the picture (default to `w`).
pshy.imagedb_images = {}
-- model
pshy.imagedb_images["00000000000.png"] = {w = nil, h = nil, author = "", desc = ""}
-- pacman (Made by Nnaaaz#0000)
pshy.imagedb_images["17ad578a939.png"] = {pacman = true, w = 45, author = "Nnaaaz#0000", desc = "open pacman"}
pshy.imagedb_images["17ad578c0aa.png"] = {pacman = true, w = 45, author = "Nnaaaz#0000", desc = "closed pacman"}
pshy.imagedb_images["17afe1cf978.png"] = {pacman = true, w = 45, author = "Nnaaaz#0000", desc = "open yellow pac-cheese"}
pshy.imagedb_images["17afe1ce20a.png"] = {pacman = true, w = 45, author = "Nnaaaz#0000", desc = "closed yellow pac-cheese"}
pshy.imagedb_images["17afe2a6882.png"] = {pacman = true, w = 45, author = "Nnaaaz#0000", desc = "open orange pac-cheese"}
pshy.imagedb_images["17afe1d18bc.png"] = {pacman = true, w = 45, author = "Nnaaaz#0000", desc = "closed orange pac-cheese"}
-- pacman fruits (Uploaded by Nnaaaz#0000)
pshy.imagedb_images["17ae46fd894.png"] = {pacman = true, w = 25, desc = "strawberry"}
pshy.imagedb_images["17ae46ff007.png"] = {pacman = true, w = 25, desc = "chicken leg"}
pshy.imagedb_images["17ae4700777.png"] = {pacman = true, w = 25, desc = "burger"}
pshy.imagedb_images["17ae4701ee9.png"] = {pacman = true, w = 25, desc = "rice bowl"}
pshy.imagedb_images["17ae4703658.png"] = {pacman = true, w = 25, desc = "french potatoes"}
pshy.imagedb_images["17ae4704dcc.png"] = {pacman = true, w = 25, desc = "aubergine"}
pshy.imagedb_images["17ae4706540.png"] = {pacman = true, w = 25, desc = "bear candy"}
pshy.imagedb_images["17ae4707cb0.png"] = {pacman = true, w = 25, desc = "butter"}
pshy.imagedb_images["17ae4709422.png"] = {pacman = true, w = 25, desc = "candy"}
pshy.imagedb_images["17ae470ab94.png"] = {pacman = true, w = 25, desc = "bread"}
pshy.imagedb_images["17ae470c307.png"] = {pacman = true, w = 25, desc = "muffin"}
pshy.imagedb_images["17ae470da77.png"] = {pacman = true, w = 25, desc = "raspberry"}
pshy.imagedb_images["17ae470f1e8.png"] = {pacman = true, w = 25, desc = "green lemon"}
pshy.imagedb_images["17ae4710959.png"] = {pacman = true, w = 25, desc = "croissant"}
pshy.imagedb_images["17ae47120dd.png"] = {pacman = true, w = 25, desc = "watermelon"}
pshy.imagedb_images["17ae471383b.png"] = {pacman = true, w = 25, desc = "cookie"}
pshy.imagedb_images["17ae4714fad.png"] = {pacman = true, w = 25, desc = "wrap"}
pshy.imagedb_images["17ae4716720.png"] = {pacman = true, w = 25, desc = "cherry"}
pshy.imagedb_images["17ae4717e93.png"] = {pacman = true, w = 25, desc = "biscuit"}
pshy.imagedb_images["17ae4719605.png"] = {pacman = true, w = 25, desc = "carrot"}
-- emoticons
pshy.imagedb_images["16f56cbc4d7.png"] = {emoticon = true, author = "", w = 29, h = 26, desc = "nausea"}
pshy.imagedb_images["17088661168.png"] = {emoticon = true, author = "", w = 29, h = 26, desc = "cry"}
pshy.imagedb_images["16f5d8c7401.png"] = {emoticon = true, author = "", w = 29, h = 26, desc = "rogue"}
pshy.imagedb_images["16f56ce925e.png"] = {emoticon = true, author = "", desc = "happy cry"}
pshy.imagedb_images["16f56cdf28f.png"] = {emoticon = true, author = "", desc = "wonder"}
pshy.imagedb_images["16f56d09dc2.png"] = {emoticon = true, author = "", desc = "happy cry 2"}
pshy.imagedb_images["178ea94a353.png"] = {emoticon = true, author = "", w = 35, h = 30, desc = "vanlike novoice"}
pshy.imagedb_images["178ea9d3ff4.png"] = {emoticon = true, author = "", desc = "vanlike vomit"}
pshy.imagedb_images["178ea9d5bc3.png"] = {emoticon = true, author = "", desc = "vanlike big eyes"}
pshy.imagedb_images["178ea9d7876.png"] = {emoticon = true, author = "", desc = "vanlike pinklove"}
pshy.imagedb_images["178ea9d947c.png"] = {emoticon = true, author = "", desc = "vanlike eyelove"}
pshy.imagedb_images["178eac181f1.png"] = {emoticon = true, author = "rchl#0000", w = 35, h = 28, desc = "drawing zzz"}
pshy.imagedb_images["178ebdf194a.png"] = {emoticon = true, author = "rchl#0000", desc = "glasses1"}
pshy.imagedb_images["178ebdf317a.png"] = {emoticon = true, author = "rchl#0000", desc = "glasses2"}
pshy.imagedb_images["178ebdf0153.png"] = {emoticon = true, author = "rchl#0000", w = 35, h = 31, desc = "clown"}
pshy.imagedb_images["178ebdee617.png"] = {emoticon = true, author = "rchl#0000", w = 35, h = 31, desc = "vomit"}
pshy.imagedb_images["178ebdf495d.png"] = {emoticon = true, author = "rchl#0000", w = 35, h = 31, desc = "sad"}
pshy.imagedb_images["17aa125e853.png"] = {emoticon = true, author = "rchl#0000", w = 48, h = 48, desc = "sad2"}
pshy.imagedb_images["17aa1265ea4.png"] = {emoticon = true, author = "feverchild#0000", desc = "ZZZ"} -- https://discord.com/channels/246815328103825409/522398576706322454/834007372640419851
pshy.imagedb_images["17aa1264731.png"] = {emoticon = true, author = "feverchild#0000", desc = "no voice"}
pshy.imagedb_images["17aa1bcf1d4.png"] = {emoticon = true, author = "Nnaaaz#0000", w = 60, h = 60, desc = "pro"}
pshy.imagedb_images["17aa1bd3a05.png"] = {emoticon = true, author = "Nnaaaz#0000", w = 60, h = 49, desc = "noob"}
pshy.imagedb_images["17aa1bd0944.png"] = {emoticon = true, author = "Nnaaaz#0000", desc = "pro2"}
pshy.imagedb_images["17aa1bd20b5.png"] = {emoticon = true, author = "Nnaaaz#0000", desc = "noob2"}
-- memes
pshy.imagedb_images["15565dbc655.png"] = {meme = true, desc = "WTF cat"} -- https://atelier801.com/topic?f=6&t=827044&p=1#m14
pshy.imagedb_images["15568238225.png"] = {meme = true, w = 40, h = 40, desc = "FUUU"}
pshy.imagedb_images["155682434d5.png"] = {meme = true, desc = "me gusta"}
pshy.imagedb_images["1556824ac1a.png"] = {meme = true, w = 40, h = 40, desc = "trollface"}
-- TFM
pshy.imagedb_images["155593003fc.png"] = {TFM = true, w = 48, h = 29, desc = "cheese left"}
pshy.imagedb_images["155592fd7d0.png"] = {TFM = true, w = 48, h = 29, desc = "cheese right"}
-- Mario
pshy.imagedb_images["156d7dafb2d.png"] = {mario = true, desc = "mario (undersized)"} -- @TODO: replace whith a properly sized image
pshy.imagedb_images["17aa6f22c53.png"] = {mario = true, w = 27, h = 38, desc = "coin"}
-- Pokemon
--- Search for an image.
-- @private
-- This function is currently for testing only.
-- @param desc Text to find in the image's description.
-- @param category to search in.
-- @return the first image matching the search.
function pshy.imagedb_Search(desc, category)
	for image_name, image in pairs(pshy.imagedb_images) do
		if image.desc and string.find(image.desc, desc) and (not category or image[category]) then
			return image_name
		end
	end
	return nil
end
--- Draw an image (wrapper to tfm.exec.addImage).
-- @public
-- @param image_name The image code (called imageId in te original function).
-- @param target On what game element to attach the image to.
-- @param center_x Center coordinates for the image.
-- @param center_y Center coordinates for the image.
-- @param player_name The player who will see the image, or nil for everyone.
-- @param width Width of the image.
-- @param height Height of the image.
-- @param angle The image's rotation (in radians).
-- @param height Opacity of the image.
-- @return The image ID.
function pshy.imagedb_AddImage(image_name, target, center_x, center_y, player_name, width, height, angle, alpha)
	local image = pshy.imagedb_images[image_name] or pshy.imagedb_images["15568238225.png"]
	target = target or "!0"
	width = width or image.w
	height = height or image.h or image.w
	local x = center_x - width / 2
	local y = center_y - height / 2
	local sx = width / (image.w)
	local sy = height / (image.h or image.w)
	local anchor_x, anchor_y = 0.5, 0.5
	return tfm.exec.addImage(image_name, target, x, y, player_name, sx, sy, angle, alpha, anchor_x, anchor_y)
end
pshy.merge_ModuleEnd()
pshy.merge_ModuleHard("pshy_utils.lua")
--- pshy_utils.lua
--
-- This module gather basic functions.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @hardmerge
-- @namespace pshy
-- @require pshy_keycodes.lua
-- @require pshy_utils_lua.lua
-- @require pshy_utils_math.lua
-- @require pshy_utils_tfm.lua
-- @require pshy_utils_tables.lua
-- @require pshy_utils_messages.lua
pshy = pshy or {}
pshy.merge_ModuleBegin("pshy_bonus.lua")
--- pshy_bonus.lua
--
-- Add custom bonuses.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @namespace pshy
-- @require pshy_imagedb.lua
pshy = pshy or {}
--- Bonus types.
-- @public
-- List of bonus types and informations.
--	- image:	Image to display as the bonus.
--	- func:		Function to call when the bonus is picked.
--				Passed arguments are the player name and the bonus table.
pshy.bonus_types = {}						-- default bonus properties
pshy.bonus_types["pickable_cheese_example"]	= {image = "155593003fc.png", func = tfm.exec.giveCheese}
pshy.bonus_types["pickable_win_example"]	= {image = "17aa6f22c53.png", func = tfm.exec.playerVictory}
pshy.bonus_types["pickable_kill_example"]	= {image = "17ae46ff007.png", func = tfm.exec.killPlayer}
--- Bonus List.
-- Keys: The bonus ids.
-- Values: A table with the folowing fields:
--	- type: Bonus type, as a table.
--	- x: Bonus coordinates.
--	- y: Bonus coordinates.
--	- enabled: Is it enabled by default (true == always, false == never/manual, nil == once only).
pshy.bonus_list	= {}						-- list of ingame bonuses
--- Internal Use:
pshy.bonus_players_image_ids = {}
--- Set the list of bonuses, and show them.
-- @public
function pshy.bonus_SetList(bonus_list)
	pshy.bonus_HideAll()
	pshy.bonus_list = bonus_list
	pshy.bonus_ShowAll()
end
--- Create and enable a bonus.
-- @public
-- Either use this function or `pshy.bonus_SetList`, but not both.
-- @param bonus_type The name or table corresponding to the bonus type.
-- @param bonus_x The bonus location.
-- @param bonus_y The bonus location.
-- @param enabled Is the bonus enabled for all players by default (nil is yes but not for new players).
-- @return The id of the created bonus.
function pshy.bonus_Add(bonus_type, bonus_x, bonus_y, bonus_enabled)
	if type(bonus_type) == "string" then
		assert(pshy.bonus_types[bonus_type], "invalid bonus type " .. tostring(bonus_type))
		bonus_type = pshy.bonus_types[bonus_type]
	end
	assert(type(bonus_type) == "table")
	-- insert
	local new_id = #pshy.bonus_list + 1
	local new_bonus = {id = new_id, type = bonus_type, x = bonus_x, y = bonus_y, enabled = bonus_enabled}
	pshy.bonus_list[new_id] = new_bonus
	-- show
	if bonus_enabled ~= false then
		pshy.bonus_Enable(new_id)
	end
	return new_id
end
--- Enable a bonus.
-- @public
-- When a bonus is enabled, it can be picked by players.
function pshy.bonus_Enable(bonus_id, player_name)
	assert(type(bonus_id) == "number")
	if player_name == nil then
		for player_name in pairs(tfm.get.room.playerList) do
			pshy.bonus_Enable(bonus_id, player_name)
		end
		return
	end
	pshy.bonus_players_image_ids[player_name] = pshy.bonus_players_image_ids[player_name] or {}
	local bonus = pshy.bonus_list[bonus_id]
	local ids = pshy.bonus_players_image_ids[player_name]
	-- if already shown
	if ids[bonus_id] ~= nil then
		pshy.bonus_Hide(bonus_id, player_name)
	end
	-- add bonus
	tfm.exec.addBonus(0, bonus.x, bonus.y, bonus_id, 0, false, player_name)
	-- add image
	--ids[bonus_id] = tfm.exec.addImage(bonus.image or bonus.type.image, "!0", bonus.x - 15, bonus.y - 20, player_name) -- todo: location
	ids[bonus_id] = pshy.imagedb_AddImage(bonus.image or bonus.type.image, "!0", bonus.x, bonus.y, player_name, nil, nil, 0, 1.0)
end
--- Hide a bonus.
-- @public
-- This prevent the bonus from being picked, without deleting it.
function pshy.bonus_Disable(bonus_id, player_name)
	assert(type(bonus_id) == "number")
	if player_name == nil then
		for player_name in pairs(tfm.get.room.playerList) do
			pshy.bonus_Disable(bonus_id, player_name)
		end
		return
	end
	if not pshy.bonus_players_image_ids[player_name] then
		return
	end
	local bonus = pshy.bonus_list[bonus_id]
	local ids = pshy.bonus_players_image_ids[player_name]
	-- if already hidden
	if ids[bonus_id] == nil then
		return
	end
	-- remove bonus
	tfm.exec.removeBonus(bonus_id, player_name)
	-- remove image
	tfm.exec.removeImage(ids[bonus_id], "!0", bonus.x - 15, bonus.y - 20, player_name)
end
--- Show all bonuses, except the ones with `visible == false`.
-- @private
function pshy.bonus_EnableAll(player_name)
	for bonus_id, bonus in pairs(pshy.bonus_list) do
		if not bonus.hidden then
			pshy.bonus_Enable(bonus_id, player_name)
		end
	end
end
--- Disable all bonuses for all players.
-- @private
function pshy.bonus_DisableAll(player_name)
	for bonus_id, bonus in pairs(pshy.bonus_list) do
		pshy.bonus_Disable(bonus_id, player_name)
	end
end
--- TFM event eventPlayerBonusGrabbed.
function eventPlayerBonusGrabbed(player_name, id)
	local bonus = pshy.bonus_list[id]
	-- running the callback
	local func = bonus.func or bonus.type.func
	if func then
		func(player_name, bonus)
	end
	pshy.bonus_Disable(id, player_name)
	-- if callback done then skip other bonus events
	if func then
		return false
	end
end
--- TFM event eventNewGame.
function eventNewGame()
	pshy.bonus_list = {}
	pshy.bonus_players_image_ids = {}
end
--- TFM event eventPlayerrespawn.
function eventPlayerRespawn(player_name)
	for bonus_id, bonus in pairs(pshy.bonus_list) do
		if bonus.enabled == true then
			pshy.bonus_Enable(bonus_id, player_name)
		end
	end
end
--- TFM event eventNewPlayer.
function eventNewPlayer(player_name)
	for bonus_id, bonus in pairs(pshy.bonus_list) do
		if bonus.enabled == true then
			pshy.bonus_Enable(bonus_id, player_name)
		end
	end
end
--- TFM event eventPlayerLeft.
function eventPlayerLeft(player_name)
	pshy.bonus_DisableAll(player_name) -- @todo: is this required?
	pshy.bonus_players_image_ids[player_name] = nil
end
pshy.merge_ModuleEnd()
pshy.merge_ModuleBegin("pshy_commands.lua")
--- pshy_commands.lua
--
-- This module can be used to implement in-game commands.
--
-- To give an idea of what this module makes possible, these commands could be valid:
-- "!luacall tfm.exec.explosion tfm.get.room.playerList.Pshy#3752.x tfm.get.room.playerList.Pshy#3752.y 10 10 true"
-- "!luacall tfm.exec.addShamanObject littleBox 200 300 0 0 0 false"
-- "!luacall tfm.exec.addShamanObject ball tfm.get.room.playerList.Pshy#3752.x tfm.get.room.playerList.Pshy#3752.y 0 0 0 false"
--
-- To add a command 'demo':
--   function my.function.demo(user, arg_int, arg_str)
--       print("hello " .. user .. "! " .. tostring(arg_int) .. tostring(arg_str))
--   end
--   pshy.chat_commands["demo"] = {func = my.function.demo}		-- actually, func is optional
--   pshy.chat_commands["demo"].desc = "my demo function"		-- short description
--   pshy.chat_commands["demo"].no_user = false			-- true to not pass the command user as the 1st arg
--   pshy.chat_commands["demo"].argc_min = 1				-- need at least 1 arg	
--   pshy.chat_commands["demo"].argc_max = 2				-- max args (remaining args will be considered a single one)
--   pshy.chat_commands["demo"].arg_types = {"int", "string"}	-- omit for auto (also interpret lua.path.to.value)
--   pshy.chat_commands["demo"].help = "longer help message to detail how this command works"
--   pshy.chat_command_aliases["ddeemmoo"] = "demo"			-- create an alias
--
-- This submodule add the folowing commands:
--   !help [command]				- show general or command help
--
-- @author DC: Pshy#7998
-- @namespace pshy
-- @require pshy_utils.lua
-- @require pshy_perms.lua
pshy = pshy or {}
--- Module Settings:
pshy.commands_require_prefix = false		-- if true, all commands must start with `!pshy.`
--- Chat commands lists
-- keys represent the lowecase command name.
-- values are tables with the folowing fields:
-- - func: the function to run
--   the functions will take the player name as the first argument, 
--   then the remaining ones.
-- - help: the help string to display when querying for help.
-- - arg_types: an array the argument types (not including the player name).
--   if arg_types is undefined then this is determined automatically.
-- - arg_names: 
-- - no_user: true if the called function doesnt take the command user as
--   a first argument.
pshy.chat_commands = pshy.chat_commands or {}
pshy.commands = pshy.chat_commands					-- seek to replace chat_commands by this
--- Map of command aliases (string -> string)
pshy.chat_command_aliases = pshy.chat_command_aliases or {}
pshy.commands_aliases = pshy.chat_command_aliases	-- seek to replace chat_command_aliases by this
--- Get a command target player or throw on permission issue.
-- This function can be used to check if a player can run a command on another one.
-- @private
function pshy.commands_GetTargetOrError(user, target, perm_prefix)
	assert(type(perm_prefix) == "string")
	if not target then
		return user
	end
	if target == user then
		return user
	elseif not pshy.HavePerm(user, perm_prefix .. "-others") then
		error("you cant use this command on other players :c")
		return
	end
	return target
end
--- Get the real command name
-- @private
-- @param alias_name Command name or alias without `!`.
function pshy.commands_ResolveAlias(alias_name)
	while not pshy.commands[alias_name] and pshy.commands_aliases[alias_name] do
		alias_name = pshy.commands_aliases[alias_name]
	end
	return alias_name
end
--- Get a chat command by name
-- @private
-- @param alias_name Can be the command name or an alias, without `!`.
function pshy.commands_Get(alias_name)
	return (pshy.chat_commands[pshy.commands_ResolveAlias(alias_name)])
end
--- Get a command usage.
-- @private
-- The returned string represent how to use the command.
-- @param cmd_name The name of the command.
-- @return HTML text for the command's usage.
function pshy.commands_GetUsage(cmd_name)
	local text = "!" .. cmd_name
	local real_command = pshy.commands_Get(cmd_name)
	local min = real_command.argc_min or 0
	local max = real_command.argc_max or min
	if max > 0 then
		for i = 1, max do
			text = text .. " " .. ((i <= min) and "&lt;" or "[")
			if real_command.arg_types and i <= #real_command.arg_types then
				text = text .. real_command.arg_types[i]
			else
				text = text .. "?"
			end
			if real_command.arg_names and i <= #real_command.arg_names then
				text = text .. ":" .. real_command.arg_names[i]
			end
			text = text .. ((i <= min) and "&gt;" or "]")
		end
	end
	if not real_command.argc_max then
		text = text .. " [...]"
	end
	return text
end
--- Rename a command and set the old name as an alias.
-- @private
-- @deprecated
function pshy.RenameChatCommand(old_name, new_name, keep_previous)
	print("Used deprecated pshy.RenameChatCommand")
	if old_name == new_name or not pshy.chat_commands[old_name] then
		print("[PshyCmds] Warning: command not renamed!")
	end
	if keep_previous then
		pshy.chat_command_aliases[old_name] = new_name
	end
	pshy.chat_commands[new_name] = pshy.chat_commands[old_name]
	pshy.chat_commands[old_name] = nil
end
--- Convert string arguments of a table to the specified types, 
-- or attempt to guess the types.
-- @private
-- @param args Table of elements to convert.
-- @param types Table of types.
-- @return true or (false, reason)
function pshy.commands_ConvertArgs(args, types)
	local reason
	local has_multiple_players = false
	for index = 1, #args do
		if (not types) or index > #types or types[index] == nil then
			-- automatic conversion
			args[index] = pshy.AutoType(args[index])
		elseif type(types[index]) == "function" then
			-- a function is used for conversion
			args[index], reason = types[index](args[index])
			if args[index] == nil then
				return false, (reason or ("wrong type for argument " .. tostring(index) .. ", conversion function returned `nil`"))
			end
		elseif types[index] == 'player' and args[index] == '*' then
			if has_multiple_players then
				return false, "only a single '*' argument may represent all the players"
			end
			has_multiple_players = true
		else
			-- using pshy.ToType with the given type string
			args[index], reason = pshy.ToType(args[index], types[index])
			if reason ~= nil then
				return false, reason
			end
			if args[index] == nil then
				return false, "wrong type for argument " .. tostring(index) .. ", expected " .. types[index]
			end
		end
	end
	return true
end
--- Run a command as a player.
-- @param user The Name#0000 of the player running the command.
-- @param command_str The full command the player have input, without "!".
-- @return false on permission failure, true if handled and not to handle, nil otherwise
function pshy.commands_Run(user, command_str)
	assert(type(user) == "string")
	assert(type(command_str) == "string")
	-- log non-admin players commands use
	if not pshy.admins[user] then
		print("[PshyCmds] " .. user .. ": !" .. command_str)
	end
	local had_prefix = false
	-- remove 'pshy.' prefix
	-- @todo This is now obsolete
	if #command_str > 5 and string.sub(command_str, 1, 5) == "pshy." then
		command_str = string.sub(command_str, 6, #command_str)
		had_prefix = true
		tfm.exec.chatMessage("[PshyCmds] <j>The `!pshy.` prefix is now deprecated, please use the `!pshy` command instead.</j>", user)
	elseif pshy.commands_require_prefix then
		tfm.exec.chatMessage("[PshyCmds] Ignoring commands without a `!pshy.` prefix.", user)
		return
	end
	-- get command
	local args = pshy.StrSplit(command_str, " ", 2)
	return pshy.commands_RunArgs(user, args[1], args[2])
end
--- Run a command (with separate arguments) as a player.
-- @param user The Name#0000 of the player running the command.
-- @param command_name The name of the command used.
-- @param args_str A string corresponding to the argument part of the command.
-- @return false on permission failure, true if handled and not to handle, nil otherwise
function pshy.commands_RunArgs(user, command_name, args_str)
	local final_command_name = pshy.commands_ResolveAlias(command_name)
	-- disallowed command
	if not pshy.HavePerm(user, "!" .. final_command_name) then
		tfm.exec.chatMessage("<r>[PshyCmds] You cannot use this command :c</r>", user)
		return false
	end
	local command = pshy.commands_Get(command_name)
	-- non-existing command
	local command = pshy.commands_Get(command_name)
	if not command then
		if had_prefix then
			tfm.exec.chatMessage("<r>[PshyCmds] Unknown pshy command.</r>", user)
			return false
		else
			tfm.exec.chatMessage("[PshyCmds] Another module may handle that command.", user)
			return nil
		end
	end
	-- get args
	args = args_str and pshy.StrSplit(args_str, " ", command.argc_max or 32) or {} -- max command args set to 32 to prevent abuse
	--table.remove(args, 1)
	-- missing arguments
	if command.argc_min and #args < command.argc_min then
		--tfm.exec.chatMessage("<r>[PshyCmds] This command require " .. command.argc_min .. " arguments.</r>", user)
		tfm.exec.chatMessage("<r>[PshyCmds] Usage: " .. pshy.commands_GetUsage(final_command_name) .. "</r>", user)
		return false
	end
	-- too many arguments
	if command.argc_max == 0 and args_str ~= nil then
		tfm.exec.chatMessage("<r>[PshyCmds] This command do not use arguments.</r>", user)
		return false
	end
	-- multiple players args
	local multiple_players_index = nil
	if command.arg_types then
		for i_type, type in ipairs(command.arg_types) do
			if type == "player" and args[i_type] == '*' then
				multiple_players_index = i_type
			end
		end
	end
	-- convert arguments
	local rst, rtn = pshy.commands_ConvertArgs(args, command.arg_types)
	if not rst then
		tfm.exec.chatMessage("<r>[PshyCmds] " .. tostring(rtn) .. ".</r>", user)
		return not had_prefix
	end
	-- runing
	local pcallrst, rst, rtn
	if multiple_players_index then
		-- command affect all players
		for player_name in pairs(tfm.get.room.playerList) do
			args[multiple_players_index] = player_name
			if not command.no_user then
				pcallrst, rst, rtn = pcall(command.func, user, table.unpack(args))
			else
				pcallrst, rst, rtn = pcall(command.func, table.unpack(args))
			end
			if pcallrst == false or rst == false then 
				break
			end
		end
	else
		-- standard		
		if not command.no_user then
			pcallrst, rst, rtn = pcall(command.func, user, table.unpack(args))
		else
			pcallrst, rst, rtn = pcall(command.func, table.unpack(args))
		end
	end
	-- error handling
	if pcallrst == false then
		-- pcall failed
		tfm.exec.chatMessage("<r>[PshyCmds] Command failed: " .. rst .. "</r>", user)
	elseif rst == false then
		-- command function returned false
		tfm.exec.chatMessage("<r>[PshyCmds] " .. rtn .. "</r>", user)
	end
end
--- !pshy <command>
-- Run a pshy command.
function pshy.commands_CommandPshy(user, command)
	if command then
		pshy.commands_Run(user, command)
	else
		pshy.commands_Run(user, "help")
	end
end
pshy.commands["pshy"] = {func = pshy.commands_CommandPshy, desc = "run a command listed in `pshy.commands`", argc_min = 0, argc_max = 1, arg_types = {"string"}}
pshy.commands_aliases["pshycmd"] = "pshy"
pshy.perms.everyone["!pshy"] = true
--- TFM event eventChatCommand.
function eventChatCommand(player_name, message)
	return pshy.commands_Run(player_name, message)
end
pshy.merge_ModuleEnd()
pshy.merge_ModuleBegin("pshy_ui.lua")
--- pshy_ui.lua
--
-- Module simplifying ui creation.
-- Every ui is represented by a pshy ui table storing its informations.
--
-- @author Pshy
-- @namespace pshy
-- @require pshy_commands.lua
-- @require pshy_utils.lua
pshy = pshy or {}
-- ui.addTextArea (id, text, targetPlayer, x, y, width, height, backgroundColor, borderColor, backgroundAlpha, fixedPos)
-- ui.updateTextArea (id, text, targetPlayer)
-- ui.removeTextArea (id, targetPlayer)
--
-- ui.addPopup (id, type, text, targetPlayer, x, y, width, fixedPos)
-- ui.showColorPicker (id, targetPlayer, defaultColor, title)
--
-- <p align='center'><font color='#badb2f' size='24' face='Soopafresh'>Help</font></p><br>hejsfsejh<u></u><i></i><b></b>
--- Create a pshy ui
function pshy.UICreate(text)
	local ui = {}
	ui.id = 2049
	ui.text = text or "<b>New Control</b>"
	ui.player = nil
	ui.x = 50
	ui.y = 50
	ui.w = nil --700
	ui.h = nil --500
	--ui.back_color = 0x010101
	--ui.border_color = 0xffff00
	ui.alpha = 1.0
	ui.fixed = true
	return ui
end
--- Show a pshy ui
function pshy.UIShow(u, player_name)
	ui.addTextArea(u.id, u.text, player_name or u.player, u.x, u.y, u.w, u.h, u.back_color, u.border_color, u.alpha, u.fixed)
end
--- TFM text area click
-- events are separated by a '\n', so a single click can trigger several events.
-- events close, closeall, pcmd and cmd are hardcoded
function eventTextAreaCallback(textAreaId, playerName, callback)
	callbacks = pshy.StrSplit(callback, "\n")
	for i_c, c in ipairs(callbacks) do
		-- close callback
		if (c == "close") then
			ui.removeTextArea(textAreaId, playerName)
		end
		-- closeall callback
		if (c == "closeall") then
			if pshy.admins[playerName] then
				ui.removeTextArea(textAreaId, nil)
			end
		end
		-- pcmd callback
		if (string.sub(c, 1, 5) == "pcmd ") then
			pshy.commands_Run(playerName, pshy.StrSplit(c, " ", 2)[2])
		end
		-- apcmd callback
		if (string.sub(c, 1, 6) == "apcmd ") then
			if pshy.admins[playerName] then
				pshy.commands_Run(playerName, pshy.StrSplit(c, " ", 2)[2])
			else
				return
			end
		end
		-- cmd callback
		if (string.sub(c, 1, 4) == "cmd ") then
			eventChatCommand(playerName, pshy.StrSplit(c, " ", 2)[2])
			eventChatMessage(playerName, "!" .. pshy.StrSplit(c, " ", 2)[2])
		end
	end
end
--- TFM event eventChatMessage
-- This is just to touch the event so it exists.
function eventChatMessage(player_name, message)	
end
pshy.merge_ModuleEnd()
pshy.merge_ModuleHard("pshy_help.lua")
--- pshy_help.lua
--
-- Add a help commands and in-game help functionalities.
--
-- @author tfm:Pshy#3752
-- @hardmerge
-- @require pshy_commands.lua
-- @require pshy_ui.lua
--- Help pages.
-- Key is the name page.
-- Value is the help table (help page).
-- Help pages fields:
--	string:back		- upper page.
--	string:title		- title of the page.
--	string:text		- text to display at the top of the page.
--	set:commands		- set of chat command names.
--	set:examples		- map of action (string) -> command (string) (click to run).
--	set:subpages		- set of pages to be listed in that one at the bottom.
--	bool:restricted	- if true, require the permission "!help page_name"
pshy.help_pages = pshy.help_pages or {}
--- Main help page (`!help`).
-- This page describe the help available.
pshy.help_pages[""] = {title = "Main Help", text = "This page list the available help pages.\n", subpages = {}}
pshy.help_pages["pshy"] = {back = "", title = "Pshy Modules (pshy_*)", text = "You may optionaly prefix pshy's commands by `pshy.`\n", subpages = {}}
pshy.help_pages[""].subpages["pshy"] = pshy.help_pages["pshy"]
--- Get a chat command desc text.
-- @param chat_command_name The name of the chat command.
function pshy.GetChatCommandDesc(chat_command_name)
	local cmd = pshy.chat_commands[chat_command_name]
	local desc = cmd.desc or "no description"
	return desc
end
--- Get a chat command help html.
-- @param chat_command_name The name of the chat command.
function pshy.GetChatCommandHelpHtml(command_name)
	local real_command = pshy.GetChatCommand(command_name)
	local html = "<j><i><b>"
	-- usage
	local html = html .. pshy.commands_GetUsage(command_name)
	-- short description
	html = html .. "</b></i>\t - " .. (real_command.desc and tostring(real_command.desc) or "no description")
	-- help + other info
	if real_command.help then
		html = html .. "\n" .. real_command.help
	end
	if not real_command.func then
		html = html .. "\nThis command is not handled by pshy_commands."
	end
	html = html .. "</j>"
	return html
end
--- Get html things to add before and after a command to display it with the right color.
function pshy.help_GetPermColorMarkups(perm)
	if pshy.perms.everyone[perm] then
		return "<v>", "</v>"
	elseif pshy.perms.cheats[perm] then
		return "<j>", "</j>"
	elseif pshy.perms.admins[perm] then
		return "<r>", "</r>"
	else
		return "<vi>", "</vi>"
	end
end
--- Get the html to display for a page.
function pshy.GetHelpPageHtml(page_name, is_admin)
	local page = pshy.help_pages[page_name]
	page = page or pshy.help_pages[""]
	local html = ""
	-- title menu
	local html = "<p align='right'>"
	html = html .. " <bl><a href='event:pcmd help " .. (page.back or "") .. "'>[ &lt; ]</a></bl>"
	html = html .. " <r><a href='event:close'>[ X ]</a></r>"
	html = html .. "</p>"
	-- title
	html = html .. "<p align='center'><font size='16'>" .. (page.title or page_name) .. '</font></p>\n'
	-- restricted ?
	if page.restricted and not is_admin then
		html = html .. "<p align='center'><font color='#ff4444'>Access to this page is restricted.</font></p>\n"
		return html
	end
	-- text
	html = html .. "<p align='center'>" .. (page.text or "") .. "</p>"
	-- commands
	if page.commands then
		html = html .. "<bv><p align='center'><font size='16'>Commands" .. "</font></p>\n"
		for cmd_name, cmd in pairs(page.commands) do
			local m1, m2 = pshy.help_GetPermColorMarkups("!" .. cmd_name)
			--html = html .. '!' .. ex_cmd .. "\t - " .. (cmd.desc or "no description") .. '\n'
			html = html .. m1
			--html = html .. "<u><a href='event:pcmd help " .. cmd_name .. "'>" .. pshy.commands_GetUsage(cmd_name) .. "</a></u>"
			html = html .. "<u>" .. pshy.commands_GetUsage(cmd_name) .. "</u>"
			html = html .. m2
			html = html .. "\t - " .. (cmd.desc or "no description") .. "\n"
		end
		html = html .. "</bv>\n"
	end
	-- examples
	if page.examples then
		html = html .. "<rose><p align='center'><font size='16'>Examples" .. "</font> (click to run)</p>\n"
		for ex_cmd, ex_desc in pairs(page.examples) do
			--html = html .. "!" .. ex_cmd .. "\t - " .. ex_desc .. '\n' 
			html = html .. "<j><i><a href='event:cmd " .. ex_cmd .. "'>!" .. ex_cmd .. "</a></i></j>\t - " .. ex_desc .. '\n' 
		end
		html = html .. "</rose>\n"
	end
	-- subpages
	if page.subpages then
		html = html .. "<ch><p align='center'><font size='16'>Subpages:" .. "</font></p>\n<p align='center'>"
		for subpage_name, subpage in pairs(page.subpages) do
			--html = html .. subpage .. '\n'
			if subpage and subpage.title then
				html = html .. "<u><a href='event:pcmd help " .. subpage_name .. "'>" .. subpage.title .. "</a></u>\n"
			else
				html = html .. "<u><a href='event:pcmd help " .. subpage_name .. "'>" .. subpage_name .. "</a></u>\n" 
			end
		end
		html = html .. "</p></ch>"
	end
	return html
end
--- !help [command]
-- Get general help or help about a specific page/command.
function pshy.ChatCommandHelp(user, page_name)
	if page_name == nil then
		html = pshy.GetHelpPageHtml(nil)
	elseif string.sub(page_name, 1, 1) == '!' then
		html = pshy.GetChatCommandHelpHtml(string.sub(page_name, 2, #page_name))
		tfm.exec.chatMessage(html, user)
		return true
	elseif pshy.help_pages[page_name] then
		html = pshy.GetHelpPageHtml(page_name, pshy.HavePerm(user, "!help " .. page_name))
	elseif pshy.chat_commands[page_name] then
		html = pshy.GetChatCommandHelpHtml(page_name)
		tfm.exec.chatMessage(html, user)
		return true
	else
		html = pshy.GetHelpPageHtml(page_name)
	end
	html = "<font size='12' color='#ddffdd'><b>" .. html .. "</b></font>"
	if #html > 2000 then
		error("#html is too big: == " .. tostring(#html))
	end
	local ui = pshy.UICreate(html)
	ui.x = 100
	ui.y = 50
	ui.w = 600
	--ui.h = 440
	ui.back_color = 0x003311
	ui.border_color = 0x77ff77
	ui.alpha = 0.9
	pshy.UIShow(ui, user)
	return true
end
pshy.chat_commands["help"] = {func = pshy.ChatCommandHelp, desc = "list pshy's available commands", argc_min = 0, argc_max = 1, arg_types = {"string"}}
pshy.perms.everyone["!help"] = true
--- Pshy event eventInit
function eventInit()
	-- other page
	pshy.help_pages["other"] = {title = "Other Pages", subpages = {}}
	for page_name, help_page in pairs(pshy.help_pages) do
		if not help_page.back then
			pshy.help_pages["other"].subpages[page_name] = help_page
		end
	end
	pshy.help_pages["pshy"].subpages["other"] = pshy.help_pages["other"]
	-- all page
	pshy.help_pages["all"] = {title = "All Pages", subpages = {}}
	for page_name, help_page in pairs(pshy.help_pages) do
		pshy.help_pages["all"].subpages[page_name] = help_page
	end
	pshy.help_pages["pshy"].subpages["all"] = pshy.help_pages["all"]
end
pshy.merge_ModuleBegin("pshy_scores.lua")
--- pshy_scores.lua
--
-- Provide customisable player scoring.
-- Adds an event "eventPlayerScore(player_name, points)".
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @namespace pshy
-- @require pshy_commands.lua
-- @require pshy_utils.lua
-- @require pshy_ui.lua
-- @require pshy_help.lua
--- TFM Settings
tfm.exec.disableAutoScore(true)
--- Module Help Page.
pshy.help_pages["pshy_scores"] = {back = "pshy", title = "Scores", text = "This module allows to customize how players make score points.\n", commands = {}}
pshy.help_pages["pshy"].subpages["pshy_scores"] = pshy.help_pages["pshy_scores"]
--- Module Settings.
pshy.scores_per_win = 0								-- points earned per wins
pshy.scores_per_first_wins = {}						-- points earned by the firsts to win
--pshy.scores_per_first_wins[1] = 1					-- points for the very first
pshy.scores_per_cheese = 0							-- points earned per cheese touched
pshy.scores_per_first_cheeses = {}					-- points earned by the firsts to touch the cheese
pshy.scores_per_death = 0							-- points earned by death
pshy.scores_per_first_deaths = {}					-- points earned by the very first to die
pshy.scores_survivors_win = false					-- this round is a survivor round (players win if they survive) (true or the points for surviving)
pshy.scores_ui_arbitrary_id = 2918					-- arbitrary ui id
pshy.scores_show = true								-- show stats for the map
pshy.scores_per_bonus = 0							-- points earned by gettings bonuses of id <= 0
pshy.scores_reset_on_leave = true					-- reset points on leave
--- Internal use.
pshy.scores = {}						-- total scores points per player
pshy.scores_firsts_win = {}				-- total firsts points per player
pshy.scores_round_wins = {}				-- current map's first wins
pshy.scores_round_cheeses = {}			-- current map's first cheeses
pshy.scores_round_deaths = {}			-- current map's first deathes
pshy.scores_round_ended = true			-- the round already ended (now counting survivors, or not counting at all)
pshy.scores_should_update_ui = false	-- if true, scores ui have to be updated
--- pshy event eventPlayerScore
-- Called when a player earned points according to the module configuration.
function eventPlayerScore(player_name, points)
	tfm.exec.setPlayerScore(player_name, pshy.scores[player_name], false)
end
--- Give points to a player
function pshy.ScoresAdd(player_name, points)
	pshy.scores[player_name] = pshy.scores[player_name] + points
	eventPlayerScore(player_name, points)
end
pshy.scores_Add = pshy.ScoresAdd
--- Give points to a player
function pshy.scores_Set(player_name, points)
	pshy.scores[player_name] = points
	tfm.exec.setPlayerScore(player_name, pshy.scores[player_name], false)
end
--- Update the top players scores ui
-- @player_name optional player who will see the changes
function pshy.ScoresUpdateRoundTop(player_name)
	if ((#pshy.scores_round_wins + #pshy.scores_round_cheeses + #pshy.scores_round_deaths) == 0) then
		return
	end
	local text = "<font size='10'><p align='left'>"
	if #pshy.scores_round_wins > 0 then
		text = text .. "<font color='#ff0000'><b> First Win: " .. pshy.scores_round_wins[1] .. "</b></font>\n"
	end
	if #pshy.scores_round_cheeses > 0 then
		text = text .. "<d><b> First Cheese: " .. pshy.scores_round_cheeses[1] .. "</b></d>\n"
	end
	if #pshy.scores_round_deaths > 0 then
		text = text .. "<bv><b> First Death: " .. pshy.scores_round_deaths[1] .. "</b></bv>\n"
	end
	text = text .. "</p></font>"
	local title = pshy.UICreate(text)
	title.id = pshy.scores_ui_arbitrary_id
	title.x = 810
	title.y = 30
	title.w = nil
	title.h = nil
	title.back_color = 0
	title.border_color = 0
	pshy.UIShow(title, player_name)
end
--- Reset a player scores
function pshy.ScoresResetPlayer(player_name)
	assert(type(player_name) == "string")
	pshy.scores[player_name] = 0
	pshy.scores_firsts_win[player_name] = 0
	tfm.exec.setPlayerScore(player_name, 0, false)
end
--- Reset all players scores
function pshy.ScoresResetPlayers()
	pshy.scores = {}
	for player_name, player in pairs(tfm.get.room.playerList) do
		pshy.ScoresResetPlayer(player_name)
	end
end
--- TFM event eventNewGame
function eventNewGame()
	pshy.scores_round_wins = {}
	pshy.scores_round_cheeses = {}
	pshy.scores_round_deaths = {}
	pshy.scores_round_ended = false
	pshy.scores_should_update_ui = false
	ui.removeTextArea(pshy.scores_ui_arbitrary_id, nil)
end
--- TFM event eventLoop
function eventLoop(time, time_remaining)
	-- update score if needed
	if pshy.scores_show and pshy.scores_should_update_ui then
		pshy.ScoresUpdateRoundTop()
		pshy.scores_should_update_ui = false
	end
	-- make players win at the end of survivor rounds
	if time_remaining < 1000 and pshy.scores_survivors_win ~= false then
		pshy.scores_round_ended = true
		for player_name, player in pairs(tfm.get.room.playerList) do
			tfm.giveCheese(player_name, true)
			tfm.playerVictory(player_name)
		end
	end
end
--- TFM event eventPlayerDied
function eventPlayerDied(player_name)
	if not pshy.scores_round_ended then
		local points = pshy.scores_per_death
		table.insert(pshy.scores_round_deaths, player_name)
		local rank = #pshy.scores_round_deaths
		if pshy.scores_per_first_deaths[rank] then
			points = points + pshy.scores_per_first_deaths[rank]
		end
		if points ~= 0 then
			pshy.ScoresAdd(player_name, points)
		end
	end
	pshy.scores_should_update_ui = true
end
--- TFM event eventPlayerGetCheese
function eventPlayerGetCheese(player_name)
	if not pshy.scores_round_ended then
		local points = pshy.scores_per_cheese
		table.insert(pshy.scores_round_cheeses, player_name)
		local rank = #pshy.scores_round_cheeses
		if pshy.scores_per_first_cheeses[rank] then
			points = points + pshy.scores_per_first_cheeses[rank]
		end
		if points ~= 0 then
			pshy.ScoresAdd(player_name, points)
		end
	end
	pshy.scores_should_update_ui = true
end
--- TFM event eventPlayerLeft
function eventPlayerLeft(player_name)
	if pshy.scores_reset_on_leave then
		pshy.scores[player_name] = 0
	end
end
--- TFM event eventPlayerWon
function eventPlayerWon(player_name, time_elapsed)
	local points = 0
	if pshy.scores_round_ended and pshy.scores_survivors_win ~= false then
		-- survivor round
		points = points + ((pshy.scores_survivors_win == true) and pshy.scores_per_win or pshy.scores_survivors_win)
	elseif not pshy.scores_round_ended then
		-- normal
		points = points + pshy.scores_per_win
		table.insert(pshy.scores_round_wins, player_name)
		local rank = #pshy.scores_round_wins
		if pshy.scores_per_first_wins[rank] then
			points = points + pshy.scores_per_first_wins[rank]
		end
		if rank == 1 then
			pshy.scores_firsts_win[player_name] = pshy.scores_firsts_win[player_name] + points
		end
	end
	if points ~= 0 then
		pshy.ScoresAdd(player_name, points)
	end
	pshy.scores_should_update_ui = true
end
--- TFM event eventPlayerBonusGrabbed
function eventPlayerBonusGrabbed(player_name, bonus_id)
	if pshy.scores_per_bonus ~= 0 then
		pshy.ScoresAdd(player_name, pshy.scores_per_bonus)
	end
end
--- TFM event eventNewPlayer
function eventNewPlayer(player_name)
	if not pshy.scores[player_name] then
		pshy.ScoresResetPlayer(player_name)
	else
		tfm.exec.setPlayerScore(player_name, pshy.scores[player_name], false)
	end
end
--- Initialization
pshy.ScoresResetPlayers()
pshy.merge_ModuleEnd()
pshy.merge_ModuleHard("pshy_lua_commands.lua")
--- Pshy basic commands module
--
-- This submodule add the folowing commands:
--   !(lua)get <path.to.variable>					- get a lua value
--   !(lua)set <path.to.variable> <new_value>		- set a lua value
--   !(lua)setstr <path.to.variable> <new_value>	- set a lua string value
--   !(lua)call <path.to.function> [args...]		- call a lua function
--
-- Additionally, when using the pshy_perms module:
--   !addadmin NewAdmin#0000			- add NewAdmin#0000 as an admin
--      equivalent `!luaset pshy.admins.NewAdmin#0000 true`
--
-- Additionally, this add a command per function in tfm.exec.
--
-- @author Pshy
-- @hardmerge
-- @namespace pshy
-- @require pshy_commands.lua
-- @require pshy_help.lua
--- Module Help Page:
pshy.help_pages["pshy_lua_commands"] = {back = "pshy", title = "Lua Commands", text = "Commands to interact with lua.\n", examples = {}}
pshy.help_pages["pshy_lua_commands"].commands = {}
pshy.help_pages["pshy_lua_commands"].examples["luacall tfm.exec.respawnPlayer " .. pshy.loader] = "Respawn " .. pshy.loader .. "."
pshy.help_pages["pshy_lua_commands"].examples["luacall tfm.exec.movePlayer Player#0000 tfm.get.room.playerList." .. pshy.loader .. ".x" .. "  tfm.get.room.playerList." .. pshy.loader .. ".y"] = "Teleport Player#0000 to yourself."
pshy.help_pages["pshy"].subpages["pshy_lua_commands"] = pshy.help_pages["pshy_lua_commands"]
--- Internal Use:
pshy.rst1 = nil		-- store the first return of !call
pshy.rst2 = nil		-- store the second result of !call
--- !luaget <path.to.object>
-- Get the value of a lua object.
function pshy.ChatCommandLuaget(user, obj_name)
	assert(type(obj_name) == "string")
	local obj = pshy.LuaGet(obj_name)
	local result
	if type(obj) == "string" then
		result = obj_name .. " == \"" .. tostring(obj) .. "\""
	elseif type(obj) == "table" then
		result = "{"
		local cnt = 0
		for key, value in pairs(obj) do
			result = result .. ((cnt > 0) and "," or "") .. tostring(key)
			cnt = cnt + 1
			if cnt >= 16 then
				result = result .. ",[...]"
				break
			end
		end
		result = result .. "}"
	else
		result = obj_name .. " == " .. tostring(obj)
	end
	tfm.exec.chatMessage(result, user)
end
pshy.chat_commands["luaget"] = {func = pshy.ChatCommandLuaget, desc = "get a lua object value", argc_min = 1, argc_max = 1, arg_types = {"string"}}
pshy.chat_command_aliases["get"] = "luaget"
pshy.help_pages["pshy_lua_commands"].commands["luaget"] = pshy.chat_commands["luaget"]
pshy.perms.admins["!luaget"] = true
--- !luaset <path.to.object> <new_value>
-- Set the value of a lua object.
function pshy.ChatCommandLuaset(user, obj_path, obj_value)
	pshy.LuaSet(obj_path, pshy.AutoType(obj_value))
	pshy.ChatCommandLuaget(user, obj_path)
end
pshy.chat_commands["luaset"] = {func = pshy.ChatCommandLuaset, desc = "set a lua object value", argc_min = 2, argc_max = 2, arg_types = {"string", "string"}}
pshy.chat_command_aliases["set"] = "luaset"
pshy.help_pages["pshy_lua_commands"].commands["luaset"] = pshy.chat_commands["luaset"]
--- !luasetstr <path.to.object> <new_value>
-- Set the string value of a lua object.
function pshy.ChatCommandLuasetstr(user, obj_path, obj_value)
	obj_value = string.gsub(string.gsub(obj_value, "&lt;", "<"), "&gt;", ">")
	pshy.LuaSet(obj_path, obj_value)
	pshy.ChatCommandLuaget(user, obj_path)
end
pshy.chat_commands["luasetstr"] = {func = pshy.ChatCommandLuasetstr, desc = "set a lua object string (support html)", argc_min = 2, argc_max = 2, arg_types = {"string", "string"}}
pshy.chat_command_aliases["setstr"] = "luaset"
pshy.help_pages["pshy_lua_commands"].commands["luasetstr"] = pshy.chat_commands["luasetstr"]
--- !luacall <path.to.function> [args...]
-- Call a lua function.
-- @todo use variadics and put the feature un pshy_utils?
function pshy.ChatCommandLuacall(user, funcname, ...)
	local func = pshy.LuaGet(funcname)
	assert(type(func) ~= "nil", "function not found")
	assert(type(func) == "function", "a function name was expected")
	pshy.rst1, pshy.rst2 = func(...)
	tfm.exec.chatMessage(funcname .. " returned " .. tostring(pshy.rst1) .. ", " .. tostring(pshy.rst2), user)
end
pshy.chat_commands["luacall"] = {func = pshy.ChatCommandLuacall, desc = "run a lua function with given arguments", argc_min = 1, arg_types = {"string"}}
pshy.chat_command_aliases["call"] = "luacall"
pshy.help_pages["pshy_lua_commands"].commands["luacall"] = pshy.chat_commands["luacall"]
--- !rejoin [player]
-- Simulate a rejoin.
function pshy.ChatCommandRejoin(user, target)
	target = target or user
	tfm.exec.killPlayer(target)
	eventPlayerLeft(target)
	eventNewPlayer(target)
end
pshy.chat_commands["rejoin"] = {func = pshy.ChatCommandRejoin, desc = "simulate a rejoin (events left + join + died)", argc_min = 0, argc_max = 1, arg_types = {"string"}}
pshy.help_pages["pshy_lua_commands"].commands["rejoin"] = pshy.chat_commands["rejoin"]
pshy.perms.admins["!rejoin"] = true
--- !runas command
-- Run a command as another player (use the other player's permissions).
function pshy.ChatCommandRunas(player_name, target_player, command)
	pshy.Log(player_name .. " running as " .. target_player .. ": " .. command)
	pshy.RunChatCommand(target, command)
end
pshy.chat_commands["runas"] = {func = pshy.ChatCommandRunas, desc = "run a command as another player", argc_min = 2, argc_max = 2, arg_types = {"string", "string"}}
pshy.help_pages["pshy_lua_commands"].commands["runas"] = pshy.chat_commands["runas"]
pshy.merge_ModuleBegin("pshy_rotations.lua")
--- pshy_rotations.lua
--
-- This module allow to customize the maps rotation.
-- For antileve, see the pshy_anticheat.lua module.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998
-- @namespace pshy
-- @require pshy_commands.lua
-- @require pshy_utils.lua
-- @require pshy_help.lua
--- Module Help Page:
pshy.help_pages["pshy_rotations"] = {back = "pshy", title = "Rotations", text = "This module allows to control the way maps rotate.\nIncludes burla maps from <ch>Ctmce#0000</ch>\nIncludes troll maps from <ch>Nnaaaz#0000</ch>\n", examples = {}, commands = {}}
--pshy.help_pages["pshy_rotations"].examples["luaset pshy.rotations_alive_shorting_player_count 3"] = "Short the timer when only 3 players are alive."
--pshy.help_pages["pshy_rotations"].examples["luaset pshy.rotations_alive_shorting_time 5"] = "Set the time remaining after a few players are alive to 5 seconds."
--pshy.help_pages["pshy_rotations"].examples["luaset pshy.rotations_win_shorting_player_count 3"] = "Short the timer when 3 players won."
--pshy.help_pages["pshy_rotations"].examples["luaset pshy.rotations_win_shorting_time 10"] = "Set the time remaining after a few players won to 10 seconds."
pshy.help_pages["pshy"].subpages["pshy_rotations"] = pshy.help_pages["pshy_rotations"]
--- Module Settings:
-- Map rotations consist of the given fields:
--	maps			- list of randomly selected maps
--	duration		- duration of each game
--	weight 		- integer representing the default frequency of the rotation
--	chance 		- 0, change at runtime, used to choose the next map
--	hidden 		- if true, will not show in the interface
--	map_replace_func	- function that will be called with the map name and should return a replacement
pshy.rotations	= {}					-- map of rotations
pshy.rotations["standard"]				= {hidden = true, desc = "P0", duration = 120, weight = 0, maps = {"#0"}, chance = 0}
pshy.rotations["protected"]				= {hidden = true, desc = "P1", duration = 120, weight = 0, maps = {"#1"}, chance = 0}
pshy.rotations["mechanisms"]			= {hidden = true, desc = "P6", duration = 120, weight = 0, maps = {"#6"}, chance = 0}
pshy.rotations["nosham"]				= {desc = "P7", duration = 60, weight = 0, maps = {"#7"}, chance = 0}
pshy.rotations["nosham_troll"]			= {hidden = true, desc = "Nnaaaz#0000", duration = 60, weight = 0, maps = {"@7781189", "@7781560", "@7782831", "@7783745", "@7787472", "@7814117", "@7814126", "@7814248", "@7814488", "@7817779"}, chance = 0}
pshy.rotations["racing"]				= {desc = "P17", duration = 60, weight = 0, maps = {"#17"}, chance = 0}
pshy.rotations["racing_troll"]			= {hidden = true, desc = "Nnaaaz#0000", duration = 60, weight = 0, maps = {"@7781575", "@7783458", "@7783472", "@7784221", "@7784236", "@7786652", "@7786707", "@7786960", "@7787034", "@7788567", "@7788596", "@7788673", "@7788967", "@7788985", "@7788990", "@7789010", "@7789484", "@7789524", "@7790734", "@7790746", "@7790938", "@7791293", "@7791550", "@7791709", "@7791865", "@7791877", "@7792434", "@7765843", "@7794331", "@7794726", "@7792626", "@7794874", "@7795585", "@7796272", "@7799753", "@7800330", "@7800998", "@7801670", "@7805437", "@7792149", "@7809901", "@7809905", "@7810816", "@7812751", "@7789538", "@7813075", "@7813248", "@7814099", "@7819315", "@7815695", "@7815703", "@7816583", "@7816748", "@7817111", "@7782820"}, chance = 0}
pshy.rotations["defilante"]				= {desc = "P18", duration = 60, weight = 0, maps = {"#18"}, chance = 0}
pshy.rotations["vanilla"]				= {hidden = true, desc = "1-210", duration = 120, weight = 0, maps = {}, chance = 0} for i = 0, 210 do table.insert(pshy.rotations["vanilla"].maps, i) end
pshy.rotations["nosham_vanilla_troll"]	= {hidden = true, desc = "Nnaaaz#0000", duration = 60, weight = 0, maps = {"@7801848", "@7801850", "@7802588", "@7802592", "@7803100", "@7803618", "@7803013", "@7803900", "@7804144", "@7804211"}, chance = 0} -- https://atelier801.com/topic?f=6&t=892706&p=1
pshy.rotations["nosham_vanilla"]		= {desc = "1-210*", duration = 60, weight = 0, maps = {"2", "8", "11", "12", "14", "19", "22", "24", "26", "27", "28", "30", "31", "33", "40", "41", "44", "45", "49", "52", "53", "55", "57", "58", "59", "61", "62", "65", "67", "69", "70", "71", "73", "74", "79", "80", "85", "86", "89", "92", "96", "100", "117", "119", "120", "121", "123", "126", "127", "138", "142", "145", "148", "149", "150", "172", "173", "174", "175", "176", "185", "189"}, chance = 0}
pshy.rotations["nosham_mechanisms"]		= {desc = nil, duration = 60, weight = 0, maps = {"@1749725", "@176936", "@3514715", "@3150249", "@3506224", "@2030030", "@479001", "@3537313", "@1709809", "@169959", "@313281", "@2868361", "@73039", "@73039", "@2913703", "@2789826", "@298802", "@357666", "@1472765", "@271283", "@3702177", "@2355739", "@4652835", "@164404", "@7273005", "@3061566", "@3199177", "@157312", "@7021280", "@2093284", "@5752223", "@7070948", "@3146116", "@3613020", "@1641262", "@119884", "@3729243", "@1371302", "@6854109", "@2964944", "@3164949", "@149476", "@155262", "@6196297", "@1789012", "@422271", "@3369351", "@3138985", "@3056261", "@5848606", "@931943", "@181693", "@227600", "@2036283", "@6556301", "@3617986", "@314416", "@3495556", "@3112905", "@1953614", "@2469648", "@3493176", "@1009321", "@221535", "@2377177", "@6850246", "@5761423", "@211171", "@1746400", "@1378678", "@246966", "@2008933", "@2085784", "@627958", "@1268022", "@2815209", "@1299248", "@6883670", "@3495694", "@4678821", "@2758715", "@1849769", "@3155991", "@6555713", "@3477737", "@873175", "@141224", "@2167410", "@2629289", "@2888435", "@812822", "@4114065", "@2256415", "@3051008", "@7300333", "@158813", "@3912665", "@6014154", "@163756", "@3446092", "@509879", "@2029308", "@5546337", "@1310605", "@1345662", "@2421802", "@2578335", "@2999901", "@6205570", "@7242798", "@756418", "@2160073", "@3671421", "@5704703", "@3088801", "@7092575", "@3666756", "@3345115", "@1483745", "@3666745", "@2074413", "@2912220", "@3299750"}, chance = 0}
pshy.rotations["burlas"]				= {desc = "Ctmce#0000", duration = 60, weight = 0, maps = {"@7652017" , "@7652019" , "@7652033" , "@7652664" , "@5932565" , "@7652667" , "@7652670" , "@7652674" , "@7652679" , "@7652686" , "@7652691" , "@7652790" , "@7652791" , "@7652792" , "@7652793" , "@7652796" , "@7652797" , "@7652798" , "@7652944" , "@7652954" , "@7652958" , "@7652960" , "@7007413" , "@7653108" , "@7653124" , "@7653127" , "@7653135" , "@7653136" , "@7653139" , "@7653142" , "@7653144" , "@7653149" , "@7653151" , "@7420052" , "@7426198" , "@7426611" , "@7387658" , "@7654229" , "@7203871" , "@7014223" , "@7175013" , "@7165042" , "@7154662" , "@6889690" , "@6933442" , "@7002430" , "@6884221" , "@6886514" , "@6882315" , "@6927305" , "@7659190" , "@7659197" , "@7659203" , "@7659205" , "@7659208" , "@7660110" , "@7660117" , "@7660104" , "@7660502" , "@7660703" , "@7660704" , "@7660705" , "@7660706" , "@7660709" , "@7660710" , "@7660714" , "@7660716" , "@7660718" , "@7660721" , "@7660723" , "@7660727" , "@7661057" , "@7661060" , "@7661062" , "@7661063" , "@7661067" , "@7661072" , "@7662547" , "@7662555" , "@7662559" , "@7662562" , "@7662565" , "@7662566" , "@7662569" , "@7662759" , "@7662768" , "@7662777" , "@7662780" , "@7662796" , "@7663423" , "@7663428" , "@7663429" , "@7663430" , "@7663432" , "@7663435" , "@7663437" , "@7663438" , "@7663439" , "@7663440" , "@7663444" , "@7663445"}, chance = 0}
pshy.rotations["nosham_simple"]			= {desc = nil, duration = 120, weight = 0, maps = {"@7816865", "@763608", "@1616913", "@383202", "@2711646", "@446656", "@815716", "@333501", "@7067867", "@973782", "@763961", "@7833293", "@7833270", "@7833269", "@7815665", "@7815151", "@7833288", "@1482492", "@1301712", "@6714567", "@834490", "@712905", "@602906", "@381669", "@4147040", "@564413", "@504951", "@1345805", "@501364"}, chance = 0} -- soso @1356823 @2048879 @2452915 @2751980
--pshy.rotations["NOSHAM_TRAPS"]		= {desc = nil, duration = 120, weight = 0, maps = {"@5940448", "@2080757", "@7453256", "@203292", "@108937", "@445078", "@133916", "@7840661", "@115767", "@2918927", "@4684884", "@2868361", "@192144", "@73039", "@1836340", "@726048"}, chance = 0} -- sham: @171290 @453115
--pshy.rotations["NOSHAM_COOP"]			= {desc = "vanilla", duration = 120, weight = 0, maps = {"@169909", "@209567", "@273077", "@7485555", "@2618581", "@133916", "@144888", "@1991022", "@7247621", "@3591685", "@6437833", "@3381659", "@121043", "@180468", "@220037", "@882270", "@3265446"}, chance = 0}
-- vanillart? @3624983 @2958393 @624650 @635128 @510084
-- coop ?:		@1327222 @161177 @3147926 @3325842
-- troll traps:	@75050 @923485
-- sham troll: @3659540
-- almost vanilla sham: @3688504 @2013190
pshy.rotations_randomness = 0.5					-- randomness of the rotations selection ([0.0-1.0[)
pshy.rotations_auto_next_map = true				-- change map at the end of timer
pshy.rotations_win_shorting_player_count = -1	-- amount of players who need to win for the timer to be shorted
pshy.rotations_win_shorting_time = 5			-- time
pshy.rotations_alive_shorting_player_count = 0	-- amount of players who need to remain alive for the timer to be shorted
pshy.rotations_alive_shorting_time = 3			-- time
--- Module state (internal use)
pshy.rotations_a_player_recently_died = false
pshy.rotations_current_map_win_count = 0
pshy.rotations_skip_requested = false			-- set by !skip
pshy.rotations_next_map_name = nil			-- set by !next <map_name> (can be a rotation name as well)
pshy.rotations_current = nil				-- represent the current rotation, set before changing
--- Get Total map's probability weight
function pshy.RotationsTotalWeight()
	local total = 0
	for rot_name, rot in pairs(pshy.rotations) do
		total = total + rot.weight
	end
	return total
end
--- Pop a map in a rotation
-- @param rotation Rotation table or name.
function pshy.RotationsPopRotationMap(rotation)
	rotation = (type(rotation) == "string") and pshy.rotations[rotation] or rotation
	assert(type(rotation) == "table")
	-- reset rotation next map candidates if needed
	if not rotation.next_maps or #rotation.next_maps == 0 then
		rotation.next_maps = {}
		for i_map, map_name in ipairs(rotation.maps) do
			table.insert(rotation.next_maps, map_name)
		end
	end
	-- random map from rotation
	local i_map = math.random(1, #rotation.next_maps)
	local next_map = rotation.next_maps[i_map]
	if rotation.map_replace_func then
		next_map = rotation.map_replace_func(next_map)
	end
	table.remove(rotation.next_maps, i_map)
	return next_map
end
--- Start the next map.
-- This take the current rotation settings into account.
function pshy.RotationNext(next_map)
	local next_rotation = nil
	local total_weight = pshy.RotationsTotalWeight()
	if next_map then
		pshy.rotations_next_map_name = next_map
	end
	-- choose rotation and map
	if pshy.rotations[pshy.rotations_next_map_name] then
		-- enforced rotation
		next_rotation = pshy.rotations[pshy.rotations_next_map_name]
	elseif pshy.rotations_next_map_name then
		-- enforced map
		if string.sub(pshy.rotations_next_map_name, 1, 1) == "@" then
			pshy.rotations_next_map_name = string.sub(pshy.rotations_next_map_name, 2, #pshy.rotations_next_map_name)
		end
		pshy.rotations_current = nil
		tfm.exec.newGame(pshy.rotations_next_map_name, nil)
		pshy.rotations_next_map_name = nil
		return
	else
		-- random rotation
		for rot_name, rot in pairs(pshy.rotations) do
			if rot.weight > 0 then
				rot.random_chance = rot.chance + math.random(-total_weight, total_weight) * pshy.rotations_randomness -- randomize next rotation a little
				if not next_rotation or rot.random_chance > next_rotation.random_chance then
					next_rotation = rot
				end
			end
		end
		-- update rotation chances
		for rot_name, rot in pairs(pshy.rotations) do
			rot.chance = rot.chance + rot.weight
		end
	end
	if not next_rotation then
		tfm.exec.newGame()
		return	
	end
	next_rotation.chance = 0 + (next_rotation.chance - total_weight) * 0.9
	pshy.rotations_current = next_rotation
	-- get a map from the rotation
	local next_map = pshy.RotationsPopRotationMap(next_rotation)
	tfm.exec.newGame(next_map)
end
--- TFM event eventLoop
function eventLoop(current_time, time_remaining)
	-- check players alive
	if pshy.rotations_a_player_recently_died then
		pshy.rotations_a_player_recently_died = false
		if pshy.CountPlayersAlive() <= pshy.rotations_alive_shorting_player_count then
			tfm.exec.setGameTime(pshy.rotations_alive_shorting_time, false)
		end
	end
	-- skip checks the first 3 seconds
	if current_time <= 3500 then
		return
	end
	-- next map request
	if pshy.rotations_skip_requested then
		pshy.RotationNext()
	end
	-- check timer end
	if pshy.rotations_auto_next_map and time_remaining <= 0 then
		pshy.RotationNext()
	end
end
--- TFM event eventPlayerDied
function eventPlayerDied(player_name)
	pshy.rotations_a_player_recently_died = true
end
--- TFM event eventPlayerWon
function eventPlayerWon(player_name)
	pshy.rotations_current_map_win_count = pshy.rotations_current_map_win_count + 1
	if pshy.rotations_win_shorting_player_count >= 0 and pshy.rotations_current_map_win_count >= pshy.rotations_win_shorting_player_count then
		tfm.exec.setGameTime(pshy.rotations_win_shorting_time, false)
	end
end
--- TFM event eventNewGame
function eventNewGame()
	pshy.rotations_a_player_recently_died = false
	pshy.rotations_current_map_win_count = 0
	pshy.rotations_skip_requested = false
	pshy.rotations_next_map_name = nil
	if pshy.rotations_current then
		tfm.exec.setGameTime(pshy.rotations_current.duration, false)
	end
end
--- !rotationweight <rot> <weight>
function pshy.ChatCommandRotationweight(user, rot_name, weight)
	assert(type(rot_name) == "string")
	assert(type(weight) == "number")
	local rotation = pshy.rotations[rot_name]
	if not rotation then
		error("Invalid rotation.")
	end
	rotation.weight = weight
	--tfm.exec.chatMessage(rot_name .. "'s weight set to " .. weight, user)
end
pshy.chat_commands["rotationweight"] = {func = pshy.ChatCommandRotationweight, desc = "Set the frequency weight of a rotation.", argc_min = 2, argc_max = 2, arg_types = {"string", "number"}}
pshy.chat_command_aliases["rotw"] = "rotationweight"
pshy.help_pages["pshy_rotations"].commands["rotw"] = pshy.chat_commands["rotationweight"]
--- !rotations
function pshy.ChatCommandRotations(user, visible)
	arbitrary_id = 78
	-- close
	if visible == false then
		ui.removeTextArea(arbitrary_id, nil)
		return
	end
	-- count total weight
	local total_weight = 0
	for i_rot, rot in pairs(pshy.rotations) do
		total_weight = total_weight + rot.weight
	end
	-- html
	local html = "<b><p align='center'>ROTATIONS</p><font size='12'>"
	for i_rot, rot in pairs(pshy.rotations) do
		if not rot.hidden then
			-- buttons
			html = html .. "<font size='18'>"
			if rot.weight > 0 then
				html = html .. "<a href='event:apcmd rotw " .. i_rot .. " " .. tostring(rot.weight - 1) .. "\napcmd rots'><r> - </r></a>"
			else
				html = html .. "<g> - </g>"
			end
			html = html .. "<a href='event:apcmd rotw " .. i_rot .. " " .. tostring(rot.weight + 1) .. "\napcmd rots'><vp>+ </vp></a>"
			html = html .. "</font>"
			-- name/desc
			html = html .. "\t" .. ((rot.weight > 0) and "<vp>" or "<bl>") .. "" .. i_rot .. (rot.desc and (" (" .. rot.desc .. ")") or "")
			html = html .. ((rot.weight > 0) and "</vp>" or "</bl>")
			if rot.weight > 0 then
				html = html .. "    " .. tostring(math.floor(rot.weight * 100 / total_weight)) .. "% "
			end
			html = html .. "\n"
		end
	end
	html = html .. "</font><p align='right'><a href='event:closeall'>[close]</a></p></b>"
	local ui = pshy.UICreate(html)
	ui.id = arbitrary_id
	ui.x = 20
	ui.y = 60
	ui.w = 240
	ui.h = nil
	ui.border_color = 0xffffff
	ui.back_color = 0x003311
	ui.alpha = 0.6
	pshy.UIShow(ui, nil)
end
pshy.chat_commands["rotations"] = {func = pshy.ChatCommandRotations, desc = "Show the rotations interface ('false' to hide).", argc_min = 0, argc_max = 1, arg_types = {"boolean"}}
pshy.chat_command_aliases["rots"] = "rotations"
pshy.help_pages["pshy_rotations"].commands["rots"] = pshy.chat_commands["rotations"]
--- !skip [map]
function pshy.RotationsSkipMap(map)
	if map then
		pshy.rotations_next_map_name = map
	end
	pshy.rotations_skip_requested = true
end
pshy.chat_commands["skip"] = {func = pshy.RotationsSkipMap, desc = "Skip the current map.", no_user = true, argc_min = 0, argc_max = 1, arg_types = {"string"}}
pshy.chat_command_aliases["np"] = "skip"
pshy.help_pages["pshy_rotations"].commands["skip"] = pshy.chat_commands["skip"]
--- !next <map>
function pshy.RotationsNextMap(map)
	pshy.rotations_next_map_name = map
end
pshy.chat_commands["next"] = {func = pshy.RotationsNextMap, desc = "Set the next map or rotation.", no_user = true, argc_min = 1, argc_max = 1, arg_types = {"string"}}
pshy.chat_command_aliases["npp"] = "next"
pshy.help_pages["pshy_rotations"].commands["next"] = pshy.chat_commands["next"]
--- Initialization
tfm.exec.disableAutoTimeLeft(true)
tfm.exec.disableAutoNewGame(true)
pshy.merge_ModuleEnd()
pshy.merge_ModuleBegin("pacmice.lua")
--- pacmice.lua
--
-- Pacmouse: -sees mice- "Nom nom nom!".
--
-- To create a new map:
--	- Add the map to the rotation, in the settings with `pathes` being `{{0, 0}}`.
--	- Play the map.
--	- Use `!set pacmice_cur_pilot YourName#3752`.
--	- Click on a free cell, then use arrows to travel the entire map, every possible path.
--	- Use `!call pacmice_GridExportPathes YourName#3752`.
--	- Copy the output, remove the new lines, and add this as the `pathes` field.
--
-- @author TFM:Pshy#3752 DC:Pshy#7998 (script)
-- @author TFM:Nnaaaz#0000 (map)
--
-- @require pshy_commands.lua
-- @require pshy_scores.lua
-- @require pshy_lua_commands.lua
-- @require pshy_splashscreen.lua
-- @require pshy_keycodes.lua
-- @require pshy_utils.lua
-- @require pshy_loopmore.lua
-- @require pshy_rotations.lua
-- @require pshy_bonus.lua
--- help Page:
pshy.help_pages["pacmice"] = {back = "", title = "PacMice", text = "Oh no!\n", commands = {}}
pshy.help_pages[""].subpages["pacmice"] = pshy.help_pages["pacmice"]
--- TFM Settings
tfm.exec.disableAutoNewGame(true)
tfm.exec.disableAutoShaman(true)
tfm.exec.disableAfkDeath(true)
tfm.exec.disableAutoTimeLeft(true)
--- Pshy Settings:
pshy.perms_auto_admin_authors = true
pshy.authors["Nnaaaz#0000"] = true
pshy.splashscreen_image = "17acb076edb.png"	-- splash image
pshy.splashscreen_x = 150					-- x location
pshy.splashscreen_y = 100					-- y location
pshy.splashscreen_sx = 1					-- scale on x
pshy.splashscreen_sy = 1					-- scale on y
pshy.splashscreen_text = nil
pshy.splashscreen_duration = 8 * 1000		-- pacmice screen duration
pshy.rotations_auto_next_map = false
--- Module Settings:
pacmice_maps = {}						-- game maps tables
-- map 1 (original)
table.insert(pacmice_maps, {x = 91, y = 29, cell_w = 26, cell_h = 26, wall_size = 14, web_x = -100, pac_count = 1, xml = [[<C><P H="720" DS="m;170,165,610,165" /><Z><S><S T="12" X="168" Y="107" L="56" H="56" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="613" Y="107" L="56" H="56" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="286" Y="107" L="79" H="56" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="495" Y="107" L="79" H="56" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="247" Y="263" L="10" H="160" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="533" Y="263" L="10" H="160" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="390" Y="29" L="605" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="91" Y="130" L="10" H="210" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="690" Y="130" L="10" H="210" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="141" Y="237" L="110" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="641" Y="237" L="108" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="196" Y="276" L="10" H="87" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="586" Y="277" L="10" H="88" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="143" Y="316" L="113" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="636" Y="316" L="101" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="91" Y="343" L="10" H="60" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="689" Y="342" L="10" H="62" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="145" Y="368" L="111" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="635" Y="368" L="100" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="196" Y="408" L="10" H="83" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="586" Y="406" L="10" H="87" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="145" Y="445" L="105" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="638" Y="445" L="105" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="90" Y="575" L="10" H="270" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="690" Y="575" L="10" H="270" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="390" Y="706" L="608" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="82" L="32" H="108" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="392" Y="186" L="180" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="391" Y="445" L="176" H="10" P="0,0,0.3,0.2,360,0,0,0"/><S T="12" X="389" Y="550" L="177" H="10" P="0,0,0.3,0.2,360,0,0,0"/><S T="12" X="234" Y="655" L="185" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="547" Y="655" L="184" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="170" Y="186" L="50" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="612" Y="186" L="50" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="214" L="32" H="56" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="390" Y="476" L="32" H="55" P="0,0,0.5,0.2,360,0,0,0"/><S T="12" X="390" Y="603" L="32" H="103" P="0,0,0.5,0.2,360,0,0,0"/><S T="12" X="172" Y="498" L="55" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="609" Y="498" L="55" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="195" Y="549" L="10" H="107" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="586" Y="549" L="10" H="107" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="286" Y="498" L="73" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="495" Y="498" L="75" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="247" Y="420" L="10" H="55" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="533" Y="420" L="10" H="56" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="248" Y="600" L="10" H="100" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="533" Y="600" L="10" H="99" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="289" Y="238" L="75" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="493" Y="238" L="75" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="118" Y="576" L="52" H="54" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="663" Y="576" L="52" H="54" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="391" Y="393" L="190" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="480" Y="300" L="10" H="22" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="301" Y="300" L="10" H="22" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="480" Y="387" L="10" H="22" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="301" Y="387" L="10" H="22" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="325" Y="292" L="60" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="455" Y="292" L="60" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="312" Y="602" L="30" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="469" Y="602" L="30" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="292" L="67" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000"/><S T="12" X="480" Y="342" L="67" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="301" Y="342" L="67" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="387" Y="724" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="90000"/><S T="12" X="427" Y="724" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="89000"/><S T="12" X="467" Y="724" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="88000"/><S T="12" X="507" Y="724" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="87000"/><S T="12" X="547" Y="724" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="86000"/><S T="12" X="587" Y="724" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="85000"/></S><D><F X="335" Y="379" D=""/><F X="445" Y="379" D=""/><T X="392" Y="387" D=""/></D><O/><L><JD c="000000,250,1,0" P1="-1600,800" P2="2400,800"/><JD c="000000,250,1,0" P1="-1600,1000" P2="2400,1000"/><JD c="000000,250,1,0" P1="-1600,1200" P2="2400,1200"/><JD c="000000,250,1,0" P1="-1600,600" P2="2400,600"/><JD c="000000,250,1,0" P1="-1600,400" P2="2400,400"/><JD c="000000,250,1,0" P1="-1600,200" P2="2400,200"/><JD c="000000,250,1,0" P1="-1600,0" P2="2400,0"/><JD c="000000,250,1,0" P1="-1600,-200" P2="2400,-200"/><JD c="000000,250,1,0" P1="-1600,-400" P2="2400,-400"/><JD c="1500fb,10,1,0" P1="91,29" P2="690,29"/><JD c="1500fb,10,1,0" P1="91,706" P2="690,706"/><JD c="1500fb,10,1,0" P1="91,30" P2="91,236"/><JD c="1500fb,10,1,0" P1="690,30" P2="690,236"/><JD c="1500fb,10,1,0" P1="91,446" P2="91,704"/><JD c="1500fb,10,1,0" P1="690,446" P2="690,704"/><JD c="1500fb,10,1,0" P1="91,237" P2="195,237"/><JD c="1500fb,10,1,0" P1="690,237" P2="586,237"/><JD c="1500fb,10,1,0" P1="149,186" P2="191,186"/><JD c="1500fb,10,1,0" P1="632,186" P2="590,186"/><JD c="1500fb,10,1,0" P1="301,292" P2="352,292"/><JD c="FFFFFF,10,1,0" M1="63" M2="63" P1="362,292" P2="418,292"/><JD c="FFFFFF,10,1,0" M1="63" M2="63" P1="480,316" P2="480,372"/><JD c="FFFFFF,10,1,0" M1="63" M2="63" P1="301,316" P2="301,372"/><JD c="1500fb,10,1,0" M1="64" M2="64" P1="362,292" P2="418,292"/><JD c="1500fb,10,1,0" M1="64" M2="64" P1="480,316" P2="480,372"/><JD c="1500fb,10,1,0" M1="64" M2="64" P1="301,316" P2="301,372"/><JD c="FFFFFF,10,1,0" M1="65" M2="65" P1="362,292" P2="418,292"/><JD c="FFFFFF,10,1,0" M1="65" M2="65" P1="480,316" P2="480,372"/><JD c="FFFFFF,10,1,0" M1="65" M2="65" P1="301,316" P2="301,372"/><JD c="1500fb,10,1,0" M1="66" M2="66" P1="362,292" P2="418,292"/><JD c="1500fb,10,1,0" M1="66" M2="66" P1="480,316" P2="480,372"/><JD c="1500fb,10,1,0" M1="66" M2="66" P1="301,316" P2="301,372"/><JD c="FFFFFF,10,1,0" M1="67" M2="67" P1="362,292" P2="418,292"/><JD c="FFFFFF,10,1,0" M1="67" M2="67" P1="480,316" P2="480,372"/><JD c="FFFFFF,10,1,0" M1="67" M2="67" P1="301,316" P2="301,372"/><JD c="1500fb,10,1,0" M1="68" M2="68" P1="362,292" P2="418,292"/><JD c="1500fb,10,1,0" M1="68" M2="68" P1="480,316" P2="480,372"/><JD c="1500fb,10,1,0" M1="68" M2="68" P1="301,316" P2="301,372"/><JD c="1500fb,10,1,0" P1="480,292" P2="429,292"/><JD c="1500fb,10,1,0" P1="249,238" P2="322,238"/><JD c="1500fb,10,1,0" P1="532,238" P2="459,238"/><JD c="1500fb,10,1,0" P1="92,316" P2="195,316"/><JD c="1500fb,10,1,0" P1="689,316" P2="586,316"/><JD c="1500fb,10,1,0" P1="92,368" P2="195,368"/><JD c="1500fb,10,1,0" P1="689,368" P2="586,368"/><JD c="1500fb,10,1,0" P1="91,445" P2="195,445"/><JD c="1500fb,10,1,0" P1="690,445" P2="586,445"/><JD c="1500fb,10,1,0" P1="307,445" P2="476,445"/><JD c="1500fb,10,1,0" P1="302,393" P2="479,393"/><JD c="1500fb,10,1,0" P1="307,186" P2="478,186"/><JD c="1500fb,10,1,0" P1="305,550" P2="474,550"/><JD c="1500fb,10,1,0" P1="145,655" P2="323,655"/><JD c="1500fb,10,1,0" P1="636,655" P2="458,655"/><JD c="000000,6,1,0" P1="91,30" P2="91,236"/><JD c="000000,6,1,0" P1="690,30" P2="690,236"/><JD c="000000,6,1,0" P1="91,706" P2="690,706"/><JD c="1500fb,10,1,0" P1="148,498" P2="195,498"/><JD c="1500fb,10,1,0" P1="633,498" P2="586,498"/><JD c="1500fb,10,1,0" P1="254,498" P2="318,498"/><JD c="1500fb,10,1,0" P1="527,498" P2="463,498"/><JD c="1500fb,10,1,0" P1="301,602" P2="322,602"/><JD c="1500fb,10,1,0" P1="480,602" P2="459,602"/><JD c="1500fb,10,1,0" P1="195.5,237.5" P2="195.5,315.5"/><JD c="1500fb,10,1,0" P1="585.5,237.5" P2="585.5,315.5"/><JD c="1500fb,10,1,0" P1="480,294" P2="480,306"/><JD c="1500fb,10,1,0" P1="301,294" P2="301,306"/><JD c="1500fb,10,1,0" P1="480,381" P2="480,393"/><JD c="1500fb,10,1,0" P1="301,381" P2="301,393"/><JD c="1500fb,10,1,0" P1="247.5,186.5" P2="247.5,338.5"/><JD c="1500fb,10,1,0" P1="533.5,186.5" P2="533.5,338.5"/><JD c="1500fb,10,1,0" P1="195.5,368" P2="195.5,445"/><JD c="1500fb,10,1,0" P1="585.5,368" P2="585.5,445"/><JD c="000000,6,1,0" P1="91,446" P2="91,704"/><JD c="000000,6,1,0" P1="690,446" P2="690,704"/><JD c="1500fb,10,1,0" P1="247.5,397" P2="247.5,443"/><JD c="1500fb,10,1,0" P1="533.5,397" P2="533.5,443"/><JD c="1500fb,10,1,0" P1="195.5,498" P2="195.5,600"/><JD c="1500fb,10,1,0" P1="585.5,498" P2="585.5,600"/><JD c="1500fb,10,1,0" P1="247.5,553" P2="247.5,655"/><JD c="1500fb,10,1,0" P1="533.5,553" P2="533.5,655"/><JD c="1500fb,10,1,0" P1="91.5,316" P2="91.5,367"/><JD c="1500fb,10,1,0" P1="689.5,316" P2="689.5,367"/><JD c="000000,6,1,0" P1="91,237" P2="195,237"/><JD c="000000,6,1,0" P1="690,237" P2="586,237"/><JD c="000000,6,1,0" P1="149,186" P2="191,186"/><JD c="000000,6,1,0" P1="632,186" P2="590,186"/><JD c="000000,6,1,0" P1="301,292" P2="352,292"/><JD c="000000,6,1,0" M1="63" M2="63" P1="362,292" P2="418,292"/><JD c="000000,6,1,0" M1="63" M2="63" P1="480,316" P2="480,372"/><JD c="000000,6,1,0" M1="63" M2="63" P1="301,316" P2="301,372"/><JD c="000000,6,1,0" P1="480,292" P2="429,292"/><JD c="000000,6,1,0" P1="249,238" P2="322,238"/><JD c="000000,6,1,0" P1="532,238" P2="459,238"/><JD c="000000,6,1,0" P1="92,316" P2="195,316"/><JD c="000000,6,1,0" P1="689,316" P2="586,316"/><JD c="000000,6,1,0" P1="92,368" P2="195,368"/><JD c="000000,6,1,0" P1="689,368" P2="586,368"/><JD c="000000,6,1,0" P1="91,445" P2="195,445"/><JD c="000000,6,1,0" P1="690,445" P2="586,445"/><JD c="000000,6,1,0" P1="307,445" P2="476,445"/><JD c="000000,6,1,0" P1="302,393" P2="479,393"/><JD c="000000,6,1,0" P1="145,655" P2="323,655"/><JD c="000000,6,1,0" P1="636,655" P2="458,655"/><JD c="000000,6,1,0" P1="148,498" P2="195,498"/><JD c="000000,6,1,0" P1="633,498" P2="586,498"/><JD c="000000,6,1,0" P1="254,498" P2="318,498"/><JD c="000000,6,1,0" P1="527,498" P2="463,498"/><JD c="000000,6,1,0" P1="301,602" P2="322,602"/><JD c="000000,6,1,0" P1="480,602" P2="459,602"/><JD c="000000,6,1,0" P1="195.5,237.5" P2="195.5,315.5"/><JD c="000000,6,1,0" P1="585.5,237.5" P2="585.5,315.5"/><JD c="000000,6,1,0" P1="480,294" P2="480,306"/><JD c="000000,6,1,0" P1="301,294" P2="301,306"/><JD c="000000,6,1,0" P1="480,381" P2="480,393"/><JD c="000000,6,1,0" P1="301,381" P2="301,393"/><JD c="000000,6,1,0" P1="247.5,186.5" P2="247.5,338.5"/><JD c="000000,6,1,0" P1="533.5,186.5" P2="533.5,338.5"/><JD c="000000,6,1,0" P1="195.5,368" P2="195.5,445"/><JD c="000000,6,1,0" P1="585.5,368" P2="585.5,445"/><JD c="000000,6,1,0" P1="247.5,397" P2="247.5,443"/><JD c="000000,6,1,0" P1="533.5,397" P2="533.5,443"/><JD c="000000,6,1,0" P1="195.5,498" P2="195.5,600"/><JD c="000000,6,1,0" P1="585.5,498" P2="585.5,600"/><JD c="000000,6,1,0" P1="247.5,553" P2="247.5,655"/><JD c="000000,6,1,0" P1="533.5,553" P2="533.5,655"/><JD c="000000,6,1,0" P1="91.5,316" P2="91.5,367"/><JD c="000000,6,1,0" P1="689.5,316" P2="689.5,367"/><JD c="1500fb,3,1,0" P1="141,80" P2="195,80"/><JD c="1500fb,3,1,0" P1="640,80" P2="586,80"/><JD c="1500fb,3,1,0" P1="248,80" P2="324,80"/><JD c="1500fb,3,1,0" P1="533,80" P2="457,80"/><JD c="1500fb,3,1,0" P1="195,81" P2="195,134"/><JD c="1500fb,3,1,0" P1="586,81" P2="586,134"/><JD c="1500fb,3,1,0" P1="324,81" P2="324,134"/><JD c="1500fb,3,1,0" P1="375,33" P2="375,134"/><JD c="1500fb,3,1,0" P1="375,189" P2="375,240"/><JD c="1500fb,3,1,0" P1="375,450" P2="375,502"/><JD c="1500fb,3,1,0" P1="375,553" P2="375,653"/><JD c="1500fb,3,1,0" P1="405,33" P2="405,134"/><JD c="1500fb,3,1,0" P1="405,189" P2="405,240"/><JD c="1500fb,3,1,0" P1="404.88,450" P2="404.88,502"/><JD c="1500fb,3,1,0" P1="405,553" P2="405,653"/><JD c="1500fb,3,1,0" P1="457,81" P2="457,134"/><JD c="1500fb,3,1,0" P1="141,81" P2="141,134"/><JD c="1500fb,3,1,0" P1="640,81" P2="640,134"/><JD c="1500fb,3,1,0" P1="248,81" P2="248,134"/><JD c="000000,6,1,0" P1="307,186" P2="478,186"/><JD c="1500fb,3,1,0" P1="533,81" P2="533,134"/><JD c="1500fb,3,1,0" P1="141,134" P2="195,134"/><JD c="1500fb,3,1,0" P1="640,134" P2="586,134"/><JD c="1500fb,3,1,0" P1="248,134.5" P2="324,134.5"/><JD c="1500fb,3,1,0" P1="375,134.5" P2="405,134.5"/><JD c="000000,6,1,0" P1="305,550" P2="474,550"/><JD c="1500fb,3,1,0" P1="375,240.5" P2="405,240.5"/><JD c="1500fb,3,1,0" P1="375,502.5" P2="405,502.5"/><JD c="000000,6,1,0" P1="91,29" P2="690,29"/><JD c="1500fb,3,1,0" P1="375,653.5" P2="405,653.5"/><JD c="1500fb,3,1,0" P1="533,134" P2="457,134"/><JD c="1500fb,3,1,0" P1="96,551" P2="143,551"/><JD c="1500fb,3,1,0" P1="685,551" P2="638,551"/><JD c="1500fb,3,1,0" P1="96,601" P2="143,601"/><JD c="1500fb,3,1,0" P1="685,601" P2="638,601"/><JD c="1500fb,3,1,0" P1="143,551" P2="143,601"/><JD c="1500fb,3,1,0" P1="638,551" P2="638,601"/><JD c="000000,5,1,0" P1="379,449" P2="401,449"/><JD c="000000,5,1,0" P1="379,554" P2="401,554"/><JD c="000000,5,1,0" P1="379,190" P2="401,190"/><JD c="000000,5,1,0" P1="379,33" P2="401,33"/><JD c="000000,5,1,0" P1="686,555" P2="686,597"/><JD c="000000,5,1,0" P1="95,555" P2="95,597"/></L></Z></C>]]})
pacmice_maps[#pacmice_maps].pathes = {{1, 1}, {2, 1}, {3, 1}, {4, 1}, {5, 1}, {6, 1}, {7, 1}, {8, 1}, {9, 1}, {10, 1}, {13, 1}, {14, 1}, {15, 1}, {16, 1}, {17, 1}, {18, 1}, {19, 1}, {20, 1}, {21, 1}, {22, 1}, {1, 2}, {5, 2}, {10, 2}, {13, 2}, {18, 2}, {22, 2}, {1, 3}, {5, 3}, {10, 3}, {13, 3}, {18, 3}, {22, 3}, {1, 4}, {5, 4}, {10, 4}, {13, 4}, {18, 4}, {22, 4}, {1, 5}, {2, 5}, {3, 5}, {4, 5}, {5, 5}, {6, 5}, {7, 5}, {8, 5}, {9, 5}, {10, 5}, {11, 5}, {12, 5}, {13, 5}, {14, 5}, {15, 5}, {16, 5}, {17, 5}, {18, 5}, {19, 5}, {20, 5}, {21, 5}, {22, 5}, {1, 6}, {5, 6}, {7, 6}, {16, 6}, {18, 6}, {22, 6}, {1, 7}, {2, 7}, {3, 7}, {4, 7}, {5, 7}, {7, 7}, {8, 7}, {9, 7}, {10, 7}, {13, 7}, {14, 7}, {15, 7}, {16, 7}, {18, 7}, {19, 7}, {20, 7}, {21, 7}, {22, 7}, {5, 8}, {10, 8}, {13, 8}, {18, 8}, {5, 9}, {7, 9}, {8, 9}, {9, 9}, {10, 9}, {11, 9}, {12, 9}, {13, 9}, {14, 9}, {15, 9}, {16, 9}, {18, 9}, {5, 10}, {7, 10}, {16, 10}, {18, 10}, {5, 11}, {7, 11}, {16, 11}, {18, 11}, {1, 12}, {2, 12}, {3, 12}, {4, 12}, {5, 12}, {7, 12}, {16, 12}, {18, 12}, {19, 12}, {20, 12}, {21, 12}, {22, 12}, {5, 13}, {6, 13}, {7, 13}, {16, 13}, {17, 13}, {18, 13}, {5, 14}, {7, 14}, {16, 14}, {18, 14}, {5, 15}, {7, 15}, {8, 15}, {9, 15}, {10, 15}, {11, 15}, {12, 15}, {13, 15}, {14, 15}, {15, 15}, {16, 15}, {18, 15}, {5, 16}, {7, 16}, {16, 16}, {18, 16}, {1, 17}, {2, 17}, {3, 17}, {4, 17}, {5, 17}, {6, 17}, {7, 17}, {8, 17}, {9, 17}, {10, 17}, {13, 17}, {14, 17}, {15, 17}, {16, 17}, {17, 17}, {18, 17}, {19, 17}, {20, 17}, {21, 17}, {22, 17}, {1, 18}, {5, 18}, {10, 18}, {13, 18}, {18, 18}, {22, 18}, {1, 19}, {2, 19}, {3, 19}, {5, 19}, {6, 19}, {7, 19}, {8, 19}, {9, 19}, {10, 19}, {11, 19}, {12, 19}, {13, 19}, {14, 19}, {15, 19}, {16, 19}, {17, 19}, {18, 19}, {20, 19}, {21, 19}, {22, 19}, {3, 20}, {5, 20}, {7, 20}, {16, 20}, {18, 20}, {20, 20}, {3, 21}, {5, 21}, {7, 21}, {8, 21}, {9, 21}, {10, 21}, {13, 21}, {14, 21}, {15, 21}, {16, 21}, {18, 21}, {20, 21}, {3, 22}, {5, 22}, {7, 22}, {10, 22}, {13, 22}, {16, 22}, {18, 22}, {20, 22}, {1, 23}, {2, 23}, {3, 23}, {4, 23}, {5, 23}, {7, 23}, {8, 23}, {9, 23}, {10, 23}, {13, 23}, {14, 23}, {15, 23}, {16, 23}, {18, 23}, {19, 23}, {20, 23}, {21, 23}, {22, 23}, {1, 24}, {10, 24}, {13, 24}, {22, 24}, {1, 25}, {2, 25}, {3, 25}, {4, 25}, {5, 25}, {6, 25}, {7, 25}, {8, 25}, {9, 25}, {10, 25}, {11, 25}, {12, 25}, {13, 25}, {14, 25}, {15, 25}, {16, 25}, {17, 25}, {18, 25}, {19, 25}, {20, 25}, {21, 25}, {22, 25}}
pacmice_maps[#pacmice_maps].foods = {{x = 285, y = 58}, {x = 495, y = 58}, {x = 390, y = 161}, {x = 274, y = 214}, {x = 502, y = 216}, {x = 389, y = 269}, {x = 117, y = 343}, {x = 117, y = 527}, {x = 218, y = 682}, {x = 390, y = 420}, {x = 390, y = 527}, {x = 352, y = 578}, {x = 427, y = 578}, {x = 561, y = 682}, {x = 667, y = 527}, {x = 661, y = 343}}
-- map 2 (2nd map)
table.insert(pacmice_maps, {x = 91, y = 39, cell_w = 26, cell_h = 26, wall_size = 14, web_x = -100, pac_count = 1, xml = [[<C><P H="720" DS="m;210,175,570,175" /><Z><S><S T="12" X="168" Y="91" L="56" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="612" Y="91" L="56" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="288" Y="91" L="84" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="492" Y="91" L="84" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="236" Y="142" L="84" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="544" Y="142" L="84" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="247" Y="536" L="58" H="10" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="533" Y="536" L="58" H="10" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="208" Y="244" L="34" H="103" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="572" Y="244" L="34" H="103" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="120" Y="222" L="52" H="55" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="660" Y="222" L="52" H="55" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="390" Y="39" L="605" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="91" Y="91" L="10" H="114" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="91" Y="433" L="10" H="569" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="690" Y="91" L="10" H="113" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="690" Y="433" L="10" H="574" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="390" Y="716" L="608" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="168" L="27" H="162" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="391" Y="234" L="137" H="32" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="325" Y="128" L="10" H="80" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="455" Y="128" L="10" H="80" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="273" Y="193" L="10" H="110" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="507" Y="193" L="10" H="109" P="0,0,0.5,0.2,0,0,0,0"/><S T="12" X="285" Y="560" L="10" H="84" P="0,0,0.5,0.2,-90,0,0,0"/><S T="12" X="495" Y="560" L="10" H="84" P="0,0,0.5,0.2,90,0,0,0"/><S T="12" X="119" Y="143" L="50" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="661" Y="143" L="50" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="483" L="30" H="55" P="0,0,0.5,0.2,360,0,0,0"/><S T="12" X="390" Y="613" L="32" H="103" P="0,0,0.5,0.2,360,0,0,0"/><S T="12" X="173" Y="417" L="50" H="31" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="607" Y="417" L="50" H="31" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="118" Y="545" L="50" H="35" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="662" Y="545" L="50" H="35" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="181" Y="611" L="81" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="599" Y="611" L="81" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="237" Y="664" L="81" H="10" P="0,0,0.3,0.2,180,0,0,0"/><S T="12" X="543" Y="664" L="81" H="10" P="0,0,0.3,0.2,-180,0,0,0"/><S T="12" X="107" Y="325" L="23" H="60" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="673" Y="325" L="23" H="60" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="210" Y="351" L="81" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="570" Y="351" L="81" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="247" Y="401" L="10" H="107" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="532" Y="401" L="10" H="107" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="507" L="10" H="183" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="284" Y="454" L="10" H="83" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="496" Y="454" L="10" H="83" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="143" Y="443" L="10" H="83" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="637" Y="443" L="10" H="83" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="195" Y="521" L="10" H="80" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="585" Y="521" L="10" H="80" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="143" Y="637" L="10" H="60" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="637" Y="637" L="10" H="60" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="273" Y="638" L="10" H="59" P="0,0,0.3,0.2,180,0,0,0"/><S T="12" X="507" Y="638" L="10" H="59" P="0,0,0.3,0.2,-180,0,0,0"/><S T="12" X="325" Y="662" L="10" H="105" P="0,0,0.3,0.2,180,0,0,0"/><S T="12" X="455" Y="662" L="10" H="105" P="0,0,0.3,0.2,-180,0,0,0"/><S T="12" X="209" Y="299" L="78" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="571" Y="299" L="78" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="391" Y="403" L="190" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="480" Y="308" L="10" H="18" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="300" Y="308" L="10" H="18" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="480" Y="397" L="10" H="18" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="300" Y="397" L="10" H="18" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="325" Y="302" L="60" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="455" Y="302" L="60" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="390" Y="302" L="67" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000"/><S T="12" X="480" Y="352" L="67" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="300" Y="352" L="67" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="400" Y="735" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="90000"/><S T="12" X="400" Y="735" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="89000"/><S T="12" X="400" Y="735" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="88000"/><S T="12" X="400" Y="735" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="87000"/><S T="12" X="400" Y="735" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="86000"/><S T="12" X="400" Y="735" L="10" H="10" P="1,0,0.3,0.2,0,1,Infinity,0" c="4" v="85000"/></S><D><F X="335" Y="390" D=""/><F X="445" Y="390" D=""/><T X="392" Y="397" D=""/></D><O/><L><JD c="000000,250,1,0" P1="-1620,1040" P2="2380,1040"/><JD c="000000,250,1,0" P1="-1610,840" P2="2390,840"/><JD c="000000,250,1,0" P1="-1610,640" P2="2390,640"/><JD c="000000,250,1,0" P1="-1610,440" P2="2390,440"/><JD c="000000,250,1,0" P1="-1610,240" P2="2390,240"/><JD c="000000,250,1,0" P1="-1610,40" P2="2390,40"/><JD c="000000,250,1,0" P1="-1600,-160" P2="2400,-160"/><JD c="000000,250,1,0" P1="-1590,-360" P2="2410,-360"/><JD c="1500fb,10,1,0" P1="91,39" P2="689,39"/><JD c="1500fb,10,1,0" P1="91,716" P2="689,716"/><JD c="1500fb,10,1,0" P1="91,40" P2="91,143"/><JD c="1500fb,10,1,0" P1="689,40" P2="689,143"/><JD c="1500fb,10,1,0" P1="91,199" P2="91,713"/><JD c="1500fb,10,1,0" P1="689,199" P2="689,713"/><JD c="1500fb,10,1,0" P1="273,143" P2="273,244"/><JD c="1500fb,10,1,0" P1="507,143" P2="507,244"/><JD c="1500fb,10,1,0" P1="325,91" P2="325,163"/><JD c="1500fb,10,1,0" P1="455,91" P2="455,163"/><JD c="1500fb,10,1,0" P1="272,142" P2="199,142"/><JD c="1500fb,10,1,0" P1="508,142" P2="581,142"/><JD c="1500fb,10,1,0" P1="244,299" P2="174,299"/><JD c="FFFFFF,10,1,0" M1="69" M2="69" P1="419,302" P2="361,302"/><JD c="FFFFFF,10,1,0" M1="69" M2="69" P1="480,382" P2="480,324"/><JD c="FFFFFF,10,1,0" M1="69" M2="69" P1="300,382" P2="300,324"/><JD c="1500fb,10,1,0" M1="70" M2="70" P1="419,302" P2="361,302"/><JD c="1500fb,10,1,0" M1="70" M2="70" P1="480,382" P2="480,324"/><JD c="1500fb,10,1,0" M1="70" M2="70" P1="300,382" P2="300,324"/><JD c="FFFFFF,10,1,0" M1="71" M2="71" P1="419,302" P2="361,302"/><JD c="FFFFFF,10,1,0" M1="71" M2="71" P1="480,382" P2="480,324"/><JD c="FFFFFF,10,1,0" M1="71" M2="71" P1="300,382" P2="300,324"/><JD c="1500fb,10,1,0" M1="72" M2="72" P1="419,302" P2="361,302"/><JD c="1500fb,10,1,0" M1="72" M2="72" P1="480,382" P2="480,324"/><JD c="1500fb,10,1,0" M1="72" M2="72" P1="300,382" P2="300,324"/><JD c="FFFFFF,10,1,0" M1="73" M2="73" P1="419,302" P2="361,302"/><JD c="FFFFFF,10,1,0" M1="73" M2="73" P1="480,382" P2="480,324"/><JD c="FFFFFF,10,1,0" M1="73" M2="73" P1="300,382" P2="300,324"/><JD c="1500fb,10,1,0" M1="74" M2="74" P1="419,302" P2="361,302"/><JD c="1500fb,10,1,0" M1="74" M2="74" P1="480,382" P2="480,324"/><JD c="1500fb,10,1,0" M1="74" M2="74" P1="300,382" P2="300,324"/><JD c="1500fb,10,1,0" P1="536,299" P2="606,299"/><JD c="1500fb,10,1,0" P1="245,351" P2="174,351"/><JD c="1500fb,10,1,0" P1="535,351" P2="606,351"/><JD c="1500fb,10,1,0" P1="321,454" P2="249,454"/><JD c="1500fb,10,1,0" P1="478,507" P2="302,507"/><JD c="1500fb,10,1,0" P1="479,403" P2="301,403"/><JD c="1500fb,10,1,0" P1="459,454" P2="531,454"/><JD c="1500fb,10,1,0" P1="322,560" P2="249,560"/><JD c="1500fb,10,1,0" P1="458,560" P2="531,560"/><JD c="1500fb,10,1,0" P1="218,611" P2="144,611"/><JD c="1500fb,10,1,0" P1="562,611" P2="636,611"/><JD c="1500fb,10,1,0" P1="273,664" P2="200,664"/><JD c="1500fb,10,1,0" P1="507,664" P2="580,664"/><JD c="1500fb,10,1,0" P1="323,91" P2="250,91"/><JD c="1500fb,10,1,0" P1="457,91" P2="530,91"/><JD c="1500fb,10,1,0" P1="192,91" P2="144,91"/><JD c="1500fb,10,1,0" P1="588,91" P2="636,91"/><JD c="1500fb,10,1,0" P1="351,302" P2="301,302"/><JD c="1500fb,10,1,0" P1="429,302" P2="479,302"/><JD c="1500fb,10,1,0" P1="140,143" P2="92,143"/><JD c="1500fb,10,1,0" P1="640,143" P2="688,143"/><JD c="1500fb,10,1,0" P1="480,302" P2="480,314"/><JD c="1500fb,10,1,0" P1="300,302" P2="300,314"/><JD c="1500fb,10,1,0" P1="480,391" P2="480,402"/><JD c="1500fb,10,1,0" P1="300,391" P2="300,402"/><JD c="1500fb,10,1,0" P1="247,351" P2="247,454"/><JD c="1500fb,10,1,0" P1="533,351" P2="533,454"/><JD c="1500fb,10,1,0" P1="195,485" P2="195,557"/><JD c="1500fb,10,1,0" P1="585,485" P2="585,557"/><JD c="1500fb,10,1,0" P1="143,406" P2="143,479"/><JD c="1500fb,10,1,0" P1="637,406" P2="637,479"/><JD c="1500fb,10,1,0" P1="247,511" P2="247,560"/><JD c="1500fb,10,1,0" P1="533,511" P2="533,560"/><JD c="1500fb,10,1,0" P1="273,613" P2="273,664"/><JD c="1500fb,10,1,0" P1="507,613" P2="507,664"/><JD c="1500fb,10,1,0" P1="143,612" P2="143,663"/><JD c="1500fb,10,1,0" P1="637,612" P2="637,663"/><JD c="1500fb,10,1,0" P1="325,613" P2="325,716"/><JD c="1500fb,10,1,0" P1="455,613" P2="455,716"/><JD c="000000,6,1,0" P1="91,40" P2="91,143"/><JD c="000000,6,1,0" P1="689,40" P2="689,143"/><JD c="000000,6,1,0" P1="91,198" P2="91,713"/><JD c="000000,6,1,0" P1="689,198" P2="689,713"/><JD c="000000,6,1,0" P1="273,143" P2="273,244"/><JD c="000000,6,1,0" P1="507,143" P2="507,244"/><JD c="000000,6,1,0" P1="325,91" P2="325,163"/><JD c="000000,6,1,0" P1="455,91" P2="455,163"/><JD c="000000,6,1,0" P1="272,142" P2="199,142"/><JD c="000000,6,1,0" P1="508,142" P2="581,142"/><JD c="000000,6,1,0" P1="244,299" P2="174,299"/><JD c="000000,6,1,0" M1="69" M2="69" P1="419,302" P2="361,302"/><JD c="000000,6,1,0" M1="69" M2="69" P1="480,382" P2="480,324"/><JD c="000000,6,1,0" M1="69" M2="69" P1="300,382" P2="300,324"/><JD c="000000,6,1,0" P1="536,299" P2="606,299"/><JD c="000000,6,1,0" P1="245,351" P2="174,351"/><JD c="000000,6,1,0" P1="535,351" P2="606,351"/><JD c="1500fb,3,1,0" P1="141,403" P2="197,403"/><JD c="000000,6,1,0" P1="91,716" P2="689,716"/><JD c="1500fb,3,1,0" P1="639,403" P2="583,403"/><JD c="1500fb,3,1,0" P1="96,529" P2="142,529"/><JD c="1500fb,3,1,0" P1="684,529" P2="638,529"/><JD c="000000,6,1,0" P1="321,454" P2="249,454"/><JD c="000000,6,1,0" P1="478,507" P2="302,507"/><JD c="000000,6,1,0" P1="479,403" P2="301,403"/><JD c="000000,6,1,0" P1="459,454" P2="531,454"/><JD c="000000,6,1,0" P1="322,560" P2="249,560"/><JD c="000000,6,1,0" P1="458,560" P2="531,560"/><JD c="000000,6,1,0" P1="218,611" P2="144,611"/><JD c="000000,6,1,0" P1="562,611" P2="636,611"/><JD c="000000,6,1,0" P1="273,664" P2="200,664"/><JD c="000000,6,1,0" P1="507,664" P2="580,664"/><JD c="000000,6,1,0" P1="323,91" P2="250,91"/><JD c="000000,6,1,0" P1="457,91" P2="530,91"/><JD c="000000,6,1,0" P1="192,91" P2="144,91"/><JD c="000000,6,1,0" P1="588,91" P2="636,91"/><JD c="000000,6,1,0" P1="351,302" P2="301,302"/><JD c="000000,6,1,0" P1="429,302" P2="479,302"/><JD c="000000,6,1,0" P1="140,143" P2="92,143"/><JD c="000000,6,1,0" P1="640,143" P2="688,143"/><JD c="000000,6,1,0" P1="480,302" P2="480,314"/><JD c="000000,6,1,0" P1="300,302" P2="300,314"/><JD c="000000,6,1,0" P1="480,391" P2="480,402"/><JD c="000000,6,1,0" P1="300,391" P2="300,402"/><JD c="000000,6,1,0" P1="247,351" P2="247,454"/><JD c="000000,6,1,0" P1="533,351" P2="533,454"/><JD c="000000,6,1,0" P1="195,485" P2="195,557"/><JD c="000000,6,1,0" P1="585,485" P2="585,557"/><JD c="000000,6,1,0" P1="143,408" P2="143,479"/><JD c="000000,6,1,0" P1="637,407" P2="637,479"/><JD c="000000,6,1,0" P1="247,511" P2="247,560"/><JD c="000000,6,1,0" P1="533,511" P2="533,560"/><JD c="000000,6,1,0" P1="273,613" P2="273,664"/><JD c="000000,6,1,0" P1="507,613" P2="507,664"/><JD c="000000,6,1,0" P1="143,612" P2="143,663"/><JD c="000000,6,1,0" P1="637,612" P2="637,663"/><JD c="000000,6,1,0" P1="325,613" P2="325,716"/><JD c="000000,6,1,0" P1="455,613" P2="455,716"/><JD c="1500fb,3,1,0" P1="88,196" P2="144,196"/><JD c="1500fb,3,1,0" P1="692,196" P2="636,196"/><JD c="1500fb,3,1,0" P1="193,195" P2="223,195"/><JD c="1500fb,3,1,0" P1="376,563" P2="404,563"/><JD c="000000,6,1,0" P1="91,39" P2="689,39"/><JD c="1500fb,3,1,0" P1="376,457" P2="404,457"/><JD c="1500fb,3,1,0" P1="376,663" P2="404,663"/><JD c="1500fb,3,1,0" P1="587,195" P2="557,195"/><JD c="1500fb,3,1,0" P1="402,89" P2="378,89"/><JD c="1500fb,3,1,0" P1="458,220" P2="402,220"/><JD c="1500fb,3,1,0" P1="378,220" P2="324,220"/><JD c="1500fb,3,1,0" P1="458,249" P2="324,249"/><JD c="1500fb,3,1,0" P1="96,297" P2="117,297"/><JD c="1500fb,3,1,0" P1="684,297" P2="663,297"/><JD c="1500fb,3,1,0" P1="148,431" P2="196,431"/><JD c="1500fb,3,1,0" P1="632,431" P2="584,431"/><JD c="1500fb,3,1,0" P1="96,561" P2="142,561"/><JD c="1500fb,3,1,0" P1="684,561" P2="638,561"/><JD c="1500fb,3,1,0" P1="96,353" P2="117,353"/><JD c="1500fb,3,1,0" P1="684,353" P2="663,353"/><JD c="1500fb,3,1,0" P1="96,248" P2="144,248"/><JD c="1500fb,3,1,0" P1="684,248" P2="636,248"/><JD c="1500fb,3,1,0" P1="144,197" P2="144,248"/><JD c="1500fb,3,1,0" P1="324,220" P2="324,248"/><JD c="1500fb,3,1,0" P1="458,220" P2="458,248"/><JD c="1500fb,3,1,0" P1="636,197" P2="636,248"/><JD c="1500fb,3,1,0" P1="117,297" P2="117,353"/><JD c="1500fb,3,1,0" P1="663,297" P2="663,353"/><JD c="1500fb,3,1,0" P1="197,403" P2="197,431"/><JD c="1500fb,3,1,0" P1="404,457" P2="404,502"/><JD c="1500fb,3,1,0" P1="376,457" P2="376,502"/><JD c="1500fb,3,1,0" P1="583,403" P2="583,431"/><JD c="1500fb,3,1,0" P1="142.17,529" P2="142.17,560"/><JD c="1500fb,3,1,0" P1="637.83,529" P2="637.83,560"/><JD c="1500fb,3,1,0" P1="193,195" P2="193,294"/><JD c="1500fb,3,1,0" P1="376,563" P2="376,662"/><JD c="1500fb,3,1,0" P1="587,195" P2="587,294"/><JD c="1500fb,3,1,0" P1="401.79,89" P2="401.79,218"/><JD c="1500fb,3,1,0" P1="223,195" P2="223,294"/><JD c="1500fb,3,1,0" P1="404,563" P2="404,662"/><JD c="1500fb,3,1,0" P1="557,195" P2="557,294"/><JD c="1500fb,3,1,0" P1="378,89" P2="378,218"/><JD c="000000,3,1,0" P1="560,298.16" P2="560,274.75"/><JD c="000000,3,1,0" P1="196,298.16" P2="196,274.75"/><JD c="000000,3,1,0" P1="379,506.16" P2="379,482.75"/><JD c="000000,3,1,0" P1="561,295" P2="583,295"/><JD c="000000,3,1,0" P1="197,295" P2="219,295"/><JD c="000000,3,1,0" P1="379,503" P2="400,503"/><JD c="000000,3,1,0" P1="685,556" P2="685,534"/><JD c="000000,3,1,0" P1="633,428" P2="633,408"/><JD c="000000,3,1,0" P1="147,428" P2="147,408"/><JD c="000000,3,1,0" P1="95,556" P2="95,534"/><JD c="000000,3,1,0" P1="685,348" P2="685,300"/><JD c="000000,3,1,0" P1="95,348" P2="95,300"/><JD c="000000,3,1,0" P1="685,244" P2="685,199"/><JD c="000000,3,1,0" P1="95,244" P2="95,199"/><JD c="000000,3,1,0" P1="584,298.16" P2="584,274.75"/><JD c="000000,3,1,0" P1="220,298.16" P2="220,274.75"/><JD c="000000,3,1,0" P1="401,506.16" P2="401,482.75"/><JD c="000000,3,1,0" P1="687,532" P2="664,532"/><JD c="000000,3,1,0" P1="635,406" P2="612,406"/><JD c="000000,3,1,0" P1="143,406" P2="168,406"/><JD c="000000,3,1,0" P1="93,532" P2="116,532"/><JD c="000000,3,1,0" P1="687,300" P2="673,300"/><JD c="000000,3,1,0" P1="93,300" P2="107,300"/><JD c="000000,3,1,0" P1="687,199" P2="673,199"/><JD c="000000,3,1,0" P1="93,199" P2="107,199"/><JD c="000000,3,1,0" P1="695,193" P2="681,193"/><JD c="000000,3,1,0" P1="85,193" P2="99,193"/><JD c="000000,3,1,0" P1="687,558" P2="664,558"/><JD c="000000,3,1,0" P1="635,428" P2="612,428"/><JD c="000000,3,1,0" P1="145,428" P2="168,428"/><JD c="000000,3,1,0" P1="93,558" P2="116,558"/><JD c="000000,3,1,0" P1="687,350" P2="673,350"/><JD c="000000,3,1,0" P1="93,350" P2="107,350"/><JD c="1500fb,10,1,0" P1="91,189" P2="91,153"/><JD c="1500fb,10,1,0" P1="689,189" P2="689,153"/><JD c="000000,3,1,0" P1="687,245" P2="673,245"/><JD c="000000,3,1,0" P1="93,245" P2="107,245"/><JD c="000000,6,1,0" P1="91,189" P2="91,153"/><JD c="000000,6,1,0" P1="689,189" P2="689,153"/></L></Z></C>]]})
pacmice_maps[#pacmice_maps].pathes = {{1, 1}, {2, 1}, {3, 1}, {4, 1}, {5, 1}, {6, 1}, {7, 1}, {8, 1}, {9, 1}, {10, 1}, {11, 1}, {12, 1}, {13, 1}, {14, 1}, {15, 1}, {16, 1}, {17, 1}, {18, 1}, {19, 1}, {20, 1}, {21, 1}, {22, 1}, {1, 2}, {5, 2}, {10, 2}, {13, 2}, {18, 2}, {22, 2}, {1, 3}, {2, 3}, {3, 3}, {4, 3}, {5, 3}, {6, 3}, {7, 3}, {8, 3}, {10, 3}, {13, 3}, {15, 3}, {16, 3}, {17, 3}, {18, 3}, {19, 3}, {20, 3}, {21, 3}, {22, 3}, {3, 4}, {8, 4}, {10, 4}, {13, 4}, {15, 4}, {20, 4}, {1, 5}, {2, 5}, {3, 5}, {4, 5}, {5, 5}, {6, 5}, {8, 5}, {10, 5}, {13, 5}, {15, 5}, {17, 5}, {18, 5}, {19, 5}, {20, 5}, {21, 5}, {22, 5}, {3, 6}, {6, 6}, {8, 6}, {9, 6}, {10, 6}, {13, 6}, {14, 6}, {15, 6}, {17, 6}, {20, 6}, {3, 7}, {6, 7}, {8, 7}, {15, 7}, {17, 7}, {20, 7}, {3, 8}, {6, 8}, {8, 8}, {15, 8}, {17, 8}, {20, 8}, {1, 9}, {2, 9}, {3, 9}, {6, 9}, {7, 9}, {8, 9}, {9, 9}, {10, 9}, {11, 9}, {12, 9}, {13, 9}, {14, 9}, {15, 9}, {16, 9}, {17, 9}, {20, 9}, {21, 9}, {22, 9}, {2, 10}, {7, 10}, {16, 10}, {21, 10}, {2, 11}, {3, 11}, {4, 11}, {5, 11}, {6, 11}, {7, 11}, {16, 11}, {17, 11}, {18, 11}, {19, 11}, {20, 11}, {21, 11}, {2, 12}, {7, 12}, {16, 12}, {21, 12}, {1, 13}, {2, 13}, {3, 13}, {4, 13}, {5, 13}, {7, 13}, {16, 13}, {18, 13}, {19, 13}, {20, 13}, {21, 13}, {22, 13}, {1, 14}, {5, 14}, {7, 14}, {16, 14}, {18, 14}, {22, 14}, {1, 15}, {5, 15}, {7, 15}, {8, 15}, {9, 15}, {10, 15}, {11, 15}, {12, 15}, {13, 15}, {14, 15}, {15, 15}, {16, 15}, {18, 15}, {22, 15}, {1, 16}, {3, 16}, {4, 16}, {5, 16}, {10, 16}, {13, 16}, {18, 16}, {19, 16}, {20, 16}, {22, 16}, {1, 17}, {3, 17}, {5, 17}, {6, 17}, {7, 17}, {8, 17}, {9, 17}, {10, 17}, {13, 17}, {14, 17}, {15, 17}, {16, 17}, {17, 17}, {18, 17}, {20, 17}, {22, 17}, {1, 18}, {2, 18}, {3, 18}, {5, 18}, {7, 18}, {16, 18}, {18, 18}, {20, 18}, {21, 18}, {22, 18}, {3, 19}, {5, 19}, {7, 19}, {8, 19}, {9, 19}, {10, 19}, {11, 19}, {12, 19}, {13, 19}, {14, 19}, {15, 19}, {16, 19}, {18, 19}, {20, 19}, {3, 20}, {5, 20}, {10, 20}, {13, 20}, {18, 20}, {20, 20}, {1, 21}, {2, 21}, {3, 21}, {4, 21}, {5, 21}, {6, 21}, {7, 21}, {8, 21}, {9, 21}, {10, 21}, {13, 21}, {14, 21}, {15, 21}, {16, 21}, {17, 21}, {18, 21}, {19, 21}, {20, 21}, {21, 21}, {22, 21}, {1, 22}, {6, 22}, {8, 22}, {10, 22}, {13, 22}, {15, 22}, {17, 22}, {22, 22}, {1, 23}, {3, 23}, {4, 23}, {5, 23}, {6, 23}, {8, 23}, {10, 23}, {13, 23}, {15, 23}, {17, 23}, {18, 23}, {19, 23}, {20, 23}, {22, 23}, {1, 24}, {3, 24}, {8, 24}, {10, 24}, {13, 24}, {15, 24}, {20, 24}, {22, 24}, {1, 25}, {2, 25}, {3, 25}, {4, 25}, {5, 25}, {6, 25}, {7, 25}, {8, 25}, {10, 25}, {11, 25}, {12, 25}, {13, 25}, {15, 25}, {16, 25}, {17, 25}, {18, 25}, {19, 25}, {20, 25}, {21, 25}, {22, 25}}
pacmice_maps[#pacmice_maps].foods = {{x = 170, y = 65}, {x = 390, y = 65}, {x = 607, y = 65}, {x = 347, y = 201}, {x = 432, y = 201}, {x = 390, y = 278}, {x = 203, y = 326}, {x = 574, y = 326}, {x = 170, y = 454}, {x = 345, y = 487}, {x = 390, y = 537}, {x = 435, y = 487}, {x = 607, y = 454}, {x = 170, y = 638}, {x = 235, y = 690}, {x = 390, y = 690}, {x = 540, y = 690}, {x = 607, y = 642}}
-- map 3 (v4)
table.insert(pacmice_maps, {x = 10, y = 27, cell_w = 26, cell_h = 26, grid_w = 31, grid_h = 15, wall_size = 14, web_x = -100, pac_count = 1, xml = [[<C><P DS="m;360,85,440,85" /><Z><S><S T="12" X="190" Y="157" L="58" H="10" P="0,0,0.3,0.2,180,0,0,0"/><S T="12" X="612" Y="157" L="58" H="10" P="0,0,0.3,0.2,-180,0,0,0"/><S T="12" X="788" Y="208" L="369" H="10" P="0,0,0.6,0.2,90,0,0,0"/><S T="12" X="400" Y="27" L="10" H="781" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="400" Y="391" L="10" H="781" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="10" Y="208" L="372" H="10" P="0,0,0.6,0.2,90,0,0,0"/><S T="12" X="166" Y="119" L="10" H="84" P="0,0,0.6,0.2,180,0,0,0"/><S T="12" X="219" Y="69" L="10" H="84" P="0,0,0.6,0.2,180,0,0,0"/><S T="12" X="583" Y="69" L="10" H="84" P="0,0,0.6,0.2,180,0,0,0"/><S T="12" X="636" Y="119" L="10" H="84" P="0,0,0.6,0.2,-180,0,0,0"/><S T="12" X="401" Y="326" L="32" H="157" P="0,0,0.3,0.2,-450,0,0,0"/><S T="12" X="400" Y="44" L="32" H="157" P="0,0,0.3,0.2,-450,0,0,0"/><S T="12" X="258" Y="305" L="73" H="31" P="0,0,0.6,0.2,90,0,0,0"/><S T="12" X="158" Y="326" L="73" H="31" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="644" Y="326" L="73" H="31" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="544" Y="306" L="75" H="31" P="0,0,0.6,0.2,-90,0,0,0"/><S T="12" X="114" Y="223" L="81" H="10" P="0,0,0.6,0.2,90,0,0,0"/><S T="12" X="687" Y="223" L="81" H="10" P="0,0,0.6,0.2,-90,0,0,0"/><S T="12" X="62" Y="167" L="81" H="10" P="0,0,0.6,0.2,-90,0,0,0"/><S T="12" X="740" Y="167" L="81" H="10" P="0,0,0.6,0.2,90,0,0,0"/><S T="12" X="738" Y="327" L="34" H="10" P="0,0,0.6,0.2,90,0,0,0"/><S T="12" X="62" Y="327" L="34" H="10" P="0,0,0.6,0.2,-90,0,0,0"/><S T="12" X="322" Y="157" L="10" H="110" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="477" Y="157" L="10" H="108" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="271" Y="117" L="10" H="83" P="0,0,0.6,0.2,0,0,0,0"/><S T="12" X="400" Y="70" L="10" H="83" P="0,0,0.6,0.2,0,0,0,0"/><S T="12" X="530" Y="120" L="10" H="83" P="0,0,0.6,0.2,0,0,0,0"/><S T="12" X="219" Y="263" L="10" H="108" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="116" Y="351" L="10" H="82" P="0,0,0.6,0.2,0,0,0,0"/><S T="12" X="686" Y="350" L="10" H="78" P="0,0,0.6,0.2,0,0,0,0"/><S T="12" X="582" Y="263" L="10" H="107" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="217" Y="209" L="10" H="105" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="583" Y="209" L="10" H="106" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="66" Y="261" L="10" H="106" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="733" Y="261" L="10" H="99" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="89" Y="131" L="10" H="59" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="714" Y="131" L="10" H="59" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="65" Y="79" L="10" H="105" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="738" Y="79" L="10" H="105" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="400" Y="260" L="166" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="400" Y="106" L="162" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="342" Y="212" L="47" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="459" Y="212" L="47" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="400" Y="212" L="67" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000"/><S T="12" X="479" Y="236" L="54" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="322" Y="236" L="54" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="400" Y="410" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="90000"/><S T="12" X="400" Y="410" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="89000"/><S T="12" X="400" Y="410" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="88000"/><S T="12" X="400" Y="410" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="87000"/><S T="12" X="400" Y="410" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="86000"/><S T="12" X="400" Y="410" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="85000"/></S><D><F X="351" Y="248" D=""/><F X="450" Y="247" D=""/><T X="399" Y="254" D=""/></D><O/><L><JD c="000000,250,1,0" P1="-313,-1676" P2="-313,2324"/><JD c="000000,250,1,0" P1="-113,-1666" P2="-113,2334"/><JD c="000000,250,1,0" P1="87,-1666" P2="87,2334"/><JD c="000000,250,1,0" P1="287,-1666" P2="287,2334"/><JD c="000000,250,1,0" P1="487,-1666" P2="487,2334"/><JD c="000000,250,1,0" P1="687,-1666" P2="687,2334"/><JD c="000000,250,1,0" P1="887,-1656" P2="887,2344"/><JD c="000000,250,1,0" P1="1087,-1646" P2="1087,2354"/><JD c="1500fb,10,1,0" P1="788,27" P2="788,391"/><JD c="1500fb,10,1,0" P1="10,27" P2="10,391"/><JD c="1500fb,10,1,0" P1="787,27" P2="12,27"/><JD c="1500fb,10,1,0" P1="787,391" P2="12,391"/><JD c="1500fb,10,1,0" P1="478,106" P2="323,106"/><JD c="1500fb,10,1,0" P1="400,29" P2="400,106"/><JD c="FFFFFF,10,1,0" M1="46" M2="46" P1="429,212.41" P2="371,212.41"/><JD c="FFFFFF,10,1,0" M1="46" M2="46" P1="478.59,259" P2="478.59,213"/><JD c="FFFFFF,10,1,0" M1="46" M2="46" P1="321.59,259" P2="321.59,213"/><JD c="1500fb,10,1,0" M1="47" M2="47" P1="429,212.41" P2="371,212.41"/><JD c="1500fb,10,1,0" M1="47" M2="47" P1="478.59,259" P2="478.59,213"/><JD c="1500fb,10,1,0" M1="47" M2="47" P1="321.59,259" P2="321.59,213"/><JD c="FFFFFF,10,1,0" M1="48" M2="48" P1="429,212.41" P2="371,212.41"/><JD c="FFFFFF,10,1,0" M1="48" M2="48" P1="478.59,259" P2="478.59,213"/><JD c="FFFFFF,10,1,0" M1="48" M2="48" P1="321.59,259" P2="321.59,213"/><JD c="1500fb,10,1,0" M1="49" M2="49" P1="429,212.41" P2="371,212.41"/><JD c="1500fb,10,1,0" M1="49" M2="49" P1="478.59,259" P2="478.59,213"/><JD c="1500fb,10,1,0" M1="49" M2="49" P1="321.59,259" P2="321.59,213"/><JD c="FFFFFF,10,1,0" M1="50" M2="50" P1="429,212.41" P2="371,212.41"/><JD c="FFFFFF,10,1,0" M1="50" M2="50" P1="478.59,259" P2="478.59,213"/><JD c="FFFFFF,10,1,0" M1="50" M2="50" P1="321.59,259" P2="321.59,213"/><JD c="1500fb,10,1,0" M1="51" M2="51" P1="429,212.41" P2="371,212.41"/><JD c="1500fb,10,1,0" M1="51" M2="51" P1="478.59,259" P2="478.59,213"/><JD c="1500fb,10,1,0" M1="51" M2="51" P1="321.59,259" P2="321.59,213"/><JD c="1500fb,10,1,0" P1="738,314" P2="738,339"/><JD c="1500fb,10,1,0" P1="62,314" P2="62,339"/><JD c="1500fb,10,1,0" P1="478,260" P2="322,260"/><JD c="1500fb,10,1,0" P1="271,80" P2="271,156"/><JD c="1500fb,10,1,0" P1="530,83" P2="530,155"/><JD c="1500fb,10,1,0" P1="166,82" P2="166,155"/><JD c="1500fb,10,1,0" P1="219,28" P2="219,105"/><JD c="1500fb,10,1,0" P1="583,28" P2="583,105"/><JD c="1500fb,10,1,0" P1="636,82" P2="636,155"/><JD c="1500fb,10,1,0" P1="114,186" P2="114,260"/><JD c="1500fb,10,1,0" P1="687,186" P2="687,260"/><JD c="1500fb,10,1,0" P1="62,131" P2="62,204"/><JD c="1500fb,10,1,0" P1="740,131" P2="740,204"/><JD c="1500fb,10,1,0" P1="361,212" P2="322,212"/><JD c="1500fb,10,1,0" P1="439,212" P2="478,212"/><JD c="1500fb,10,1,0" P1="372,157" P2="271,157"/><JD c="1500fb,10,1,0" P1="428,157" P2="530,157"/><JD c="1500fb,10,1,0" P1="266,209" P2="168,209"/><JD c="1500fb,3,1,0" P1="323,31" P2="323,58"/><JD c="1500fb,10,1,0" P1="533,209" P2="632,209"/><JD c="1500fb,10,1,0" P1="269,263" P2="169,263"/><JD c="1500fb,3,1,0" P1="477,31" P2="477,58"/><JD c="1500fb,10,1,0" P1="116.45,314.92" P2="116.45,389.92"/><JD c="1500fb,10,1,0" P1="686.05,314.92" P2="686.05,389.92"/><JD c="1500fb,10,1,0" P1="534,263" P2="632,263"/><JD c="1500fb,10,1,0" P1="215,157" P2="166,157"/><JD c="1500fb,10,1,0" P1="587,157" P2="636,157"/><JD c="1500fb,10,1,0" P1="113,131" P2="62,131"/><JD c="1500fb,10,1,0" P1="689,131" P2="740,131"/><JD c="1500fb,10,1,0" P1="113,261" P2="10,261"/><JD c="1500fb,10,1,0" P1="688,261" P2="787,261"/><JD c="1500fb,10,1,0" P1="113,79" P2="10,79"/><JD c="1500fb,10,1,0" P1="689,79" P2="788,79"/><JD c="1500fb,3,1,0" P1="323,58" P2="477,58"/><JD c="000000,6,1,0" P1="787,27" P2="12,27"/><JD c="000000,6,1,0" P1="787,391" P2="12,391"/><JD c="000000,6,1,0" P1="478,106" P2="323,106"/><JD c="000000,6,1,0" P1="400,29" P2="400,106"/><JD c="000000,6,1,0" M1="46" M2="46" P1="429,212.41" P2="371,212.41"/><JD c="000000,6,1,0" M1="46" M2="46" P1="478.59,259" P2="478.59,213"/><JD c="000000,6,1,0" M1="46" M2="46" P1="321.59,259" P2="321.59,213"/><JD c="000000,6,1,0" P1="738,314" P2="738,339"/><JD c="000000,6,1,0" P1="62,314" P2="62,339"/><JD c="1500fb,3,1,0" P1="272,261" P2="272,340"/><JD c="1500fb,3,1,0" P1="114.45,311.92" P2="193.45,311.92"/><JD c="1500fb,3,1,0" P1="688.05,311.92" P2="609.05,311.92"/><JD c="1500fb,3,1,0" P1="530,261" P2="530,342"/><JD c="000000,6,1,0" P1="10,27" P2="10,391"/><JD c="000000,6,1,0" P1="478,260" P2="322,260"/><JD c="000000,6,1,0" P1="271,80" P2="271,156"/><JD c="000000,6,1,0" P1="530,83" P2="530,155"/><JD c="000000,6,1,0" P1="166,82" P2="166,155"/><JD c="000000,6,1,0" P1="219,28" P2="219,105"/><JD c="000000,6,1,0" P1="583,28" P2="583,105"/><JD c="000000,6,1,0" P1="636,82" P2="636,155"/><JD c="000000,6,1,0" P1="114,186" P2="114,260"/><JD c="000000,6,1,0" P1="687,186" P2="687,260"/><JD c="000000,6,1,0" P1="62,131" P2="62,204"/><JD c="000000,6,1,0" P1="740,131" P2="740,204"/><JD c="000000,6,1,0" P1="361,212" P2="322,212"/><JD c="000000,6,1,0" P1="439,212" P2="478,212"/><JD c="000000,6,1,0" P1="372,157" P2="271,157"/><JD c="000000,6,1,0" P1="428,157" P2="530,157"/><JD c="000000,6,1,0" P1="266,209" P2="168,209"/><JD c="000000,6,1,0" P1="533,209" P2="632,209"/><JD c="000000,6,1,0" P1="267,263" P2="169,263"/><JD c="000000,6,1,0" P1="116.45,316.92" P2="116.45,389.92"/><JD c="000000,6,1,0" P1="686.05,316.92" P2="686.05,389.92"/><JD c="000000,6,1,0" P1="535,263" P2="632,263"/><JD c="000000,6,1,0" P1="215,157" P2="166,157"/><JD c="000000,6,1,0" P1="587,157" P2="636,157"/><JD c="000000,6,1,0" P1="113,131" P2="62,131"/><JD c="000000,6,1,0" P1="689,131" P2="740,131"/><JD c="000000,6,1,0" P1="113,261" P2="10,261"/><JD c="000000,6,1,0" P1="688,261" P2="787,261"/><JD c="000000,6,1,0" P1="113,79" P2="10,79"/><JD c="000000,6,1,0" P1="689,79" P2="788,79"/><JD c="1500fb,3,1,0" P1="324,312" P2="324,340"/><JD c="000000,6,1,0" P1="788,27" P2="788,391"/><JD c="1500fb,3,1,0" P1="478,312" P2="478,340"/><JD c="1500fb,3,1,0" P1="244,268" P2="244,340"/><JD c="1500fb,3,1,0" P1="121.45,339.92" P2="193.45,339.92"/><JD c="1500fb,3,1,0" P1="681.05,339.92" P2="609.05,339.92"/><JD c="1500fb,3,1,0" P1="558,268" P2="558,342"/><JD c="1500fb,3,1,0" P1="272,340" P2="244,340"/><JD c="1500fb,3,1,0" P1="193.45,311.92" P2="193.45,339.92"/><JD c="1500fb,3,1,0" P1="609.05,311.92" P2="609.05,339.92"/><JD c="1500fb,3,1,0" P1="530,342" P2="558,342"/><JD c="1500fb,3,1,0" P1="324,312" P2="478,312"/><JD c="1500fb,3,1,0" P1="324,340" P2="478,340"/><JD c="000000,3,1,0" P1="247,267" P2="267,267"/><JD c="000000,3,1,0" P1="326,31" P2="473,31"/><JD c="000000,3,1,0" P1="390,55" P2="410,55"/><JD c="000000,3,1,0" P1="120.45,336.92" P2="120.45,316.92"/><JD c="000000,3,1,0" P1="682.05,336.92" P2="682.05,316.92"/><JD c="000000,3,1,0" P1="555,267" P2="535,267"/><JD c="000000,3,1,0" P1="269,263" P2="269,288"/><JD c="000000,3,1,0" P1="404,29" P2="404,54"/><JD c="000000,3,1,0" P1="116.45,314.92" P2="141.45,314.92"/><JD c="000000,3,1,0" P1="686.05,314.92" P2="661.05,314.92"/><JD c="000000,3,1,0" P1="533,263" P2="533,288"/><JD c="000000,3,1,0" P1="247,265" P2="247,288"/><JD c="000000,3,1,0" P1="396,30" P2="396,53"/><JD c="000000,3,1,0" P1="474,31" P2="474,54"/><JD c="000000,3,1,0" P1="326,31" P2="326,54"/><JD c="000000,3,1,0" P1="118.45,336.92" P2="141.45,336.92"/><JD c="000000,3,1,0" P1="684.05,336.92" P2="661.05,336.92"/><JD c="000000,3,1,0" P1="555,265" P2="555,288"/></L></Z></C>]]})
pacmice_maps[#pacmice_maps].pathes = {{1, 1}, {2, 1}, {3, 1}, {4, 1}, {5, 1}, {6, 1}, {7, 1}, {9, 1}, {10, 1}, {11, 1}, {19, 1}, {20, 1}, {21, 1}, {23, 1}, {24, 1}, {25, 1}, {26, 1}, {27, 1}, {28, 1}, {29, 1}, {5, 2}, {7, 2}, {9, 2}, {11, 2}, {12, 2}, {13, 2}, {14, 2}, {16, 2}, {17, 2}, {18, 2}, {19, 2}, {21, 2}, {23, 2}, {25, 2}, {1, 3}, {2, 3}, {3, 3}, {4, 3}, {5, 3}, {7, 3}, {9, 3}, {11, 3}, {19, 3}, {21, 3}, {23, 3}, {25, 3}, {26, 3}, {27, 3}, {28, 3}, {29, 3}, {1, 4}, {5, 4}, {7, 4}, {8, 4}, {9, 4}, {11, 4}, {12, 4}, {13, 4}, {14, 4}, {15, 4}, {16, 4}, {17, 4}, {18, 4}, {19, 4}, {21, 4}, {22, 4}, {23, 4}, {25, 4}, {29, 4}, {1, 5}, {3, 5}, {4, 5}, {5, 5}, {9, 5}, {15, 5}, {21, 5}, {25, 5}, {26, 5}, {27, 5}, {29, 5}, {1, 6}, {3, 6}, {5, 6}, {6, 6}, {7, 6}, {8, 6}, {9, 6}, {10, 6}, {11, 6}, {12, 6}, {13, 6}, {14, 6}, {15, 6}, {16, 6}, {17, 6}, {18, 6}, {19, 6}, {20, 6}, {21, 6}, {22, 6}, {23, 6}, {24, 6}, {25, 6}, {27, 6}, {29, 6}, {1, 7}, {3, 7}, {5, 7}, {11, 7}, {19, 7}, {25, 7}, {27, 7}, {29, 7}, {1, 8}, {2, 8}, {3, 8}, {5, 8}, {6, 8}, {7, 8}, {8, 8}, {9, 8}, {10, 8}, {11, 8}, {19, 8}, {20, 8}, {21, 8}, {22, 8}, {23, 8}, {24, 8}, {25, 8}, {27, 8}, {28, 8}, {29, 8}, {5, 9}, {11, 9}, {19, 9}, {25, 9}, {1, 10}, {2, 10}, {3, 10}, {4, 10}, {5, 10}, {6, 10}, {7, 10}, {8, 10}, {11, 10}, {12, 10}, {13, 10}, {14, 10}, {15, 10}, {16, 10}, {17, 10}, {18, 10}, {19, 10}, {22, 10}, {23, 10}, {24, 10}, {25, 10}, {26, 10}, {27, 10}, {28, 10}, {29, 10}, {1, 11}, {3, 11}, {8, 11}, {11, 11}, {19, 11}, {22, 11}, {27, 11}, {1, 12}, {3, 12}, {8, 12}, {11, 12}, {19, 12}, {22, 12}, {27, 12}, {1, 13}, {2, 13}, {3, 13}, {5, 13}, {6, 13}, {7, 13}, {8, 13}, {9, 13}, {10, 13}, {11, 13}, {12, 13}, {13, 13}, {14, 13}, {15, 13}, {16, 13}, {17, 13}, {18, 13}, {19, 13}, {20, 13}, {21, 13}, {22, 13}, {23, 13}, {24, 13}, {25, 13}, {27, 13}, {28, 13}, {29, 13}}
pacmice_maps[#pacmice_maps].foods = {{x = 35, y = 53}, {x = 191, y = 130}, {x = 62, y = 235}, {x = 35, y = 364}, {x = 145, y = 364}, {x = 250, y = 235}, {x = 400, y = 189}, {x = 400, y = 364}, {x = 545, y = 235}, {x = 605, y = 130}, {x = 657, y = 364}, {x = 765, y = 364}, {x = 245, y = 235}, {x = 765, y = 53}}
-- (v5)
table.insert(pacmice_maps, {x = 10, y = 27, cell_w = 26, cell_h = 26, grid_w = 31, grid_h = 15, wall_size = 14, web_x = -100, pac_count = 1, xml = [[<C><P DS="m;258,58,545,58" /><Z><S><S T="12" X="190" Y="259" L="58" H="10" P="0,0,0.3,0.2,720,0,0,0"/><S T="12" X="610" Y="260" L="58" H="10" P="0,0,0.3,0.2,360,0,0,0"/><S T="12" X="788" Y="210" L="369" H="10" P="0,0,0.6,0.2,630,0,0,0"/><S T="12" X="400" Y="27" L="10" H="781" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="400" Y="391" L="10" H="781" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="10" Y="210" L="372" H="10" P="0,0,0.6,0.2,630,0,0,0"/><S T="12" X="166" Y="297" L="10" H="84" P="0,0,0.6,0.2,720,0,0,0"/><S T="12" X="218" Y="347" L="10" H="84" P="0,0,0.6,0.2,720,0,0,0"/><S T="12" X="582" Y="347" L="10" H="84" P="0,0,0.6,0.2,720,0,0,0"/><S T="12" X="634" Y="298" L="10" H="84" P="0,0,0.6,0.2,360,0,0,0"/><S T="12" X="401" Y="90" L="32" H="157" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="400" Y="377" L="32" H="157" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="258" Y="111" L="73" H="31" P="0,0,0.6,0.2,630,0,0,0"/><S T="12" X="157" Y="91" L="73" H="31" P="0,0,0.3,0.2,540,0,0,0"/><S T="12" X="645" Y="91" L="73" H="31" P="0,0,0.3,0.2,540,0,0,0"/><S T="12" X="544" Y="110" L="75" H="31" P="0,0,0.6,0.2,450,0,0,0"/><S T="12" X="114" Y="193" L="81" H="10" P="0,0,0.6,0.2,630,0,0,0"/><S T="12" X="687" Y="193" L="81" H="10" P="0,0,0.6,0.2,450,0,0,0"/><S T="12" X="62" Y="249" L="81" H="10" P="0,0,0.6,0.2,450,0,0,0"/><S T="12" X="739" Y="250" L="81" H="10" P="0,0,0.6,0.2,630,0,0,0"/><S T="12" X="738" Y="89" L="34" H="10" P="0,0,0.6,0.2,630,0,0,0"/><S T="12" X="62" Y="89" L="34" H="10" P="0,0,0.6,0.2,450,0,0,0"/><S T="12" X="285" Y="261" L="34" H="10" P="0,0,0.6,0.2,540,0,0,0"/><S T="12" X="518" Y="262" L="34" H="10" P="0,0,0.6,0.2,540,0,0,0"/><S T="12" X="400" Y="260" L="10" H="110" P="0,0,0.3,0.2,630,0,0,0"/><S T="12" X="271" Y="300" L="10" H="83" P="0,0,0.6,0.2,540,0,0,0"/><S T="12" X="530" Y="298" L="10" H="83" P="0,0,0.6,0.2,540,0,0,0"/><S T="12" X="219" Y="157" L="10" H="108" P="0,0,0.3,0.2,630,0,0,0"/><S T="12" X="115" Y="66" L="10" H="82" P="0,0,0.6,0.2,540,0,0,0"/><S T="12" X="687" Y="67" L="10" H="78" P="0,0,0.6,0.2,540,0,0,0"/><S T="12" X="582" Y="157" L="10" H="107" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="217" Y="207" L="10" H="105" P="0,0,0.3,0.2,630,0,0,0"/><S T="12" X="583" Y="207" L="10" H="106" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="66" Y="155" L="10" H="106" P="0,0,0.3,0.2,630,0,0,0"/><S T="12" X="733" Y="155" L="10" H="99" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="89" Y="285" L="10" H="59" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="713" Y="286" L="10" H="59" P="0,0,0.3,0.2,630,0,0,0"/><S T="12" X="65" Y="338" L="10" H="105" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="738" Y="337" L="10" H="105" P="0,0,0.3,0.2,630,0,0,0"/><S T="12" X="400" Y="206" L="166" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="400" Y="312" L="162" H="10" P="0,0,0.3,0.2,540,0,0,0"/><S T="12" X="479" Y="181" L="10" H="49" P="0,0,0.6,0.2,0,0,0,0" v="90000"/><S T="12" X="323" Y="181" L="10" H="49" P="0,0,0.6,0.2,0,0,0,0" v="90000"/><S T="12" X="342" Y="158" L="47" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="459" Y="158" L="47" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="400" Y="158" L="67" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000"/><S T="12" X="400" Y="408" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="85000"/><S T="12" X="400" Y="448" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="85000"/><S T="12" X="400" Y="408" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="86000"/><S T="12" X="400" Y="448" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="86000"/><S T="12" X="400" Y="407" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="87000"/><S T="12" X="400" Y="447" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="87000"/><S T="12" X="400" Y="408" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="88000"/><S T="12" X="400" Y="448" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="88000"/><S T="12" X="400" Y="408" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="89000"/><S T="12" X="400" Y="448" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="89000"/><S T="12" X="400" Y="408" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="90000"/><S T="12" X="400" Y="448" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="90000"/></S><D><F X="352" Y="195" D=""/><F X="452" Y="195" D=""/><T X="402" Y="201" D=""/></D><O/><L><JD c="000000,250,1,0" P1="-316,-1663" P2="-316,2337"/><JD c="000000,250,1,0" P1="-116,-1653" P2="-116,2347"/><JD c="000000,250,1,0" P1="84,-1653" P2="84,2347"/><JD c="000000,250,1,0" P1="284,-1653" P2="284,2347"/><JD c="000000,250,1,0" P1="484,-1653" P2="484,2347"/><JD c="000000,250,1,0" P1="684,-1653" P2="684,2347"/><JD c="000000,250,1,0" P1="884,-1643" P2="884,2357"/><JD c="000000,250,1,0" P1="1084,-1633" P2="1084,2367"/><JD c="1500fb,10,1,0" P1="788,391" P2="788,27"/><JD c="1500fb,10,1,0" P1="10,391" P2="10,27"/><JD c="1500fb,10,1,0" P1="787,27" P2="12,27"/><JD c="1500fb,10,1,0" P1="787,391" P2="12,391"/><JD c="1500fb,10,1,0" P1="477,312" P2="324,312"/><JD c="FFFFFF,10,1,0" M1="56" M2="56" P1="431,159" P2="373,159"/><JD c="1500fb,10,1,0" M1="54" M2="54" P1="431,159" P2="373,159"/><JD c="FFFFFF,10,1,0" M1="52" M2="52" P1="431,159" P2="373,159"/><JD c="1500fb,10,1,0" M1="50" M2="50" P1="431,159" P2="373,159"/><JD c="FFFFFF,10,1,0" M1="48" M2="48" P1="431,159" P2="373,159"/><JD c="1500fb,10,1,0" M1="46" M2="46" P1="431,159" P2="373,159"/><JD c="1500fb,10,1,0" P1="738,102" P2="738,77"/><JD c="1500fb,10,1,0" P1="62,102" P2="62,77"/><JD c="1500fb,10,1,0" P1="272,261" P2="297,261"/><JD c="1500fb,10,1,0" P1="505,262" P2="530,262"/><JD c="1500fb,10,1,0" P1="480,207" P2="324,207"/><JD c="1500fb,10,1,0" P1="271,337" P2="271,261"/><JD c="1500fb,10,1,0" P1="530,335" P2="530,263"/><JD c="1500fb,10,1,0" P1="166,334" P2="166,261"/><JD c="1500fb,10,1,0" P1="218,388" P2="218,311"/><JD c="1500fb,10,1,0" P1="582,388" P2="582,311"/><JD c="1500fb,10,1,0" P1="634,335" P2="634,262"/><JD c="1500fb,10,1,0" P1="114,230" P2="114,156"/><JD c="1500fb,10,1,0" P1="687,230" P2="687,156"/><JD c="1500fb,10,1,0" P1="62,285" P2="62,212"/><JD c="1500fb,10,1,0" P1="739,286" P2="739,213"/><JD c="1500fb,10,1,0" P1="363,159" P2="324,159"/><JD c="1500fb,10,1,0" P1="441,159" P2="480,159"/><JD c="FFFFFF,10,1,0" M1="57" M2="57" P1="480,159" P2="480,206"/><JD c="FFFFFF,10,1,0" M1="57" M2="57" P1="323,159" P2="323,206"/><JD c="1500fb,10,1,0" M1="55" M2="55" P1="480,159" P2="480,206"/><JD c="1500fb,10,1,0" M1="55" M2="55" P1="323,159" P2="323,206"/><JD c="FFFFFF,10,1,0" M1="53" M2="53" P1="480,159" P2="480,206"/><JD c="FFFFFF,10,1,0" M1="53" M2="53" P1="323,159" P2="323,206"/><JD c="1500fb,10,1,0" M1="51" M2="51" P1="480,159" P2="480,206"/><JD c="1500fb,10,1,0" M1="51" M2="51" P1="323,159" P2="323,206"/><JD c="FFFFFF,10,1,0" M1="49" M2="49" P1="480,159" P2="480,206"/><JD c="FFFFFF,10,1,0" M1="49" M2="49" P1="323,159" P2="323,206"/><JD c="1500fb,10,1,0" M1="47" M2="47" P1="480,159" P2="480,206"/><JD c="1500fb,10,1,0" M1="47" M2="47" P1="323,159" P2="323,206"/><JD c="1500fb,10,1,0" P1="450,260" P2="349,260"/><JD c="1500fb,10,1,0" P1="266,207" P2="168,207"/><JD c="1500fb,3,1,0" P1="323,390" P2="323,363"/><JD c="1500fb,10,1,0" P1="533,207" P2="632,207"/><JD c="1500fb,10,1,0" P1="268,157" P2="169,157"/><JD c="1500fb,3,1,0" P1="477,390" P2="477,363"/><JD c="1500fb,10,1,0" P1="115.45,102.08" P2="115.45,27.08"/><JD c="1500fb,10,1,0" P1="687.05,102.08" P2="687.05,27.08"/><JD c="1500fb,10,1,0" P1="534,157" P2="632,157"/><JD c="1500fb,10,1,0" P1="215,259" P2="166,259"/><JD c="1500fb,10,1,0" P1="585,260" P2="634,260"/><JD c="1500fb,10,1,0" P1="113,285" P2="62,285"/><JD c="1500fb,10,1,0" P1="688,286" P2="739,286"/><JD c="1500fb,10,1,0" P1="113,155" P2="10,155"/><JD c="1500fb,10,1,0" P1="688,155" P2="787,155"/><JD c="1500fb,10,1,0" P1="113,338" P2="10,338"/><JD c="1500fb,10,1,0" P1="689,337" P2="788,337"/><JD c="1500fb,3,1,0" P1="323,363" P2="477,363"/><JD c="000000,6,1,0" P1="787,27" P2="12,27"/><JD c="000000,6,1,0" P1="787,391" P2="12,391"/><JD c="000000,6,1,0" P1="477,312" P2="324,312"/><JD c="000000,6,1,0" M1="56" M2="56" P1="431,159" P2="373,159"/><JD c="000000,6,1,0" P1="738,102" P2="738,77"/><JD c="000000,6,1,0" P1="62,102" P2="62,77"/><JD c="000000,6,1,0" P1="272,261" P2="297,261"/><JD c="000000,6,1,0" P1="505,262" P2="530,262"/><JD c="1500fb,3,1,0" P1="272,158" P2="272,75"/><JD c="1500fb,3,1,0" P1="113.45,105.08" P2="192.45,105.08"/><JD c="1500fb,3,1,0" P1="689.05,105.08" P2="610.05,105.08"/><JD c="1500fb,3,1,0" P1="530,156" P2="530,74"/><JD c="000000,6,1,0" P1="10,391" P2="10,27"/><JD c="000000,6,1,0" P1="480,207" P2="324,207"/><JD c="000000,6,1,0" P1="271,337" P2="271,261"/><JD c="000000,6,1,0" P1="530,335" P2="530,263"/><JD c="000000,6,1,0" P1="166,334" P2="166,261"/><JD c="000000,6,1,0" P1="218,388" P2="218,311"/><JD c="000000,6,1,0" P1="582,388" P2="582,311"/><JD c="000000,6,1,0" P1="634,335" P2="634,262"/><JD c="000000,6,1,0" P1="114,230" P2="114,156"/><JD c="000000,6,1,0" P1="687,230" P2="687,156"/><JD c="000000,6,1,0" P1="62,285" P2="62,212"/><JD c="000000,6,1,0" P1="739,286" P2="739,213"/><JD c="000000,6,1,0" P1="363,159" P2="324,159"/><JD c="000000,6,1,0" P1="441,159" P2="480,159"/><JD c="000000,6,1,0" M1="57" M2="57" P1="480,159" P2="480,206"/><JD c="000000,6,1,0" M1="57" M2="57" P1="323,159" P2="323,206"/><JD c="000000,6,1,0" P1="450,260" P2="349,260"/><JD c="000000,6,1,0" P1="266,207" P2="168,207"/><JD c="000000,6,1,0" P1="533,207" P2="632,207"/><JD c="000000,6,1,0" P1="268,157" P2="169,157"/><JD c="000000,6,1,0" P1="115.45,100.08" P2="115.45,27.08"/><JD c="000000,6,1,0" P1="687.05,100.08" P2="687.05,27.08"/><JD c="000000,6,1,0" P1="535,157" P2="632,157"/><JD c="000000,6,1,0" P1="215,259" P2="166,259"/><JD c="000000,6,1,0" P1="585,260" P2="634,260"/><JD c="000000,6,1,0" P1="113,285" P2="62,285"/><JD c="000000,6,1,0" P1="688,286" P2="739,286"/><JD c="000000,6,1,0" P1="113,155" P2="10,155"/><JD c="000000,6,1,0" P1="688,155" P2="787,155"/><JD c="000000,6,1,0" P1="113,338" P2="10,338"/><JD c="000000,6,1,0" P1="689,337" P2="788,337"/><JD c="1500fb,3,1,0" P1="324,104" P2="324,76"/><JD c="000000,6,1,0" P1="788,391" P2="788,27"/><JD c="1500fb,3,1,0" P1="478,104" P2="478,76"/><JD c="1500fb,3,1,0" P1="244,152" P2="244,76"/><JD c="1500fb,3,1,0" P1="120.45,77.08" P2="192.45,77.08"/><JD c="1500fb,3,1,0" P1="682.05,77.08" P2="610.05,77.08"/><JD c="1500fb,3,1,0" P1="558,152" P2="558,74"/><JD c="1500fb,3,1,0" P1="272,76" P2="244,76"/><JD c="1500fb,3,1,0" P1="192.45,105.08" P2="192.45,77.08"/><JD c="1500fb,3,1,0" P1="610.05,105.08" P2="610.05,77.08"/><JD c="1500fb,3,1,0" P1="530,74" P2="558,74"/><JD c="1500fb,3,1,0" P1="324,104" P2="478,104"/><JD c="1500fb,3,1,0" P1="324,76" P2="478,76"/><JD c="000000,3,1,0" P1="247,153" P2="267,153"/><JD c="000000,3,1,0" P1="326,387" P2="474,387"/><JD c="000000,3,1,0" P1="119.45,80.08" P2="119.45,100.08"/><JD c="000000,3,1,0" P1="683.05,80.08" P2="683.05,100.08"/><JD c="000000,3,1,0" P1="555,153" P2="535,153"/><JD c="000000,3,1,0" P1="269,157" P2="269,132"/><JD c="000000,3,1,0" P1="474,391" P2="474,368"/><JD c="000000,3,1,0" P1="115.45,102.08" P2="140.45,102.08"/><JD c="000000,3,1,0" P1="687.05,102.08" P2="662.05,102.08"/><JD c="000000,3,1,0" P1="533,157" P2="533,132"/><JD c="000000,3,1,0" P1="247,155" P2="247,132"/><JD c="000000,3,1,0" P1="326,389" P2="326,368"/><JD c="000000,3,1,0" P1="117.45,80.08" P2="140.45,80.08"/><JD c="000000,3,1,0" P1="685.05,80.08" P2="662.05,80.08"/><JD c="000000,3,1,0" P1="555,155" P2="555,132"/></L></Z></C>]]})
pacmice_maps[#pacmice_maps].pathes = {{1, 1}, {2, 1}, {3, 1}, {5, 1}, {6, 1}, {7, 1}, {8, 1}, {9, 1}, {10, 1}, {11, 1}, {12, 1}, {13, 1}, {14, 1}, {15, 1}, {16, 1}, {17, 1}, {18, 1}, {19, 1}, {20, 1}, {21, 1}, {22, 1}, {23, 1}, {24, 1}, {25, 1}, {27, 1}, {28, 1}, {29, 1}, {1, 2}, {3, 2}, {8, 2}, {11, 2}, {19, 2}, {22, 2}, {27, 2}, {29, 2}, {1, 3}, {3, 3}, {8, 3}, {11, 3}, {19, 3}, {22, 3}, {27, 3}, {29, 3}, {1, 4}, {2, 4}, {3, 4}, {4, 4}, {5, 4}, {6, 4}, {7, 4}, {8, 4}, {11, 4}, {12, 4}, {13, 4}, {14, 4}, {15, 4}, {16, 4}, {17, 4}, {18, 4}, {19, 4}, {22, 4}, {23, 4}, {24, 4}, {25, 4}, {26, 4}, {27, 4}, {28, 4}, {29, 4}, {5, 5}, {11, 5}, {19, 5}, {25, 5}, {1, 6}, {2, 6}, {3, 6}, {5, 6}, {6, 6}, {7, 6}, {8, 6}, {9, 6}, {10, 6}, {11, 6}, {19, 6}, {20, 6}, {21, 6}, {22, 6}, {23, 6}, {24, 6}, {25, 6}, {27, 6}, {28, 6}, {29, 6}, {1, 7}, {3, 7}, {5, 7}, {11, 7}, {19, 7}, {25, 7}, {27, 7}, {29, 7}, {1, 8}, {3, 8}, {5, 8}, {6, 8}, {7, 8}, {8, 8}, {9, 8}, {10, 8}, {11, 8}, {12, 8}, {13, 8}, {14, 8}, {15, 8}, {16, 8}, {17, 8}, {18, 8}, {19, 8}, {20, 8}, {21, 8}, {22, 8}, {23, 8}, {24, 8}, {25, 8}, {27, 8}, {29, 8}, {1, 9}, {3, 9}, {4, 9}, {5, 9}, {9, 9}, {12, 9}, {18, 9}, {21, 9}, {25, 9}, {26, 9}, {27, 9}, {29, 9}, {1, 10}, {5, 10}, {7, 10}, {8, 10}, {9, 10}, {11, 10}, {12, 10}, {13, 10}, {14, 10}, {15, 10}, {16, 10}, {17, 10}, {18, 10}, {19, 10}, {21, 10}, {22, 10}, {23, 10}, {25, 10}, {29, 10}, {1, 11}, {2, 11}, {3, 11}, {4, 11}, {5, 11}, {7, 11}, {9, 11}, {11, 11}, {19, 11}, {21, 11}, {23, 11}, {25, 11}, {26, 11}, {27, 11}, {28, 11}, {29, 11}, {5, 12}, {7, 12}, {9, 12}, {11, 12}, {12, 12}, {13, 12}, {14, 12}, {15, 12}, {16, 12}, {17, 12}, {18, 12}, {19, 12}, {21, 12}, {23, 12}, {25, 12}, {1, 13}, {2, 13}, {3, 13}, {4, 13}, {5, 13}, {6, 13}, {7, 13}, {9, 13}, {10, 13}, {11, 13}, {19, 13}, {20, 13}, {21, 13}, {23, 13}, {24, 13}, {25, 13}, {26, 13}, {27, 13}, {28, 13}, {29, 13}}
pacmice_maps[#pacmice_maps].foods = {{x = 60, y = 55}, {x = 400, y = 55}, {x = 735, y = 55}, {x = 400, y = 130}, {x = 218, y = 182}, {x = 579, y = 182}, {x = 35, y = 240}, {x = 400, y = 240}, {x = 763, y = 240}, {x = 195, y = 285}, {x = 605, y = 285}, {x = 35, y = 365}, {x = 400, y = 335}, {x = 763, y = 365}}
-- (v3) (first multi)
table.insert(pacmice_maps, {x = 10, y = 35, cell_w = 26, cell_h = 26, grid_w = 31, grid_h = 24, wall_size = 14, web_x = -100, pac_count = 2, xml = [[<C><P H="640" DS="m;205,120,595,120" /><Z><S><S T="12" X="191" Y="191" L="58" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="612" Y="191" L="58" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="190" Y="477" L="58" H="10" P="0,0,0.3,0.2,180,0,0,0"/><S T="12" X="612" Y="477" L="58" H="10" P="0,0,0.3,0.2,-180,0,0,0"/><S T="12" X="788" Y="334" L="605" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="400" Y="35" L="10" H="781" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="686" Y="634" L="10" H="213" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="294" Y="634" L="10" H="574" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="10" Y="334" L="608" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="166" Y="229" L="10" H="84" P="0,0,0.7,0.2,0,0,0,0"/><S T="12" X="636" Y="229" L="10" H="84" P="0,0,0.7,0.2,0,0,0,0"/><S T="12" X="166" Y="439" L="10" H="84" P="0,0,0.7,0.2,180,0,0,0"/><S T="12" X="636" Y="439" L="10" H="84" P="0,0,0.7,0.2,-180,0,0,0"/><S T="12" X="243" Y="334" L="30" H="55" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="334" Y="364" L="30" H="32" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="465" Y="364" L="30" H="32" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="558" Y="334" L="30" H="55" P="0,0,0.3,0.2,-450,0,0,0"/><S T="12" X="114" Y="334" L="32" H="107" P="0,0,0.3,0.2,450,0,0,0"/><S T="12" X="686" Y="334" L="32" H="107" P="0,0,0.3,0.2,-450,0,0,0"/><S T="12" X="309" Y="117" L="50" H="31" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="493" Y="117" L="50" H="31" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="308" Y="553" L="50" H="31" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="491" Y="554" L="50" H="31" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="181" Y="62" L="50" H="35" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="621" Y="62" L="50" H="35" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="180" Y="606" L="50" H="35" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="621" Y="606" L="50" H="35" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="115" Y="125" L="81" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="687" Y="125" L="81" H="10" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="115" Y="543" L="81" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="687" Y="543" L="81" H="10" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="62" Y="181" L="81" H="10" P="0,0,0.7,0.2,270,0,0,0"/><S T="12" X="740" Y="181" L="81" H="10" P="0,0,0.7,0.2,-270,0,0,0"/><S T="12" X="62" Y="487" L="81" H="10" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="740" Y="487" L="81" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="400" Y="51" L="23" H="60" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="400" Y="617" L="23" H="60" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="375" Y="154" L="81" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="426" Y="154" L="81" H="10" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="374" Y="519" L="85" H="10" P="0,0,0.7,0.2,90,0,0,0"/><S T="12" X="426" Y="518" L="89" H="10" P="0,0,0.7,0.2,-90,0,0,0"/><S T="12" X="326" Y="191" L="10" H="107" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="477" Y="191" L="10" H="107" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="320" Y="480" L="10" H="107" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="477" Y="477" L="10" H="108" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="219" Y="334" L="10" H="183" P="0,0,0.7,0.2,180,0,0,0"/><S T="12" X="582" Y="334" L="10" H="183" P="0,0,0.7,0.2,-180,0,0,0"/><S T="12" X="272" Y="227" L="10" H="83" P="0,0,0.7,0.2,180,0,0,0"/><S T="12" X="530" Y="228" L="10" H="83" P="0,0,0.3,0.2,-180,0,0,0"/><S T="12" X="271" Y="440" L="10" H="83" P="0,0,0.7,0.2,0,0,0,0"/><S T="12" X="400" Y="390" L="10" H="83" P="0,0,0.7,0.2,0,0,0,0"/><S T="12" X="530" Y="440" L="10" H="83" P="0,0,0.7,0.2,0,0,0,0"/><S T="12" X="284" Y="87" L="10" H="83" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="519" Y="87" L="10" H="83" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="283" Y="583" L="10" H="83" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="517" Y="584" L="10" H="83" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="205" Y="139" L="10" H="80" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="597" Y="139" L="10" H="80" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="205" Y="529" L="10" H="80" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="597" Y="529" L="10" H="80" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="89" Y="87" L="10" H="60" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="713" Y="87" L="10" H="60" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="90" Y="581" L="10" H="60" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="713" Y="581" L="10" H="60" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="88" Y="217" L="10" H="59" P="0,0,0.3,0.2,270,0,0,0"/><S T="12" X="714" Y="217" L="10" H="59" P="0,0,0.3,0.2,-270,0,0,0"/><S T="12" X="89" Y="451" L="10" H="59" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="714" Y="451" L="10" H="59" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="65" Y="269" L="10" H="105" P="0,0,0.3,0.2,270,0,0,0"/><S T="12" X="738" Y="269" L="10" H="105" P="0,0,0.3,0.2,-270,0,0,0"/><S T="12" X="65" Y="399" L="10" H="105" P="0,0,0.3,0.2,-90,0,0,0"/><S T="12" X="738" Y="399" L="10" H="105" P="0,0,0.3,0.2,90,0,0,0"/><S T="12" X="400" Y="297" L="166" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="400" Y="428" L="162" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="342" Y="249" L="47" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="459" Y="249" L="47" H="10" P="0,0,0.3,0.2,0,0,0,0"/><S T="12" X="401" Y="249" L="67" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000"/><S T="12" X="478" Y="273" L="56" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="322" Y="273" L="56" H="10" P="0,0,0.3,0.2,90,0,0,0" v="90000"/><S T="12" X="400" Y="650" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="90000"/><S T="12" X="400" Y="650" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="89000"/><S T="12" X="400" Y="650" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="88000"/><S T="12" X="400" Y="650" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="87000"/><S T="12" X="400" Y="650" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="86000"/><S T="12" X="400" Y="650" L="10" H="10" P="1,0,0.3,0.2,90,1,Infinity,0" c="4" v="85000"/></S><D><F X="351" Y="285" D=""/><F X="450" Y="284" D=""/><T X="399" Y="291" D=""/></D><O/><L><JD c="000000,250,1,0" P1="-313,-1676" P2="-313,2324"/><JD c="000000,250,1,0" P1="-113,-1666" P2="-113,2334"/><JD c="000000,250,1,0" P1="87,-1666" P2="87,2334"/><JD c="000000,250,1,0" P1="287,-1666" P2="287,2334"/><JD c="000000,250,1,0" P1="487,-1666" P2="487,2334"/><JD c="000000,250,1,0" P1="687,-1666" P2="687,2334"/><JD c="000000,250,1,0" P1="887,-1656" P2="887,2344"/><JD c="000000,250,1,0" P1="1087,-1646" P2="1087,2354"/><JD c="1500fb,10,1,0" P1="788,35" P2="788,633"/><JD c="1500fb,10,1,0" P1="10,35" P2="10,633"/><JD c="1500fb,10,1,0" P1="787,35" P2="12,35"/><JD c="1500fb,10,1,0" P1="788,633" P2="13,633"/><JD c="1500fb,10,1,0" P1="478,428" P2="323,428"/><JD c="1500fb,10,1,0" P1="400,353" P2="400,426"/><JD c="FFFFFF,10,1,0" M1="79" M2="79" P1="429,249" P2="371,249"/><JD c="FFFFFF,10,1,0" M1="79" M2="79" P1="478,296" P2="478,250"/><JD c="FFFFFF,10,1,0" M1="79" M2="79" P1="322,296" P2="322,250"/><JD c="1500fb,10,1,0" M1="80" M2="80" P1="429,249" P2="371,249"/><JD c="1500fb,10,1,0" M1="80" M2="80" P1="478,296" P2="478,250"/><JD c="1500fb,10,1,0" M1="80" M2="80" P1="322,296" P2="322,250"/><JD c="FFFFFF,10,1,0" M1="81" M2="81" P1="429,249" P2="371,249"/><JD c="FFFFFF,10,1,0" M1="81" M2="81" P1="478,296" P2="478,250"/><JD c="FFFFFF,10,1,0" M1="81" M2="81" P1="322,296" P2="322,250"/><JD c="1500fb,10,1,0" M1="82" M2="82" P1="429,249" P2="371,249"/><JD c="1500fb,10,1,0" M1="82" M2="82" P1="478,296" P2="478,250"/><JD c="1500fb,10,1,0" M1="82" M2="82" P1="322,296" P2="322,250"/><JD c="FFFFFF,10,1,0" M1="83" M2="83" P1="429,249" P2="371,249"/><JD c="FFFFFF,10,1,0" M1="83" M2="83" P1="478,296" P2="478,250"/><JD c="FFFFFF,10,1,0" M1="83" M2="83" P1="322,296" P2="322,250"/><JD c="1500fb,10,1,0" M1="84" M2="84" P1="429,249" P2="371,249"/><JD c="1500fb,10,1,0" M1="84" M2="84" P1="478,296" P2="478,250"/><JD c="1500fb,10,1,0" M1="84" M2="84" P1="322,296" P2="322,250"/><JD c="1500fb,10,1,0" P1="375,189" P2="375,118"/><JD c="1500fb,10,1,0" P1="426,189" P2="426,118"/><JD c="1500fb,10,1,0" P1="374,480" P2="374,559"/><JD c="1500fb,10,1,0" P1="426,478" P2="426,559"/><JD c="1500fb,10,1,0" P1="272,265" P2="272,193"/><JD c="1500fb,10,1,0" P1="530,265" P2="530,193"/><JD c="1500fb,10,1,0" P1="219,422" P2="219,246"/><JD c="1500fb,10,1,0" P1="582,422" P2="582,246"/><JD c="1500fb,10,1,0" P1="478,297" P2="322,297"/><JD c="1500fb,10,1,0" P1="271,403" P2="271,479"/><JD c="1500fb,10,1,0" P1="530,403" P2="530,475"/><JD c="1500fb,10,1,0" P1="166,266" P2="166,193"/><JD c="1500fb,10,1,0" P1="636,266" P2="636,193"/><JD c="1500fb,10,1,0" P1="166,402" P2="166,475"/><JD c="1500fb,10,1,0" P1="636,402" P2="636,475"/><JD c="1500fb,10,1,0" P1="115,162" P2="115,88"/><JD c="1500fb,10,1,0" P1="687,162" P2="687,88"/><JD c="1500fb,10,1,0" P1="115,506" P2="115,580"/><JD c="1500fb,10,1,0" P1="687,506" P2="687,580"/><JD c="1500fb,10,1,0" P1="62,217" P2="62,144"/><JD c="1500fb,10,1,0" P1="740,217" P2="740,144"/><JD c="1500fb,10,1,0" P1="62,451" P2="62,524"/><JD c="1500fb,10,1,0" P1="740,451" P2="740,524"/><JD c="1500fb,10,1,0" P1="361,249" P2="322,249"/><JD c="1500fb,10,1,0" P1="439,249" P2="478,249"/><JD c="1500fb,10,1,0" P1="375,191" P2="272,191"/><JD c="1500fb,10,1,0" P1="427,191" P2="530,191"/><JD c="1500fb,10,1,0" P1="374,480" P2="271,480"/><JD c="1500fb,10,1,0" P1="426,477" P2="530,477"/><JD c="1500fb,10,1,0" P1="241,139" P2="169,139"/><JD c="1500fb,10,1,0" P1="561,139" P2="633,139"/><JD c="1500fb,10,1,0" P1="241,529" P2="169,529"/><JD c="1500fb,10,1,0" P1="561,529" P2="633,529"/><JD c="1500fb,10,1,0" P1="320,87" P2="247,87"/><JD c="1500fb,10,1,0" P1="483,87" P2="555,87"/><JD c="1500fb,10,1,0" P1="319,583" P2="246,583"/><JD c="1500fb,10,1,0" P1="481,584" P2="552,584"/><JD c="1500fb,10,1,0" P1="215,191" P2="166,191"/><JD c="1500fb,10,1,0" P1="587,191" P2="636,191"/><JD c="1500fb,10,1,0" P1="215,477" P2="166,477"/><JD c="1500fb,10,1,0" P1="587,477" P2="636,477"/><JD c="1500fb,10,1,0" P1="113,217" P2="62,217"/><JD c="1500fb,10,1,0" P1="689,217" P2="740,217"/><JD c="1500fb,10,1,0" P1="113,451" P2="62,451"/><JD c="1500fb,10,1,0" P1="689,451" P2="740,451"/><JD c="1500fb,10,1,0" P1="114,87" P2="63,87"/><JD c="1500fb,10,1,0" P1="688,87" P2="739,87"/><JD c="1500fb,10,1,0" P1="114,581" P2="63,581"/><JD c="1500fb,10,1,0" P1="688,581" P2="739,581"/><JD c="1500fb,10,1,0" P1="113,269" P2="10,269"/><JD c="1500fb,10,1,0" P1="689,269" P2="788,269"/><JD c="1500fb,10,1,0" P1="113,399" P2="10,399"/><JD c="1500fb,10,1,0" P1="689,399" P2="788,399"/><JD c="000000,6,1,0" P1="787,35" P2="12,35"/><JD c="000000,6,1,0" P1="788,633" P2="13,633"/><JD c="000000,6,1,0" P1="478,428" P2="323,428"/><JD c="000000,6,1,0" P1="400,353" P2="400,426"/><JD c="000000,6,1,0" M1="79" M2="79" P1="429,249" P2="371,249"/><JD c="000000,6,1,0" M1="79" M2="79" P1="478,296" P2="478,250"/><JD c="000000,6,1,0" M1="79" M2="79" P1="322,296" P2="322,250"/><JD c="000000,6,1,0" P1="375,189" P2="375,118"/><JD c="000000,6,1,0" P1="426,189" P2="426,118"/><JD c="000000,6,1,0" P1="374,480" P2="374,559"/><JD c="000000,6,1,0" P1="426,478" P2="426,559"/><JD c="1500fb,3,1,0" P1="323,85" P2="323,141"/><JD c="1500fb,3,1,0" P1="479,85" P2="479,141"/><JD c="000000,6,1,0" P1="10,35" P2="10,633"/><JD c="1500fb,3,1,0" P1="322,585" P2="322,529"/><JD c="1500fb,3,1,0" P1="477,586" P2="477,530"/><JD c="1500fb,3,1,0" P1="197,40" P2="197,86"/><JD c="1500fb,3,1,0" P1="605,40" P2="605,86"/><JD c="1500fb,3,1,0" P1="196,628" P2="196,582"/><JD c="1500fb,3,1,0" P1="605,628" P2="605,582"/><JD c="000000,6,1,0" P1="272,265" P2="272,193"/><JD c="000000,6,1,0" P1="530,265" P2="530,193"/><JD c="000000,6,1,0" P1="219,422" P2="219,246"/><JD c="000000,6,1,0" P1="582,422" P2="582,246"/><JD c="000000,6,1,0" P1="478,297" P2="322,297"/><JD c="000000,6,1,0" P1="271,403" P2="271,479"/><JD c="000000,6,1,0" P1="530,403" P2="530,475"/><JD c="000000,6,1,0" P1="166,266" P2="166,193"/><JD c="000000,6,1,0" P1="636,266" P2="636,193"/><JD c="000000,6,1,0" P1="166,402" P2="166,475"/><JD c="000000,6,1,0" P1="636,402" P2="636,475"/><JD c="000000,6,1,0" P1="115,162" P2="115,88"/><JD c="000000,6,1,0" P1="687,162" P2="687,88"/><JD c="000000,6,1,0" P1="115,506" P2="115,580"/><JD c="000000,6,1,0" P1="687,506" P2="687,580"/><JD c="000000,6,1,0" P1="62,217" P2="62,144"/><JD c="000000,6,1,0" P1="740,217" P2="740,144"/><JD c="000000,6,1,0" P1="62,451" P2="62,524"/><JD c="000000,6,1,0" P1="740,451" P2="740,524"/><JD c="000000,6,1,0" P1="361,249" P2="322,249"/><JD c="000000,6,1,0" P1="439,249" P2="478,249"/><JD c="000000,6,1,0" P1="375,191" P2="272,191"/><JD c="000000,6,1,0" P1="427,191" P2="530,191"/><JD c="000000,6,1,0" P1="374,480" P2="271,480"/><JD c="000000,6,1,0" P1="426,477" P2="530,477"/><JD c="000000,6,1,0" P1="241,139" P2="169,139"/><JD c="000000,6,1,0" P1="561,139" P2="633,139"/><JD c="000000,6,1,0" P1="241,529" P2="169,529"/><JD c="000000,6,1,0" P1="561,529" P2="633,529"/><JD c="000000,6,1,0" P1="318,87" P2="247,87"/><JD c="000000,6,1,0" P1="484,87" P2="555,87"/><JD c="000000,6,1,0" P1="318,583" P2="246,583"/><JD c="000000,6,1,0" P1="482,584" P2="551.57,584"/><JD c="000000,6,1,0" P1="215,191" P2="166,191"/><JD c="000000,6,1,0" P1="587,191" P2="636,191"/><JD c="000000,6,1,0" P1="215,477" P2="166,477"/><JD c="000000,6,1,0" P1="587,477" P2="636,477"/><JD c="000000,6,1,0" P1="113,217" P2="62,217"/><JD c="000000,6,1,0" P1="689,217" P2="740,217"/><JD c="000000,6,1,0" P1="113,451" P2="62,451"/><JD c="000000,6,1,0" P1="689,451" P2="740,451"/><JD c="000000,6,1,0" P1="114,87" P2="63,87"/><JD c="000000,6,1,0" P1="688,87" P2="739,87"/><JD c="000000,6,1,0" P1="114,581" P2="63,581"/><JD c="000000,6,1,0" P1="688,581" P2="739,581"/><JD c="000000,6,1,0" P1="113,269" P2="10,269"/><JD c="000000,6,1,0" P1="689,269" P2="788,269"/><JD c="000000,6,1,0" P1="113,399" P2="10,399"/><JD c="000000,6,1,0" P1="689,399" P2="788,399"/><JD c="1500fb,3,1,0" P1="166,320" P2="166,348"/><JD c="1500fb,3,1,0" P1="634,320" P2="634,348"/><JD c="1500fb,3,1,0" P1="450,350" P2="450,378"/><JD c="1500fb,3,1,0" P1="319,350" P2="319,378"/><JD c="000000,6,1,0" P1="788,35" P2="788,633"/><JD c="1500fb,3,1,0" P1="269,320" P2="269,348"/><JD c="1500fb,3,1,0" P1="532,320" P2="532,348"/><JD c="1500fb,3,1,0" P1="62,320" P2="62,348"/><JD c="1500fb,3,1,0" P1="738,320" P2="738,348"/><JD c="1500fb,3,1,0" P1="480,350" P2="480,378"/><JD c="1500fb,3,1,0" P1="349,350" P2="349,378"/><JD c="1500fb,3,1,0" P1="429,40" P2="429,61"/><JD c="1500fb,3,1,0" P1="372,40" P2="372,61"/><JD c="1500fb,3,1,0" P1="429,628" P2="429,607"/><JD c="1500fb,3,1,0" P1="372,628" P2="372,607"/><JD c="1500fb,3,1,0" P1="295,92" P2="295,140"/><JD c="1500fb,3,1,0" P1="507,92" P2="507,140"/><JD c="1500fb,3,1,0" P1="294,578" P2="294,530"/><JD c="1500fb,3,1,0" P1="505,579" P2="505,531"/><JD c="1500fb,3,1,0" P1="165,40" P2="165,86"/><JD c="1500fb,3,1,0" P1="637,40" P2="637,86"/><JD c="1500fb,3,1,0" P1="164,628" P2="164,582"/><JD c="1500fb,3,1,0" P1="637,628" P2="637,582"/><JD c="1500fb,3,1,0" P1="429,61" P2="373,61"/><JD c="1500fb,3,1,0" P1="429,607" P2="373,607"/><JD c="1500fb,3,1,0" P1="323,141" P2="295,141"/><JD c="1500fb,3,1,0" P1="479,141" P2="507,141"/><JD c="1500fb,3,1,0" P1="269,348" P2="224,348"/><JD c="1500fb,3,1,0" P1="532,348" P2="577,348"/><JD c="1500fb,3,1,0" P1="269,320" P2="224,320"/><JD c="1500fb,3,1,0" P1="532,320" P2="577,320"/><JD c="1500fb,3,1,0" P1="322,529" P2="294,529"/><JD c="1500fb,3,1,0" P1="477,530" P2="505,530"/><JD c="1500fb,3,1,0" P1="197,86.17" P2="166,86.17"/><JD c="1500fb,3,1,0" P1="605,86.17" P2="636,86.17"/><JD c="1500fb,3,1,0" P1="196,581.83" P2="165,581.83"/><JD c="1500fb,3,1,0" P1="605,581.83" P2="636,581.83"/><JD c="1500fb,3,1,0" P1="166,320" P2="63,320"/><JD c="1500fb,3,1,0" P1="634,320" P2="737,320"/><JD c="1500fb,3,1,0" P1="450,350" P2="480,350"/><JD c="1500fb,3,1,0" P1="319,350" P2="349,350"/><JD c="1500fb,3,1,0" P1="166,348" P2="63,348"/><JD c="1500fb,3,1,0" P1="634,348" P2="737,348"/><JD c="1500fb,3,1,0" P1="450,378" P2="480,378"/><JD c="1500fb,3,1,0" P1="319,378" P2="349,378"/><JD c="000000,3,1,0" P1="219.84,323" P2="243.25,323"/><JD c="000000,3,1,0" P1="581.16,323" P2="557.75,323"/><JD c="000000,3,1,0" P1="223,323" P2="223,344"/><JD c="000000,3,1,0" P1="578,323" P2="578,344"/><JD c="000000,3,1,0" P1="169,629" P2="191,629"/><JD c="000000,3,1,0" P1="632,629" P2="610,629"/><JD c="000000,3,1,0" P1="297,579" P2="317,579"/><JD c="000000,3,1,0" P1="502,580" P2="482,580"/><JD c="000000,3,1,0" P1="298,91" P2="318,91"/><JD c="000000,3,1,0" P1="504,91" P2="484,91"/><JD c="000000,3,1,0" P1="170,39" P2="192,39"/><JD c="000000,3,1,0" P1="632,39" P2="610,39"/><JD c="000000,3,1,0" P1="377,629" P2="425,629"/><JD c="000000,3,1,0" P1="377,39" P2="425,39"/><JD c="000000,3,1,0" P1="219.84,345" P2="243.25,345"/><JD c="000000,3,1,0" P1="581.16,345" P2="557.75,345"/><JD c="000000,3,1,0" P1="193,631" P2="193,608"/><JD c="000000,3,1,0" P1="608,631" P2="608,608"/><JD c="000000,3,1,0" P1="319,581" P2="319,558"/><JD c="000000,3,1,0" P1="480,583" P2="480,560"/><JD c="000000,3,1,0" P1="320,87" P2="320,112"/><JD c="000000,3,1,0" P1="482,87" P2="482,112"/><JD c="000000,3,1,0" P1="194,37" P2="194,60"/><JD c="000000,3,1,0" P1="608,37" P2="608,60"/><JD c="000000,3,1,0" P1="426,631" P2="426,617"/><JD c="000000,3,1,0" P1="375,631" P2="375,617"/><JD c="000000,3,1,0" P1="426,37" P2="426,51"/><JD c="000000,3,1,0" P1="375,37" P2="375,51"/><JD c="000000,3,1,0" P1="167,631" P2="167,608"/><JD c="000000,3,1,0" P1="634,631" P2="634,608"/><JD c="000000,3,1,0" P1="297,581" P2="297,558"/><JD c="000000,3,1,0" P1="502,582" P2="502,559"/><JD c="000000,3,1,0" P1="298,89" P2="298,112"/><JD c="000000,3,1,0" P1="504,89" P2="504,112"/><JD c="000000,3,1,0" P1="168,37" P2="168,60"/><JD c="000000,3,1,0" P1="634,37" P2="634,60"/></L></Z></C>]]})
pacmice_maps[#pacmice_maps].pathes = {{1, 1}, {2, 1}, {3, 1}, {4, 1}, {5, 1}, {8, 1}, {9, 1}, {10, 1}, {11, 1}, {12, 1}, {13, 1}, {17, 1}, {18, 1}, {19, 1}, {20, 1}, {21, 1}, {22, 1}, {25, 1}, {26, 1}, {27, 1}, {28, 1}, {29, 1}, {1, 2}, {5, 2}, {8, 2}, {13, 2}, {14, 2}, {15, 2}, {16, 2}, {17, 2}, {22, 2}, {25, 2}, {29, 2}, {1, 3}, {2, 3}, {3, 3}, {5, 3}, {6, 3}, {7, 3}, {8, 3}, {9, 3}, {10, 3}, {13, 3}, {15, 3}, {17, 3}, {20, 3}, {21, 3}, {22, 3}, {23, 3}, {24, 3}, {25, 3}, {27, 3}, {28, 3}, {29, 3}, {1, 4}, {3, 4}, {5, 4}, {10, 4}, {13, 4}, {15, 4}, {17, 4}, {20, 4}, {25, 4}, {27, 4}, {29, 4}, {1, 5}, {3, 5}, {5, 5}, {6, 5}, {7, 5}, {8, 5}, {9, 5}, {10, 5}, {11, 5}, {12, 5}, {13, 5}, {15, 5}, {17, 5}, {18, 5}, {19, 5}, {20, 5}, {21, 5}, {22, 5}, {23, 5}, {24, 5}, {25, 5}, {27, 5}, {29, 5}, {1, 6}, {3, 6}, {4, 6}, {5, 6}, {9, 6}, {15, 6}, {21, 6}, {25, 6}, {26, 6}, {27, 6}, {29, 6}, {1, 7}, {5, 7}, {7, 7}, {8, 7}, {9, 7}, {11, 7}, {12, 7}, {13, 7}, {14, 7}, {15, 7}, {16, 7}, {17, 7}, {18, 7}, {19, 7}, {21, 7}, {22, 7}, {23, 7}, {25, 7}, {29, 7}, {1, 8}, {2, 8}, {3, 8}, {4, 8}, {5, 8}, {7, 8}, {9, 8}, {11, 8}, {19, 8}, {21, 8}, {23, 8}, {25, 8}, {26, 8}, {27, 8}, {28, 8}, {29, 8}, {5, 9}, {7, 9}, {9, 9}, {11, 9}, {19, 9}, {21, 9}, {23, 9}, {25, 9}, {1, 10}, {2, 10}, {3, 10}, {4, 10}, {5, 10}, {6, 10}, {7, 10}, {9, 10}, {10, 10}, {11, 10}, {19, 10}, {20, 10}, {21, 10}, {23, 10}, {24, 10}, {25, 10}, {26, 10}, {27, 10}, {28, 10}, {29, 10}, {1, 11}, {7, 11}, {11, 11}, {12, 11}, {13, 11}, {14, 11}, {15, 11}, {16, 11}, {17, 11}, {18, 11}, {19, 11}, {23, 11}, {29, 11}, {1, 12}, {7, 12}, {11, 12}, {14, 12}, {16, 12}, {19, 12}, {23, 12}, {29, 12}, {1, 13}, {2, 13}, {3, 13}, {4, 13}, {5, 13}, {6, 13}, {7, 13}, {9, 13}, {10, 13}, {11, 13}, {14, 13}, {16, 13}, {19, 13}, {20, 13}, {21, 13}, {23, 13}, {24, 13}, {25, 13}, {26, 13}, {27, 13}, {28, 13}, {29, 13}, {5, 14}, {7, 14}, {9, 14}, {11, 14}, {12, 14}, {13, 14}, {14, 14}, {16, 14}, {17, 14}, {18, 14}, {19, 14}, {21, 14}, {23, 14}, {25, 14}, {1, 15}, {2, 15}, {3, 15}, {4, 15}, {5, 15}, {7, 15}, {9, 15}, {11, 15}, {19, 15}, {21, 15}, {23, 15}, {25, 15}, {26, 15}, {27, 15}, {28, 15}, {29, 15}, {1, 16}, {5, 16}, {7, 16}, {8, 16}, {9, 16}, {11, 16}, {12, 16}, {13, 16}, {14, 16}, {15, 16}, {16, 16}, {17, 16}, {18, 16}, {19, 16}, {21, 16}, {22, 16}, {23, 16}, {25, 16}, {29, 16}, {1, 17}, {3, 17}, {4, 17}, {5, 17}, {9, 17}, {15, 17}, {21, 17}, {25, 17}, {26, 17}, {27, 17}, {29, 17}, {1, 18}, {3, 18}, {5, 18}, {6, 18}, {7, 18}, {8, 18}, {9, 18}, {10, 18}, {11, 18}, {12, 18}, {13, 18}, {15, 18}, {17, 18}, {18, 18}, {19, 18}, {20, 18}, {21, 18}, {22, 18}, {23, 18}, {24, 18}, {25, 18}, {27, 18}, {29, 18}, {1, 19}, {3, 19}, {5, 19}, {10, 19}, {13, 19}, {15, 19}, {17, 19}, {20, 19}, {25, 19}, {27, 19}, {29, 19}, {1, 20}, {2, 20}, {3, 20}, {5, 20}, {6, 20}, {7, 20}, {8, 20}, {9, 20}, {10, 20}, {13, 20}, {15, 20}, {17, 20}, {20, 20}, {21, 20}, {22, 20}, {23, 20}, {24, 20}, {25, 20}, {27, 20}, {28, 20}, {29, 20}, {1, 21}, {5, 21}, {8, 21}, {13, 21}, {14, 21}, {15, 21}, {16, 21}, {17, 21}, {22, 21}, {25, 21}, {29, 21}, {1, 22}, {2, 22}, {3, 22}, {4, 22}, {5, 22}, {8, 22}, {9, 22}, {10, 22}, {11, 22}, {12, 22}, {13, 22}, {17, 22}, {18, 22}, {19, 22}, {20, 22}, {21, 22}, {22, 22}, {25, 22}, {26, 22}, {27, 22}, {28, 22}, {29, 22}}
pacmice_maps[#pacmice_maps].foods = {{x = 87, y = 61}, {x = 282 , y = 61}, {x = 517, y = 61}, {x = 716, y = 61}, {x = 400, y = 88}, {x = 400, y = 218}, {x = 400, y = 330}, {x = 400, y = 522}, {x = 87, y = 195}, {x = 716, y = 195}, {x = 36, y = 330}, {x = 245, y = 373}, {x = 193, y = 452}, {x = 87, y = 517}, {x = 281, y = 610}, {x = 512, y = 610}, {x = 712, y = 519}, {x = 609, y = 452}, {x = 546, y = 373}, {x = 762, y = 330}}
-- colors
pacmice_map_colors = {"0000ff", "00ff00", "ff0000", "ffff00", "00ffff", "ff00ff", "ff7700", "d200ff"}
pacmice_map_color_index = math.random(#pacmice_map_colors)
-- food images
pacmice_food_images = {"17ae46fd894.png", "17ae46ff007.png", "17ae4700777.png", "17ae4701ee9.png", "17ae4703658.png", "17ae4704dcc.png", "17ae4706540.png", "17ae4707cb0.png", "17ae4709422.png", "17ae470ab94.png", "17ae470c307.png", "17ae470da77.png", "17ae470f1e8.png", "17ae4710959.png", "17ae47120dd.png", "17ae471383b.png", "17ae4714fad.png", "17ae4716720.png", "17ae4717e93.png", "17ae4719605.png"}
--- Internal use:
pacmice_map = nil				-- current map
pacmice_cur_pilot = nil			-- for generating pathes
pacmice_cur_x = 0
pacmice_cur_y = 0
pacmice_cur_generating = false
pacmice_auto_generating = false
pacmice_auto_x = nil
pacmice_auto_y = nil
pacmice_auto_object_id = nil
pacmice_pacmans = {}			-- map of pacmouces (key is the player name)
pacmice_auto_respawn = true
pacmice_pacmouse_count = 0
pacmice_round_over = false
pacmice_animations = {}
pacmice_animations[1] = {"17afe1cf978.png", "17afe1ce20a.png"}
pacmice_animations[2] = {"17afe2a6882.png", "17afe1d18bc.png"}
--- Custom bonus for pacmice foods
function pacmice_FoodGrabbedCallback(player_name, bonus)
	pshy.scores_Add(player_name, 2)
	pshy.bonus_Disable(bonus.id)
end
for i_image, image_name in pairs(pacmice_food_images) do
	pshy.bonus_types[image_name]	= {image = image_name, func = pacmice_FoodGrabbedCallback}
end
--- Alive mice count.
function pacmice_CountMiceAlive()
	local count = 0
	for player_name, player in pairs(tfm.get.room.playerList) do
		if not player.isDead and not pacmice_pacmans[player_name] then
			count = count + 1
		end
	end
	return count
end
--- Pop the best player's score.
function pacmice_PopBestScorePlayer()
	local best_player_name = nil
	for player_name in pairs(tfm.get.room.playerList) do
		if not best_player_name or pshy.scores[player_name] > pshy.scores[best_player_name] then
			best_player_name = player_name
		end
	end
	return best_player_name
end
--- TFM event eventNewGame()
-- Make the next pacmouse.
function eventNewGame()
	-- spawn scrolling
	tfm.exec.addPhysicObject(20, pacmice_map.web_x, 200, {type = tfm.enum.ground.water, width = 80, height = 4000, foreground = false, color = 0x1, miceCollision = false})
	tfm.exec.addPhysicObject(21, pacmice_map.web_x, pacmice_map.y + pacmice_map.grid_h * pacmice_map.cell_h, {type = tfm.enum.ground.rectangle, width = 200, height = 20, foreground = true, color = 0xff0000, miceCollision = true})
	tfm.exec.addPhysicObject(22, pacmice_map.web_x, 200, {type = tfm.enum.ground.rectangle, width = 200, height = 4000, foreground = true, color = 0x1, miceCollision = false})
	pacmice_round_over = false
	if pacmice_cur_generating or pacmice_cur_pilot then
		return
	end
	if pacmice_CountMiceAlive() >= 1 then
		local pacmouse_player = pacmice_PopBestScorePlayer()
		pacmice_CreatePacman(pacmouse_player)
		if pacmice_map.pac_count == 1 or pacmice_CountMiceAlive() <= 1 then
			tfm.exec.chatMessage("<b><fc>The pacmouse is now " .. pshy.GetPlayerNick(pacmouse_player) .. "!</fc></b>", nil)
		else
			old_score = pshy.scores[pacmouse_player]
			pshy.scores[pacmouse_player] = 0
			local pacmouse_player_2 = pacmice_PopBestScorePlayer()
			pshy.scores[pacmouse_player] = old_score
			pacmice_CreatePacman(pacmouse_player_2)
			tfm.exec.chatMessage("<b><fc>The pacmice are now " .. pshy.GetPlayerNick(pacmouse_player) .. " and " .. pshy.GetPlayerNick(pacmouse_player_2) .. "!</fc></b>", nil)
			pacmice_pacmans[pacmouse_player_2].image_animation_number = 2
		end
	end
	-- add bonuses
	for i_bonus, bonus in pairs(pacmice_map.foods) do
		local bonus_type = pacmice_food_images[math.random(#pacmice_food_images)]
		pshy.bonus_Add(bonus_type, bonus.x, bonus.y)
	end
end
--- Create a pacman.
-- @player Player's Name#0000.
function pacmice_CreatePacman(player_name)
	if pacmice_pacmans[player_name] then
		error("should not come here")
		pacmice_DestroyPacman(player_name)
	end
	pacmice_pacmans[player_name] = {}
	local pacman = pacmice_pacmans[player_name]
	pacman.player_name = player_name
	pacman.cell_x = pacmice_map.pathes[#pacmice_map.pathes][1]
	pacman.cell_y = pacmice_map.pathes[#pacmice_map.pathes][2]
	pacman.cell_vx = -1
	pacman.cell_vy = 0
	pacman.wish_vx = -1
	pacman.wish_vy = 0
	pacman.image_id = nil
	pacman.direction = 0
	pacman.speed = 50
	pacman.size = 50
	pacman.image_animation_number = pacmice_pacmouse_count % #pacmice_animations + 1
	pacman.image_animation_index = 0
	pacman.pacman_index = pacmice_pacmouse_count
	-- player
	tfm.exec.setShaman(player_name, false)
	tfm.exec.removeCheese(player_name)
	tfm.exec.respawnPlayer(player_name)
	tfm.exec.freezePlayer(player_name, true)
	tfm.exec.movePlayer(player_name, pacmice_map.web_x, pacman.cell_y * pacmice_map.cell_h + pacmice_map.y, false, 0, 0, false)
	--tfm.exec.changePlayerSize(player_name, (pacman.size - 4) / 35 )
	pacmice_pacmouse_count = pacmice_pacmouse_count + 1
	-- keys
	system.bindMouse(player_name, true)
	system.bindKeyboard(player_name, pshy.keycodes.UP, true, true)
	system.bindKeyboard(player_name, pshy.keycodes.DOWN, true, true)
	system.bindKeyboard(player_name, pshy.keycodes.LEFT, true, true)
	system.bindKeyboard(player_name, pshy.keycodes.RIGHT, true, true)
end
--- Destroy a pacman.
-- @player Player's Name#0000.
function pacmice_DestroyPacman(player_name)
	if pacmice_pacmans[player_name] then
		local pacman = pacmice_pacmans[player_name]
		if pacman.image_id then
			tfm.exec.removeImage(pacman.image_id)
		end
		pacmice_pacmans[player_name] = nil
		pacmice_pacmouse_count = pacmice_pacmouse_count - 1
		if not pacmice_round_over then
			tfm.exec.killPlayer(player_name)
		end
		tfm.get.room.playerList[player_name].isDead = true
		tfm.exec.removePhysicObject(pacman.pacman_index * 2 + 1)
		tfm.exec.removePhysicObject(pacman.pacman_index * 2 + 2)
		pshy.scores_Set(player_name, 0)
	end
end
--- Get a cell screen coordinates.
function pacmice_GetCellDrawCoords(x, y)
	local x = x * pacmice_map.cell_w + pacmice_map.x
	local y = y * pacmice_map.cell_h + pacmice_map.y
	return x, y
end
--- Draw a pacman.
-- @player Player's Name#0000.
function pacmice_DrawPacman(player_name)
	local pacman = pacmice_pacmans[player_name]
	local x, y = pacmice_GetCellDrawCoords(pacman.cell_x, pacman.cell_y)
	local animation = pacmice_animations[pacman.image_animation_number]
	-- next image
	pacman.image_animation_index = (pacman.image_animation_index + 1) % #animation
	local image_code = (animation)[pacman.image_animation_index + 1] -- jerry: 1718e698ac9.png -- pacman: 
	-- @todo
	old_image_id = pacman.image_id
	local size = (pacmice_map.cell_w * 2) - pacmice_map.wall_size
	--tfm.exec.addPhysicObject(5, x, y, {type = tfm.enum.ground.rectangle, width = size, height = size, foreground = false, color = 0xffff00, miceCollision = false})
	pacman.image_id = tfm.exec.addImage(image_code, "!0", x, y, nil, 1.0, 1.0, pacman.direction, 1.0, 0.5, 0.5)
	--pacman.image_id = tfm.exec.addImage("1718e698ac9.png", "$" .. player_name, 0, 0, nil, 0.5, 0.5, pacman.direction, 1.0, 0.5, 0.5)
	if old_image_id then
		tfm.exec.removeImage(old_image_id)
	end
	-- acid
	tfm.exec.addPhysicObject(pacman.pacman_index * 2 + 1, x, y, {type = tfm.enum.ground.acid, width = size, height = size, foreground = false, color = 0x0, miceCollision = true, groundCollision = false})
	tfm.exec.addPhysicObject(pacman.pacman_index * 2 + 2, x, y, {type = tfm.enum.ground.rectangle, width = size, height = size, foreground = false, color = 0x1, miceCollision = false, groundCollision = false})
	-- move the player
	tfm.exec.movePlayer(player_name, 0, 0, true, 0, (y - tfm.get.room.playerList[player_name].y) / 5 + 10 + pacman.cell_vy * 20, false)
end
--- Get a cell value.
function pacmice_GridGet(x, y)
	if x > pacmice_map.grid_w or y > pacmice_map.grid_h then
		return false
	end
	return pacmice_map.linear_grid[y * pacmice_map.grid_w + x]
end
--- Set a cell value.
function pacmice_GridSet(x, y, value)
	pacmice_map.linear_grid[y * pacmice_map.grid_w + x] = value
end
--- Redraw the cursor.
function pacmice_DrawCursor()
	local x = pacmice_cur_x * pacmice_map.cell_w + pacmice_map.x
	local y = pacmice_cur_y * pacmice_map.cell_h + pacmice_map.y
	if pacmice_cur_pilot then
		tfm.exec.addPhysicObject(23, x + pacmice_map.cell_w / 2, y, {type = tfm.enum.ground.rectangle, width = 5, height = 2000, foreground = false, color = 0xdd4400, miceCollision = false, groundCollision = false})
		tfm.exec.addPhysicObject(24, x - pacmice_map.cell_w / 2, y, {type = tfm.enum.ground.rectangle, width = 5, height = 2000, foreground = false, color = 0xdd4400, miceCollision = false, groundCollision = false})
		tfm.exec.addPhysicObject(25, x, y + pacmice_map.cell_h / 2, {type = tfm.enum.ground.rectangle, width = 2000, height = 5, foreground = false, color = 0xdd4400, miceCollision = false, groundCollision = false})
		tfm.exec.addPhysicObject(26, x, y - pacmice_map.cell_h / 2, {type = tfm.enum.ground.rectangle, width = 2000, height = 5, foreground = false, color = 0xdd4400, miceCollision = false, groundCollision = false})
	else
		tfm.exec.removeObject(23)
		tfm.exec.removeObject(24)
		tfm.exec.removeObject(25)
		tfm.exec.removeObject(26)
	end
end
--- Move the generation cursor, handling colisions.
function pacmice_MoveCursor(x, y)
	if not pacmice_cur_generating then
		-- map bounds
		if x < 0 or y < 0 or x >= pacmice_map.grid_w or y >= pacmice_map.grid_h then
			print("out of bounds")
			return
		end
		-- walls
		if not pacmice_GridGet(x, y) then
			return
		end
	end
	pacmice_cur_x = x
	pacmice_cur_y = y
	if pacmice_cur_generating then
		pacmice_GridSet(x, y, true)
	end
end
--- Get a vector from a direction key.
function pacmice_KeycodeToVector(keycode)
	if keycode == pshy.keycodes.UP then
		return 0, -1
	elseif keycode == pshy.keycodes.DOWN then
		return 0, 1
	elseif keycode == pshy.keycodes.LEFT then
		return -1, 0
	elseif keycode == pshy.keycodes.RIGHT then
		return 1, 0
	end
end
--- Get a direction from a vector.
function pacmice_VectorToDirection(x, y)
	if x == 1 and y == 0 then
		return 0
	elseif x == 0 and y == 1 then
		return (math.pi / 2) * 1
	elseif x == -1 and y == 0 then
		return (math.pi / 2) * 2
	elseif x == 0 and y == -1 then
		return (math.pi / 2) * 3
	end
	error("unexpected")
end
--- Get grid coordinates from a point on screen.
function pacmice_GetGridCoords(x, y)
	x = math.floor((x - pacmice_map.x) / pacmice_map.cell_w + 0.5)
	y = math.floor((y - pacmice_map.y) / pacmice_map.cell_h + 0.5)
	return x, y
end
--- Export the grid.
function pacmice_GridExportPathes(player_name)
	local total = "{"
	-- generate export string
	for y = 0, (pacmice_map.grid_h - 1) do
		for x = 0, (pacmice_map.grid_w - 1) do
			if pacmice_GridGet(x, y) then
				if #total > 1 then
					total = total .. ", "
				end
				total = total .. "{" .. tostring(x) .. ", " .. tostring(y) .. "}"
			end
		end
	end
	total = total .. "}"
	-- export
	while #total > 0 do
		subtotal = string.sub(total, 1, 180)
		tfm.exec.chatMessage(subtotal, player_name)
		total = string.sub(total, 181, #total)
	end
end
--- TFM event eventMouse.
function eventMouse(player_name, x, y)
	if player_name == pacmice_cur_pilot then
		x, y = pacmice_GetGridCoords(x, y)
		pacmice_MoveCursor(x, y)
		pacmice_DrawCursor()
		return true
	end
end
--- TFM event eventkeyboard.
function eventKeyboard(player_name, keycode, down, x, y)
	if player_name == pacmice_cur_pilot and (keycode == 0 or keycode == 1 or keycode == 2 or keycode == 3) then
		vx, vy = pacmice_KeycodeToVector(keycode)
		pacmice_MoveCursor(pacmice_cur_x + vx, pacmice_cur_y + vy)
		pacmice_DrawCursor()
	end
	local pacman = pacmice_pacmans[player_name]
	if pacman then
		pacman.wish_vx, pacman.wish_vy = pacmice_KeycodeToVector(keycode)
	end
end
--- TFM event eventLoop.
function eventLoop(time, time_remaining)
	-- auto generating
	if pacmice_auto_generating then
		-- handle previous
		if pacmice_auto_object_id and pacmice_auto_x then
			local tfm_object = tfm.get.room.objectList[pacmice_auto_object_id]
			if tfm_object and tfm_object.id == pacmice_auto_object_id then
				local spawn_x, spawn_y = pacmice_GetCellDrawCoords(pacmice_auto_x, pacmice_auto_y)
				if spawn_x == tfm_object.x and spawn_y == tfm_object.y and tfm_object.angle == 0 and tfm_object.vx == 0 and tfm_object.vy == 0 then
					pacmice_GridSet(pacmice_auto_x, pacmice_auto_y, true)
				else
					pacmice_GridSet(pacmice_auto_x, pacmice_auto_y, false)
				end
				--print("expected x: " .. tostring(spawn_x) " y: " .. tostring(spawn_y) .. " got x: " .. tfm.object.x)
			else
				return
			end
		end
		-- first 
		if not pacmice_auto_x then
			pacmice_auto_x = 0 -- TODO TODO TODO TODO TODO TODO
			pacmice_auto_y = 1 --  TODO TODO TODO TODO TODO
		else
			pacmice_auto_x = pacmice_auto_x + 1
			if pacmice_auto_x >= pacmice_map.grid_w then
				pacmice_auto_x = 0
				pacmice_auto_y = pacmice_auto_y + 1
				tfm.exec.chatMessage("Generating... " .. tostring(math.floor(pacmice_auto_y / pacmice_map.grid_h * 100) .. "%"))
				if pacmice_auto_y >= pacmice_map.grid_h then
					pacmice_auto_x = nil
					pacmice_auto_y = nil
					pacmice_auto_generating = false
					tfm.exec.chatMessage("Finished generating!")
					return
				end
			end
		end
		-- spawn object
		local spawn_x, spawn_y = pacmice_GetCellDrawCoords(pacmice_auto_x, pacmice_auto_y)
		if not pacmice_auto_object_id then
			pacmice_auto_object_id = tfm.exec.addShamanObject(tfm.enum.shamanObject.ball, spawn_x, spawn_y, 0, 0, 0, true)
		else
			tfm.exec.moveObject(pacmice_auto_object_id, spawn_x, spawn_y, false, 0, 0, false, 0, 0)
		end
	end
	-- skip this if generating
	if pacmice_cur_generating or pacmice_cur_pilot then
		return
	end
	-- next game
	if time_remaining <= 1 then
		for player_name, player in pairs(tfm.get.room.playerList) do
			if not player.isDead then
				tfm.exec.playerVictory(player_name)
				pshy.scores_Add(player_name, 10)
			end
		end
	end
	if time_remaining <= 0 then
		pacmice_round_over = true
		local pacmans_names = {}
		for player_name in pairs(pacmice_pacmans) do
			pacmans_names[player_name] = true
		end
		for player_name in pairs(pacmans_names) do
			pacmice_DestroyPacman(player_name)
		end
		pshy.RotationNext("pacmice")
	elseif pacmice_CountMiceAlive() <= 0 then
		tfm.exec.setGameTime(8, false)
	else
		local is_pacmouse = false
		for player_name in pairs(pacmice_pacmans) do
			is_pacmouse = true
		end
		if not is_pacmouse then
			tfm.exec.setGameTime(8, false)
		end
	end
end
--- pshy event eventLoopMore.
function eventLoopMore(time, time_remaining)
	for player_name, pacman in pairs(pacmice_pacmans) do
		--pacman.cell_x, pacman.cell_y = GetGridCoords(tfm.get.room.playerList[player_name].x, tfm.get.room.playerList[player_name].y)
		local wish_x = pacman.cell_x + pacman.wish_vx
		local wish_y = pacman.cell_y + pacman.wish_vy
		if pacmice_GridGet(wish_x, wish_y) then
			pacman.cell_vx = pacman.wish_vx
			pacman.cell_vy = pacman.wish_vy
		end
		if pacman.cell_vx ~= 0 or pacman.cell_vy ~= 0 then
			local seen_x = pacman.cell_x + pacman.cell_vx
			local seen_y = pacman.cell_y + pacman.cell_vy
			if pacmice_GridGet(seen_x, seen_y) then
				pacman.cell_x = seen_x
				pacman.cell_y = seen_y
				pacman.direction = pacmice_VectorToDirection(pacman.cell_vx, pacman.cell_vy)
			else		
				pacman.cell_vx = 0
				pacman.cell_vy = 0
			end
		end
--		pacman.cell_vx = pacman.wish_vx
--		pacman.cell_vy = pacman.wish_vy
--		pacman.direction = VectorToDirection(pacman.cell_vx, pacman.cell_vy)
--		tfm.exec.movePlayer(player_name, 0, 0, true, pacman.cell_vx * pacman.speed, pacman.cell_vy * pacman.speed, false)
		pacmice_DrawPacman(player_name)
	end
end
--- TFM event eventnewPlayer.
function eventNewPlayer(player_name)
	if auto_respawn and not pacmice_pacmans[player_name] then
		tfm.exec.respawnPlayer(player_name)
	end
end
--- TFM event eventPlayerWon
function eventPlayerWon(player_name)
	if not pacmice_pacmans[player_name] then
		pshy.scores_Add(player_name, 10)	
	end
end
--- TFM event eventPlayerDied.
function eventPlayerDied(player_name)
	if pacmice_pacmans[player_name] then
		pacmice_DestroyPacman(player_name)
	elseif auto_respawn then
		tfm.exec.respawnPlayer(player_name)
	else
		if not pacmice_round_over then
			pshy.scores_Add(player_name, 1)	
		end
	end
end
--- !pacmouse
function pacmice_ChatCommandPackmouse(user, target)
	target = target or user
	if target ~= user then
		if target ~= user and not pshy.HavePerm(user, "!pacmouse-others") then
			return false, "You cant use this command on others :c"
		end
		local reason
		target, reason = pshy.FindPlayerName(target)
		if not target then
			return false, reason
		end
	end
	if pacmice_pacmans[target] then
		pacmice_DestroyPacman(target)
	else
		if pacmice_pacmouse_count >= 2 then
			return false, "Too many pacmice :c"
		end
		pacmice_CreatePacman(target)
	end
end
pshy.chat_commands["pacmouse"] = {func = pacmice_ChatCommandPackmouse, desc = "turn into a pacmouse", argc_min = 0, argc_max = 1, arg_types = {"string"}, arg_names = {"Target#0000"}}
pshy.help_pages["pacmice"].commands["pacmouse"] = pshy.chat_commands["pacmouse"]
pshy.perms.admins["!pacmouse"] = true
--- !generatepathes
function pacmice_ChatCommandPackmiceGenerate(user, target)
	target = target or user
	if target ~= user and not pshy.HavePerm(user, "!pacmouse-others") then
		return false, "You cant use this command on others :c"
	end
	if pacmice_cur_pilot ~= target or not pacmice_cur_generating then
		pacmice_cur_pilot = target
		pacmice_cur_generating = true
		system.bindMouse(target, true)
		system.bindKeyboard(target, pshy.keycodes.UP, true, true)
		system.bindKeyboard(target, pshy.keycodes.DOWN, true, true)
		system.bindKeyboard(target, pshy.keycodes.LEFT, true, true)
		system.bindKeyboard(target, pshy.keycodes.RIGHT, true, true)
		tfm.exec.freezePlayer(target, true)
		tfm.exec.chatMessage("Generating!", user)
	else
		pacmice_cur_generating = false
		pacmice_GridExportPathes(target)
		tfm.exec.freezePlayer(target, false)
		tfm.exec.chatMessage("No longer generating.", user)
	end
end
pshy.chat_commands["generatepathes"] = {func = pacmice_ChatCommandPackmiceGenerate, desc = "generate the new map's pathes (see source)", argc_min = 0, argc_max = 1, arg_types = {"player"}, arg_names = {"Target#0000"}}
pshy.help_pages["pacmice"].commands["generatepathes"] = pshy.chat_commands["generatepathes"]
pshy.perms.admins["!generatepathes"] = true
--- !autogeneratepathes
function pacmice_ChatCommandPackmiceGenerate(user)
	local target = user
	if pacmice_cur_pilot ~= target or not pacmice_auto_generating then
		pacmice_cur_pilot = target
		pacmice_auto_generating = true
		tfm.exec.setWorldGravity(0, 0)
		tfm.exec.chatMessage("Auto generating!", user)
	else
		pacmice_auto_generating = false
		pacmice_GridExportPathes(target)
		tfm.exec.chatMessage("No longer auto generating.", user)
	end
end
pshy.chat_commands["autogeneratepathes"] = {func = pacmice_ChatCommandPackmiceGenerate, desc = "autogenerate the new map's pathes (see source)", argc_min = 0, argc_max = 0}
pshy.help_pages["pacmice"].commands["autogeneratepathes"] = pshy.chat_commands["autogeneratepathes"]
pshy.perms.admins["!autogeneratepathes"] = true
--- Replace #ff0000 by the winner team color
function pshy.pacmice_GetMap(i_map)
	pacmice_map = pacmice_maps[i_map]
	pacmice_map_color_index = (pacmice_map_color_index % #pacmice_map_colors) + 1
	if #pacmice_map.pathes == 1 and not pacmice_map.grid_w then
		pacmice_cur_generating = true
		pacmice_map.grid_w = 100
		pacmice_map.grid_h = 100
	end
	return string.gsub(pacmice_map.xml, "1500fb", pacmice_map_colors[pacmice_map_color_index])
end
--- Initialization:
-- generate other map properties
for i_map, map in ipairs(pacmice_maps) do
	pacmice_map = map
	map.linear_grid = {}
	if not map.grid_w then
		local max_grid_x, max_grid_y = 1, 1
		for i_path, path in ipairs(map.pathes) do
			max_grid_x = math.max(max_grid_x, path[1])
			max_grid_y = math.max(max_grid_y, path[2])
		end
		map.grid_w = max_grid_x + 1
		map.grid_h = max_grid_y + 1
	end
	-- load map linear path grid
	for i_path, path in ipairs(map.pathes) do
		pacmice_GridSet(path[1], path[2], true)
	end
end
pacmice_map = nil
-- create the rotiation
pshy.rotations["pacmice"] = {hidden = true, desc = "pacmice", duration = 120, weight = 0, maps = {}, map_replace_func = pshy.pacmice_GetMap, chance = 0}
for i_map in ipairs(pacmice_maps) do
	table.insert(pshy.rotations["pacmice"].maps, i_map)
end
-- start
pshy.RotationNext("pacmice")
pshy.merge_ModuleEnd()
pshy.merge_Finish()


